(function(dt,yt){typeof exports=="object"&&typeof module!="undefined"?yt(exports):typeof define=="function"&&define.amd?define(["exports"],yt):(dt=typeof globalThis!="undefined"?globalThis:dt||self,yt(dt["cursor-chat"]={}))})(this,function(dt){"use strict";var wl=Object.defineProperty,bl=Object.defineProperties;var _l=Object.getOwnPropertyDescriptors;var Es=Object.getOwnPropertySymbols;var vl=Object.prototype.hasOwnProperty,Sl=Object.prototype.propertyIsEnumerable;var Cs=(dt,yt,ct)=>yt in dt?wl(dt,yt,{enumerable:!0,configurable:!0,writable:!0,value:ct}):dt[yt]=ct,pe=(dt,yt)=>{for(var ct in yt||(yt={}))vl.call(yt,ct)&&Cs(dt,ct,yt[ct]);if(Es)for(var ct of Es(yt))Sl.call(yt,ct)&&Cs(dt,ct,yt[ct]);return dt},On=(dt,yt)=>bl(dt,_l(yt));var yt="";const ct=()=>new Map,Qe=e=>{const t=ct();return e.forEach((n,i)=>{t.set(i,n)}),t},St=(e,t,n)=>{let i=e.get(t);return i===void 0&&e.set(t,i=n()),i},ks=(e,t)=>{const n=[];for(const[i,s]of e)n.push(t(s,i));return n},Rs=(e,t)=>{for(const[n,i]of e)if(t(i,n))return!0;return!1},te=()=>new Set,xn=e=>e[e.length-1],Ts=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},Or=Array.from,xr=Array.isArray;class ye{constructor(){this._observers=ct()}on(t,n){St(this._observers,t,te).add(n)}once(t,n){const i=(...s)=>{this.off(t,i),n(...s)};this.on(t,i)}off(t,n){const i=this._observers.get(t);i!==void 0&&(i.delete(n),i.size===0&&this._observers.delete(t))}emit(t,n){return Or((this._observers.get(t)||ct()).values()).forEach(i=>i(...n))}destroy(){this._observers=ct()}}const Lt=Math.floor,tn=Math.abs,As=Math.log10,Nn=(e,t)=>e<t?e:t,ee=(e,t)=>e>t?e:t,Nr=e=>e!==0?e<0:1/e<0,Ds=String.fromCharCode,Is=e=>e.toLowerCase(),Ls=/^\s*/g,Ms=e=>e.replace(Ls,""),Os=/([A-Z])/g,Ur=(e,t)=>Ms(e.replace(Os,n=>`${t}${Is(n)}`)),xs=e=>{const t=unescape(encodeURIComponent(e)),n=t.length,i=new Uint8Array(n);for(let s=0;s<n;s++)i[s]=t.codePointAt(s);return i},Oe=typeof TextEncoder!="undefined"?new TextEncoder:null,Un=Oe?e=>Oe.encode(e):xs;let xe=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});xe&&xe.decode(new Uint8Array).length===1&&(xe=null);const Fr=e=>e===void 0?null:e;class Ns{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}}let Pr=new Ns,Br=!0;try{typeof localStorage!="undefined"&&(Pr=localStorage,Br=!1)}catch{}const jr=Pr,Us=e=>Br||addEventListener("storage",e),Fs=Object.keys,en=e=>Fs(e).length,Ps=(e,t)=>{for(const n in e)if(!t(e[n],n))return!1;return!0},Vr=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),Bs=(e,t)=>e===t||en(e)===en(t)&&Ps(e,(n,i)=>(n!==void 0||Vr(t,i))&&t[i]===n),Fn=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&Fn(e,t,n+1)}},js=()=>{},Vs=(e,t)=>e===t,Ne=(e,t)=>{if(e==null||t==null)return Vs(e,t);if(e.constructor!==t.constructor)return!1;if(e===t)return!0;switch(e.constructor){case ArrayBuffer:e=new Uint8Array(e),t=new Uint8Array(t);case Uint8Array:{if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;break}case Set:{if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;break}case Map:{if(e.size!==t.size)return!1;for(const n of e.keys())if(!t.has(n)||!Ne(e.get(n),t.get(n)))return!1;break}case Object:if(en(e)!==en(t))return!1;for(const n in e)if(!Vr(e,n)||!Ne(e[n],t[n]))return!1;break;case Array:if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Ne(e[n],t[n]))return!1;break;default:return!1}return!0},qs=(e,t)=>t.includes(e),ne=typeof process!="undefined"&&process.release&&/node|io\.js/.test(process.release.name),qr=typeof window!="undefined"&&!ne;typeof navigator!="undefined"&&/Mac/.test(navigator.platform);let Mt;const Hs=()=>{if(Mt===void 0)if(ne){Mt=ct();const e=process.argv;let t=null;for(let n=0;n<e.length;n++){const i=e[n];i[0]==="-"?(t!==null&&Mt.set(t,""),t=i):t!==null&&(Mt.set(t,i),t=null)}t!==null&&Mt.set(t,"")}else typeof location=="object"?(Mt=ct(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,n]=e.split("=");Mt.set(`--${Ur(t,"-")}`,n),Mt.set(`-${Ur(t,"-")}`,n)}})):Mt=ct();return Mt},Pn=e=>Hs().has(e),nn=e=>Fr(ne?process.env[e.toUpperCase()]:jr.getItem(e));(e=>Pn("--"+e)||nn(e)!==null)("production");const Hr=ne&&qs({}.FORCE_COLOR,["true","1","2"]),Ws=!Pn("no-colors")&&(!ne||process.stdout.isTTY||Hr)&&(!ne||Pn("color")||Hr||nn("COLORTERM")!==null||(nn("TERM")||"").includes("color")),Wr=1,$r=2,Bn=4,jn=8,Ue=32,jt=64,_t=128,rn=31,Vn=63,re=127,$s=2147483647,Yr=Number.MAX_SAFE_INTEGER,Ys=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&Lt(e)===e),$t=e=>new Error(e),Ot=()=>{throw $t("Method unimplemented")},xt=()=>{throw $t("Unexpected case")},zr=$t("Unexpected end of array"),Gr=$t("Integer out of Range");class sn{constructor(t){this.arr=t,this.pos=0}}const Nt=e=>new sn(e),zs=e=>e.pos!==e.arr.length,Gs=(e,t)=>{const n=$n(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},ft=e=>Gs(e,J(e)),ie=e=>e.arr[e.pos++],J=e=>{let t=0,n=1;const i=e.arr.length;for(;e.pos<i;){const s=e.arr[e.pos++];if(t=t+(s&re)*n,n*=128,s<_t)return t;if(t>Yr)throw Gr}throw zr},qn=e=>{let t=e.arr[e.pos++],n=t&Vn,i=64;const s=(t&jt)>0?-1:1;if((t&_t)===0)return s*n;const o=e.arr.length;for(;e.pos<o;){if(t=e.arr[e.pos++],n=n+(t&re)*i,i*=128,t<_t)return s*n;if(n>Yr)throw Gr}throw zr},Vt=xe?e=>xe.decode(ft(e)):e=>{let t=J(e);if(t===0)return"";{let n=String.fromCodePoint(ie(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(ie(e));else for(;t>0;){const i=t<1e4?t:1e4,s=e.arr.subarray(e.pos,e.pos+i);e.pos+=i,n+=String.fromCodePoint.apply(null,s),t-=i}return decodeURIComponent(escape(n))}},Hn=(e,t)=>{const n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},Js=[e=>{},e=>null,qn,e=>Hn(e,4).getFloat32(0,!1),e=>Hn(e,8).getFloat64(0,!1),e=>Hn(e,8).getBigInt64(0,!1),e=>!1,e=>!0,Vt,e=>{const t=J(e),n={};for(let i=0;i<t;i++){const s=Vt(e);n[s]=me(e)}return n},e=>{const t=J(e),n=[];for(let i=0;i<t;i++)n.push(me(e));return n},ft],me=e=>Js[127-ie(e)](e);class Jr extends sn{constructor(t,n){super(t);this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),zs(this)?this.count=J(this)+1:this.count=-1),this.count--,this.s}}class on extends sn{constructor(t){super(t);this.s=0,this.count=0}read(){if(this.count===0){this.s=qn(this);const t=Nr(this.s);this.count=1,t&&(this.s=-this.s,this.count=J(this)+2)}return this.count--,this.s}}class Wn extends sn{constructor(t){super(t);this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=qn(this),n=t&1;this.diff=Lt(t/2),this.count=1,n&&(this.count=J(this)+2)}return this.s+=this.diff,this.count--,this.s}}class Ks{constructor(t){this.decoder=new on(t),this.str=Vt(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),n=this.str.slice(this.spos,t);return this.spos=t,n}}const Kr=e=>new Uint8Array(e),$n=(e,t,n)=>new Uint8Array(e,t,n),Xs=e=>new Uint8Array(e),Zs=e=>{let t="";for(let n=0;n<e.byteLength;n++)t+=Ds(e[n]);return btoa(t)},Qs=e=>Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("base64"),to=e=>{const t=atob(e),n=Kr(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n},eo=e=>{const t=Buffer.from(e,"base64");return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)},Xr=qr?Zs:Qs,Zr=qr?to:eo,no=e=>{const t=Kr(e.byteLength);return t.set(e),t};class Fe{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const gt=()=>new Fe,ro=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},st=e=>{const t=new Uint8Array(ro(e));let n=0;for(let i=0;i<e.bufs.length;i++){const s=e.bufs[i];t.set(s,n),n+=s.length}return t.set($n(e.cbuf.buffer,0,e.cpos),n),t},io=(e,t)=>{const n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push($n(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(ee(n,t)*2),e.cpos=0)},pt=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t},Pe=pt,H=(e,t)=>{for(;t>re;)pt(e,_t|re&t),t=Lt(t/128);pt(e,re&t)},Yn=(e,t)=>{const n=Nr(t);for(n&&(t=-t),pt(e,(t>Vn?_t:0)|(n?jt:0)|Vn&t),t=Lt(t/64);t>0;)pt(e,(t>re?_t:0)|re&t),t=Lt(t/128)},zn=new Uint8Array(3e4),so=zn.length/3,oo=(e,t)=>{if(t.length<so){const n=Oe.encodeInto(t,zn).written||0;H(e,n);for(let i=0;i<n;i++)pt(e,zn[i])}else ot(e,Un(t))},ao=(e,t)=>{const n=unescape(encodeURIComponent(t)),i=n.length;H(e,i);for(let s=0;s<i;s++)pt(e,n.codePointAt(s))},Ut=Oe&&Oe.encodeInto?oo:ao,an=(e,t)=>{const n=e.cbuf.length,i=e.cpos,s=Nn(n-i,t.length),o=t.length-s;e.cbuf.set(t.subarray(0,s),i),e.cpos+=s,o>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(ee(n*2,o)),e.cbuf.set(t.subarray(s)),e.cpos=o)},ot=(e,t)=>{H(e,t.byteLength),an(e,t)},Gn=(e,t)=>{io(e,t);const n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},lo=(e,t)=>Gn(e,4).setFloat32(0,t,!1),co=(e,t)=>Gn(e,8).setFloat64(0,t,!1),ho=(e,t)=>Gn(e,8).setBigInt64(0,t,!1),Qr=new DataView(new ArrayBuffer(4)),uo=e=>(Qr.setFloat32(0,e),Qr.getFloat32(0)===e),we=(e,t)=>{switch(typeof t){case"string":pt(e,119),Ut(e,t);break;case"number":Ys(t)&&tn(t)<=$s?(pt(e,125),Yn(e,t)):uo(t)?(pt(e,124),lo(e,t)):(pt(e,123),co(e,t));break;case"bigint":pt(e,122),ho(e,t);break;case"object":if(t===null)pt(e,126);else if(t instanceof Array){pt(e,117),H(e,t.length);for(let n=0;n<t.length;n++)we(e,t[n])}else if(t instanceof Uint8Array)pt(e,116),ot(e,t);else{pt(e,118);const n=Object.keys(t);H(e,n.length);for(let i=0;i<n.length;i++){const s=n[i];Ut(e,s),we(e,t[s])}}break;case"boolean":pt(e,t?120:121);break;default:pt(e,127)}};class ti extends Fe{constructor(t){super();this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&H(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const ei=e=>{e.count>0&&(Yn(e.encoder,e.count===1?e.s:-e.s),e.count>1&&H(e.encoder,e.count-2))};class ln{constructor(){this.encoder=new Fe,this.s=0,this.count=0}write(t){this.s===t?this.count++:(ei(this),this.count=1,this.s=t)}toUint8Array(){return ei(this),st(this.encoder)}}const ni=e=>{if(e.count>0){const t=e.diff*2+(e.count===1?0:1);Yn(e.encoder,t),e.count>1&&H(e.encoder,e.count-2)}};class Jn{constructor(){this.encoder=new Fe,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(ni(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return ni(this),st(this.encoder)}}class fo{constructor(){this.sarr=[],this.s="",this.lensE=new ln}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new Fe;return this.sarr.push(this.s),this.s="",Ut(t,this.sarr.join("")),an(t,this.lensE.toUint8Array()),st(t)}}const ri=typeof crypto=="undefined"?null:crypto,go=ri!==null?e=>{const t=new ArrayBuffer(e),n=new Uint8Array(t);return ri.getRandomValues(n),t}:e=>{const t=new ArrayBuffer(e),n=new Uint8Array(t);for(let i=0;i<e;i++)n[i]=Math.ceil(Math.random()*4294967295>>>0);return t},po=Math.random,ii=()=>new Uint32Array(go(4))[0],yo=[1e7]+-1e3+-4e3+-8e3+-1e11,si=()=>yo.replace(/[018]/g,e=>(e^ii()&15>>e/4).toString(16)),Ft=Date.now,oi=e=>new Promise(e),mo=e=>Promise.reject(e),Kn=e=>Promise.resolve(e),qt=Symbol;class wo{constructor(t,n){this.left=t,this.right=n}}const Ht=(e,t)=>new wo(e,t),se=typeof document!="undefined"?document:{};typeof DOMParser!="undefined"&&new DOMParser;const bo=e=>ks(e,(t,n)=>`${n}:${t};`).join("");se.ELEMENT_NODE,se.TEXT_NODE,se.CDATA_SECTION_NODE,se.COMMENT_NODE,se.DOCUMENT_NODE,se.DOCUMENT_TYPE_NODE,se.DOCUMENT_FRAGMENT_NODE;const vt=qt(),Yt=qt(),Xn=qt(),cn=qt(),Zn=qt(),Qn=qt(),tr=qt(),hn=qt(),Be=qt(),_o={[vt]:Ht("font-weight","bold"),[Yt]:Ht("font-weight","normal"),[Xn]:Ht("color","blue"),[Zn]:Ht("color","green"),[cn]:Ht("color","grey"),[Qn]:Ht("color","red"),[tr]:Ht("color","purple"),[hn]:Ht("color","orange"),[Be]:Ht("color","black")},ai={[vt]:"\x1B[1m",[Yt]:"\x1B[2m",[Xn]:"\x1B[34m",[Zn]:"\x1B[32m",[cn]:"\x1B[37m",[Qn]:"\x1B[31m",[tr]:"\x1B[35m",[hn]:"\x1B[38;5;208m",[Be]:"\x1B[0m"},vo=Ws?ne?e=>{const t=[],n=[];let i=0;for(;i<e.length;i++){const s=e[i],o=ai[s];if(o!==void 0)t.push(o);else if(s.constructor===String||s.constructor===Number)t.push(s);else break}for(i>0&&(t.push("\x1B[0m"),n.push(t.join("")));i<e.length;i++){const s=e[i];s instanceof Symbol||n.push(s)}return n}:e=>{const t=[],n=[],i=ct();let s=[],o=0;for(;o<e.length;o++){const u=e[o],c=_o[u];if(c!==void 0)i.set(c.left,c.right);else if(u.constructor===String||u.constructor===Number){const l=bo(i);o>0||l.length>0?(t.push("%c"+u),n.push(l)):t.push(u)}else break}for(o>0&&(s=n,s.unshift(t.join("")));o<e.length;o++){const u=e[o];u instanceof Symbol||s.push(u)}return s}:e=>{const t=[],n=[];let i=0;for(;i<e.length;i++){const s=e[i];if(ai[s]===void 0)if(s.constructor===String||s.constructor===Number)t.push(s);else break}for(i>0&&n.push(t.join(""));i<e.length;i++){const s=e[i];s instanceof Symbol||(s.constructor===Object?n.push(JSON.stringify(s)):n.push(s))}return n},li=(...e)=>{console.log(...vo(e)),So.forEach(t=>t.print(e))},So=te(),ci=[Zn,tr,hn,Xn];let er=0,hi=Ft();const Eo=e=>{const t=ci[er],n=nn("log"),i=n!==null&&(n==="*"||n==="true"||new RegExp(n,"gi").test(e));return er=(er+1)%ci.length,e+=": ",i?(...s)=>{const o=Ft(),u=o-hi;hi=o,li(t,e,Be,...s.map(c=>typeof c=="string"||typeof c=="symbol"?c:JSON.stringify(c)),t," +"+u+"ms")}:js},ui=e=>({[Symbol.iterator](){return this},next:e}),Co=(e,t)=>ui(()=>{let n;do n=e.next();while(!n.done&&!t(n.value));return n}),nr=(e,t)=>ui(()=>{const{done:n,value:i}=e.next();return{done:n,value:n?void 0:t(i)}});class Ol extends ye{constructor(t,n){super();this.doc=t,this.awareness=n}}class rr{constructor(t,n){this.clock=t,this.len=n}}class be{constructor(){this.clients=new Map}}const oe=(e,t,n)=>t.clients.forEach((i,s)=>{const o=e.doc.store.clients.get(s);for(let u=0;u<i.length;u++){const c=i[u];Di(e,o,c.clock,c.len,n)}}),ko=(e,t)=>{let n=0,i=e.length-1;for(;n<=i;){const s=Lt((n+i)/2),o=e[s],u=o.clock;if(u<=t){if(t<u+o.len)return s;n=s+1}else i=s-1}return null},un=(e,t)=>{const n=e.clients.get(t.client);return n!==void 0&&ko(n,t.clock)!==null},ir=e=>{e.clients.forEach(t=>{t.sort((s,o)=>s.clock-o.clock);let n,i;for(n=1,i=1;n<t.length;n++){const s=t[i-1],o=t[n];s.clock+s.len>=o.clock?s.len=ee(s.len,o.clock+o.len-s.clock):(i<n&&(t[i]=o),i++)}t.length=i})},sr=e=>{const t=new be;for(let n=0;n<e.length;n++)e[n].clients.forEach((i,s)=>{if(!t.clients.has(s)){const o=i.slice();for(let u=n+1;u<e.length;u++)Ts(o,e[u].clients.get(s)||[]);t.clients.set(s,o)}});return ir(t),t},je=(e,t,n,i)=>{St(e.clients,t,()=>[]).push(new rr(n,i))},di=()=>new be,Ro=e=>{const t=di();return e.clients.forEach((n,i)=>{const s=[];for(let o=0;o<n.length;o++){const u=n[o];if(u.deleted){const c=u.id.clock;let l=u.length;if(o+1<n.length)for(let y=n[o+1];o+1<n.length&&y.deleted;y=n[++o+1])l+=y.length;s.push(new rr(c,l))}}s.length>0&&t.clients.set(i,s)}),t},_e=(e,t)=>{H(e.restEncoder,t.clients.size),t.clients.forEach((n,i)=>{e.resetDsCurVal(),H(e.restEncoder,i);const s=n.length;H(e.restEncoder,s);for(let o=0;o<s;o++){const u=n[o];e.writeDsClock(u.clock),e.writeDsLen(u.len)}})},or=e=>{const t=new be,n=J(e.restDecoder);for(let i=0;i<n;i++){e.resetDsCurVal();const s=J(e.restDecoder),o=J(e.restDecoder);if(o>0){const u=St(t.clients,s,()=>[]);for(let c=0;c<o;c++)u.push(new rr(e.readDsClock(),e.readDsLen()))}}return t},fi=(e,t,n)=>{const i=new be,s=J(e.restDecoder);for(let o=0;o<s;o++){e.resetDsCurVal();const u=J(e.restDecoder),c=J(e.restDecoder),l=n.clients.get(u)||[],y=ht(n,u);for(let w=0;w<c;w++){const h=e.readDsClock(),f=h+e.readDsLen();if(h<y){y<f&&je(i,u,y,f-y);let p=Pt(l,h),g=l[p];for(!g.deleted&&g.id.clock<h&&(l.splice(p+1,0,An(t,g,h-g.id.clock)),p++);p<l.length&&(g=l[p++],g.id.clock<f);)g.deleted||(f<g.id.clock+g.length&&l.splice(p,0,An(t,g,f-g.id.clock)),g.delete(t))}else je(i,u,h,f-h)}}if(i.clients.size>0){const o=new ae;return H(o.restEncoder,0),_e(o,i),o.toUint8Array()}return null},gi=ii;class ve extends ye{constructor({guid:t=si(),collectionid:n=null,gc:i=!0,gcFilter:s=()=>!0,meta:o=null,autoLoad:u=!1,shouldLoad:c=!0}={}){super();this.gc=i,this.gcFilter=s,this.clientID=gi(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new Ri,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=c,this.autoLoad=u,this.meta=o,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=oi(y=>{this.on("load",()=>{this.isLoaded=!0,y(this)})});const l=()=>oi(y=>{const w=h=>{(h===void 0||h===!0)&&(this.off("sync",w),y())};this.on("sync",w)});this.on("sync",y=>{y===!1&&this.isSynced&&(this.whenSynced=l()),this.isSynced=y===void 0||y===!0,this.isLoaded||this.emit("load",[])}),this.whenSynced=l()}load(){const t=this._item;t!==null&&!this.shouldLoad&&tt(t.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Array.from(this.subdocs).map(t=>t.guid))}transact(t,n=null){tt(this,t,n)}get(t,n=mt){const i=St(this.share,t,()=>{const o=new n;return o._integrate(this,null),o}),s=i.constructor;if(n!==mt&&s!==n)if(s===mt){const o=new n;o._map=i._map,i._map.forEach(u=>{for(;u!==null;u=u.left)u.parent=o}),o._start=i._start;for(let u=o._start;u!==null;u=u.right)u.parent=o;return o._length=i._length,this.share.set(t,o),o._integrate(this,null),o}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return i}getArray(t=""){return this.get(t,Ce)}getText(t=""){return this.get(t,Te)}getMap(t=""){return this.get(t,ke)}getXmlFragment(t=""){return this.get(t,le)}toJSON(){const t={};return this.share.forEach((n,i)=>{t[i]=n.toJSON()}),t}destroy(){Or(this.subdocs).forEach(n=>n.destroy());const t=this._item;if(t!==null){this._item=null;const n=t.content;n.doc=new ve(On(pe({guid:this.guid},n.opts),{shouldLoad:!1})),n.doc._item=t,tt(t.parent.doc,i=>{const s=n.doc;t.deleted||i.subdocsAdded.add(s),i.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}on(t,n){super.on(t,n)}off(t,n){super.off(t,n)}}class pi{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return J(this.restDecoder)}readDsLen(){return J(this.restDecoder)}}class yi extends pi{readLeftID(){return K(J(this.restDecoder),J(this.restDecoder))}readRightID(){return K(J(this.restDecoder),J(this.restDecoder))}readClient(){return J(this.restDecoder)}readInfo(){return ie(this.restDecoder)}readString(){return Vt(this.restDecoder)}readParentInfo(){return J(this.restDecoder)===1}readTypeRef(){return J(this.restDecoder)}readLen(){return J(this.restDecoder)}readAny(){return me(this.restDecoder)}readBuf(){return no(ft(this.restDecoder))}readJSON(){return JSON.parse(Vt(this.restDecoder))}readKey(){return Vt(this.restDecoder)}}class To{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=J(this.restDecoder),this.dsCurrVal}readDsLen(){const t=J(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class Se extends To{constructor(t){super(t);this.keys=[],J(t),this.keyClockDecoder=new Wn(ft(t)),this.clientDecoder=new on(ft(t)),this.leftClockDecoder=new Wn(ft(t)),this.rightClockDecoder=new Wn(ft(t)),this.infoDecoder=new Jr(ft(t),ie),this.stringDecoder=new Ks(ft(t)),this.parentInfoDecoder=new Jr(ft(t),ie),this.typeRefDecoder=new on(ft(t)),this.lenDecoder=new on(ft(t))}readLeftID(){return new Ee(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Ee(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return me(this.restDecoder)}readBuf(){return ft(this.restDecoder)}readJSON(){return me(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class mi{constructor(){this.restEncoder=gt()}toUint8Array(){return st(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){H(this.restEncoder,t)}writeDsLen(t){H(this.restEncoder,t)}}class Ve extends mi{writeLeftID(t){H(this.restEncoder,t.client),H(this.restEncoder,t.clock)}writeRightID(t){H(this.restEncoder,t.client),H(this.restEncoder,t.clock)}writeClient(t){H(this.restEncoder,t)}writeInfo(t){Pe(this.restEncoder,t)}writeString(t){Ut(this.restEncoder,t)}writeParentInfo(t){H(this.restEncoder,t?1:0)}writeTypeRef(t){H(this.restEncoder,t)}writeLen(t){H(this.restEncoder,t)}writeAny(t){we(this.restEncoder,t)}writeBuf(t){ot(this.restEncoder,t)}writeJSON(t){Ut(this.restEncoder,JSON.stringify(t))}writeKey(t){Ut(this.restEncoder,t)}}class wi{constructor(){this.restEncoder=gt(),this.dsCurrVal=0}toUint8Array(){return st(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const n=t-this.dsCurrVal;this.dsCurrVal=t,H(this.restEncoder,n)}writeDsLen(t){t===0&&xt(),H(this.restEncoder,t-1),this.dsCurrVal+=t}}class ae extends wi{constructor(){super();this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Jn,this.clientEncoder=new ln,this.leftClockEncoder=new Jn,this.rightClockEncoder=new Jn,this.infoEncoder=new ti(Pe),this.stringEncoder=new fo,this.parentInfoEncoder=new ti(Pe),this.typeRefEncoder=new ln,this.lenEncoder=new ln}toUint8Array(){const t=gt();return H(t,0),ot(t,this.keyClockEncoder.toUint8Array()),ot(t,this.clientEncoder.toUint8Array()),ot(t,this.leftClockEncoder.toUint8Array()),ot(t,this.rightClockEncoder.toUint8Array()),ot(t,st(this.infoEncoder)),ot(t,this.stringEncoder.toUint8Array()),ot(t,st(this.parentInfoEncoder)),ot(t,this.typeRefEncoder.toUint8Array()),ot(t,this.lenEncoder.toUint8Array()),an(t,st(this.restEncoder)),st(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){we(this.restEncoder,t)}writeBuf(t){ot(this.restEncoder,t)}writeJSON(t){we(this.restEncoder,t)}writeKey(t){const n=this.keyMap.get(t);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}}const Ao=(e,t,n,i)=>{i=ee(i,t[0].id.clock);const s=Pt(t,i);H(e.restEncoder,t.length-s),e.writeClient(n),H(e.restEncoder,i);const o=t[s];o.write(e,i-o.id.clock);for(let u=s+1;u<t.length;u++)t[u].write(e,0)},ar=(e,t,n)=>{const i=new Map;n.forEach((s,o)=>{ht(t,o)>s&&i.set(o,s)}),gn(t).forEach((s,o)=>{n.has(o)||i.set(o,0)}),H(e.restEncoder,i.size),Array.from(i.entries()).sort((s,o)=>o[0]-s[0]).forEach(([s,o])=>{Ao(e,t.clients.get(s),s,o)})},Do=(e,t)=>{const n=ct(),i=J(e.restDecoder);for(let s=0;s<i;s++){const o=J(e.restDecoder),u=new Array(o),c=e.readClient();let l=J(e.restDecoder);n.set(c,{i:0,refs:u});for(let y=0;y<o;y++){const w=e.readInfo();switch(rn&w){case 0:{const h=e.readLen();u[y]=new Et(K(c,l),h),l+=h;break}case 10:{const h=J(e.restDecoder);u[y]=new Ct(K(c,l),h),l+=h;break}default:{const h=(w&(jt|_t))===0,f=new rt(K(c,l),null,(w&_t)===_t?e.readLeftID():null,null,(w&jt)===jt?e.readRightID():null,h?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,h&&(w&Ue)===Ue?e.readString():null,ns(e,w));u[y]=f,l+=f.length}}}}return n},Io=(e,t,n)=>{const i=[];let s=Array.from(n.keys()).sort((p,g)=>p-g);if(s.length===0)return null;const o=()=>{if(s.length===0)return null;let p=n.get(s[s.length-1]);for(;p.refs.length===p.i;)if(s.pop(),s.length>0)p=n.get(s[s.length-1]);else return null;return p};let u=o();if(u===null&&i.length===0)return null;const c=new Ri,l=new Map,y=(p,g)=>{const E=l.get(p);(E==null||E>g)&&l.set(p,g)};let w=u.refs[u.i++];const h=new Map,f=()=>{for(const p of i){const g=p.id.client,E=n.get(g);E?(E.i--,c.clients.set(g,E.refs.slice(E.i)),n.delete(g),E.i=0,E.refs=[]):c.clients.set(g,[p]),s=s.filter(I=>I!==g)}i.length=0};for(;;){if(w.constructor!==Ct){const g=St(h,w.id.client,()=>ht(t,w.id.client))-w.id.clock;if(g<0)i.push(w),y(w.id.client,w.id.clock-1),f();else{const E=w.getMissing(e,t);if(E!==null){i.push(w);const I=n.get(E)||{refs:[],i:0};if(I.refs.length===I.i)y(E,ht(t,E)),f();else{w=I.refs[I.i++];continue}}else(g===0||g<w.length)&&(w.integrate(e,g),h.set(w.id.client,w.id.clock+w.length))}}if(i.length>0)w=i.pop();else if(u!==null&&u.i<u.refs.length)w=u.refs[u.i++];else{if(u=o(),u===null)break;w=u.refs[u.i++]}}if(c.clients.size>0){const p=new ae;return ar(p,c,new Map),H(p.restEncoder,0),{missing:l,update:p.toUint8Array()}}return null},Lo=(e,t)=>ar(e,t.doc.store,t.beforeState),Mo=(e,t,n,i=new Se(e))=>tt(t,s=>{s.local=!1;let o=!1;const u=s.doc,c=u.store,l=Do(i,u),y=Io(s,c,l),w=c.pendingStructs;if(w){for(const[f,p]of w.missing)if(p<ht(c,f)){o=!0;break}if(y){for(const[f,p]of y.missing){const g=w.missing.get(f);(g==null||g>p)&&w.missing.set(f,p)}w.update=mn([w.update,y.update])}}else c.pendingStructs=y;const h=fi(i,s,c);if(c.pendingDs){const f=new Se(Nt(c.pendingDs));J(f.restDecoder);const p=fi(f,s,c);h&&p?c.pendingDs=mn([h,p]):c.pendingDs=h||p}else c.pendingDs=h;if(o){const f=c.pendingStructs.update;c.pendingStructs=null,bi(s.doc,f)}},n,!1),bi=(e,t,n,i=Se)=>{const s=Nt(t);Mo(s,e,n,new i(s))},Oo=(e,t,n)=>bi(e,t,n,yi),xo=(e,t,n=new Map)=>{ar(e,t.store,n),_e(e,Ro(t.store))},No=(e,t=new Uint8Array([0]),n=new ae)=>{const i=_i(t);xo(n,e,i);const s=[n.toUint8Array()];if(e.store.pendingDs&&s.push(e.store.pendingDs),e.store.pendingStructs&&s.push(Zo(e.store.pendingStructs.update,t)),s.length>1){if(n.constructor===Ve)return Ko(s.map((o,u)=>u===0?o:ta(o)));if(n.constructor===ae)return mn(s)}return s[0]},Uo=(e,t)=>No(e,t,new Ve),Fo=e=>{const t=new Map,n=J(e.restDecoder);for(let i=0;i<n;i++){const s=J(e.restDecoder),o=J(e.restDecoder);t.set(s,o)}return t},_i=e=>Fo(new pi(Nt(e))),vi=(e,t)=>(H(e.restEncoder,t.size),Array.from(t.entries()).sort((n,i)=>i[0]-n[0]).forEach(([n,i])=>{H(e.restEncoder,n),H(e.restEncoder,i)}),e),Po=(e,t)=>vi(e,gn(t.store)),Bo=(e,t=new wi)=>(e instanceof Map?vi(t,e):Po(t,e),t.toUint8Array()),jo=e=>Bo(e,new mi);class Vo{constructor(){this.l=[]}}const Si=()=>new Vo,Ei=(e,t)=>e.l.push(t),Ci=(e,t)=>{const n=e.l,i=n.length;e.l=n.filter(s=>t!==s),i===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},ki=(e,t,n)=>Fn(e.l,[t,n]);class Ee{constructor(t,n){this.client=t,this.clock=n}}const dn=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,K=(e,t)=>new Ee(e,t),qo=e=>{for(const[t,n]of e.doc.share.entries())if(n===e)return t;throw xt()},fn=(e,t)=>{for(;t!==null;){if(t.parent===e)return!0;t=t.parent._item}return!1};class Ho{constructor(t,n){this.ds=t,this.sv=n}}((e,t)=>new Ho(e,t))(di(),new Map);const qe=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!un(t.ds,e.id),lr=(e,t)=>{const n=St(e.meta,lr,te),i=e.doc.store;n.has(t)||(t.sv.forEach((s,o)=>{s<ht(i,o)&&bt(e,K(o,s))}),oe(e,t.ds,s=>{}),n.add(t))};class Ri{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const gn=e=>{const t=new Map;return e.clients.forEach((n,i)=>{const s=n[n.length-1];t.set(i,s.id.clock+s.length)}),t},ht=(e,t)=>{const n=e.clients.get(t);if(n===void 0)return 0;const i=n[n.length-1];return i.id.clock+i.length},Ti=(e,t)=>{let n=e.clients.get(t.id.client);if(n===void 0)n=[],e.clients.set(t.id.client,n);else{const i=n[n.length-1];if(i.id.clock+i.length!==t.id.clock)throw xt()}n.push(t)},Pt=(e,t)=>{let n=0,i=e.length-1,s=e[i],o=s.id.clock;if(o===t)return i;let u=Lt(t/(o+s.length-1)*i);for(;n<=i;){if(s=e[u],o=s.id.clock,o<=t){if(t<o+s.length)return u;n=u+1}else i=u-1;u=Lt((n+i)/2)}throw xt()},pn=(e,t)=>{const n=e.clients.get(t.client);return n[Pt(n,t.clock)]},cr=(e,t,n)=>{const i=Pt(t,n),s=t[i];return s.id.clock<n&&s instanceof rt?(t.splice(i+1,0,An(e,s,n-s.id.clock)),i+1):i},bt=(e,t)=>{const n=e.doc.store.clients.get(t.client);return n[cr(e,n,t.clock)]},Ai=(e,t,n)=>{const i=t.clients.get(n.client),s=Pt(i,n.clock),o=i[s];return n.clock!==o.id.clock+o.length-1&&o.constructor!==Et&&i.splice(s+1,0,An(e,o,n.clock-o.id.clock+1)),o},Wo=(e,t,n)=>{const i=e.clients.get(t.id.client);i[Pt(i,t.id.clock)]=n},Di=(e,t,n,i,s)=>{if(i===0)return;const o=n+i;let u=cr(e,t,n),c;do c=t[u++],o<c.id.clock+c.length&&cr(e,t,o),s(c);while(u<t.length&&t[u].id.clock<o)};class $o{constructor(t,n,i){this.doc=t,this.deleteSet=new be,this.beforeState=gn(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=i,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set}}const Ii=(e,t)=>t.deleteSet.clients.size===0&&!Rs(t.afterState,(n,i)=>t.beforeState.get(i)!==n)?!1:(ir(t.deleteSet),Lo(e,t),_e(e,t.deleteSet),!0),Li=(e,t,n)=>{const i=t._item;(i===null||i.id.clock<(e.beforeState.get(i.id.client)||0)&&!i.deleted)&&St(e.changed,t,te).add(n)},yn=(e,t)=>{const n=e[t-1],i=e[t];n.deleted===i.deleted&&n.constructor===i.constructor&&n.mergeWith(i)&&(e.splice(t,1),i instanceof rt&&i.parentSub!==null&&i.parent._map.get(i.parentSub)===i&&i.parent._map.set(i.parentSub,n))},Yo=(e,t,n)=>{for(const[i,s]of e.clients.entries()){const o=t.clients.get(i);for(let u=s.length-1;u>=0;u--){const c=s[u],l=c.clock+c.len;for(let y=Pt(o,c.clock),w=o[y];y<o.length&&w.id.clock<l;w=o[++y]){const h=o[y];if(c.clock+c.len<=h.id.clock)break;h instanceof rt&&h.deleted&&!h.keep&&n(h)&&h.gc(t,!1)}}}},zo=(e,t)=>{e.clients.forEach((n,i)=>{const s=t.clients.get(i);for(let o=n.length-1;o>=0;o--){const u=n[o],c=Nn(s.length-1,1+Pt(s,u.clock+u.len-1));for(let l=c,y=s[l];l>0&&y.id.clock>=u.clock;y=s[--l])yn(s,l)}})},Mi=(e,t)=>{if(t<e.length){const n=e[t],i=n.doc,s=i.store,o=n.deleteSet,u=n._mergeStructs;try{ir(o),n.afterState=gn(n.doc.store),i.emit("beforeObserverCalls",[n,i]);const c=[];n.changed.forEach((l,y)=>c.push(()=>{(y._item===null||!y._item.deleted)&&y._callObserver(n,l)})),c.push(()=>{n.changedParentTypes.forEach((l,y)=>c.push(()=>{(y._item===null||!y._item.deleted)&&(l=l.filter(w=>w.target._item===null||!w.target._item.deleted),l.forEach(w=>{w.currentTarget=y}),l.sort((w,h)=>w.path.length-h.path.length),ki(y._dEH,l,n))})),c.push(()=>i.emit("afterTransaction",[n,i]))}),Fn(c,[])}finally{i.gc&&Yo(o,s,i.gcFilter),zo(o,s),n.afterState.forEach((w,h)=>{const f=n.beforeState.get(h)||0;if(f!==w){const p=s.clients.get(h),g=ee(Pt(p,f),1);for(let E=p.length-1;E>=g;E--)yn(p,E)}});for(let w=0;w<u.length;w++){const{client:h,clock:f}=u[w].id,p=s.clients.get(h),g=Pt(p,f);g+1<p.length&&yn(p,g+1),g>0&&yn(p,g)}if(!n.local&&n.afterState.get(i.clientID)!==n.beforeState.get(i.clientID)&&(li(hn,vt,"[yjs] ",Yt,Qn,"Changed the client-id because another client seems to be using it."),i.clientID=gi()),i.emit("afterTransactionCleanup",[n,i]),i._observers.has("update")){const w=new Ve;Ii(w,n)&&i.emit("update",[w.toUint8Array(),n.origin,i,n])}if(i._observers.has("updateV2")){const w=new ae;Ii(w,n)&&i.emit("updateV2",[w.toUint8Array(),n.origin,i,n])}const{subdocsAdded:c,subdocsLoaded:l,subdocsRemoved:y}=n;(c.size>0||y.size>0||l.size>0)&&(c.forEach(w=>{w.clientID=i.clientID,w.collectionid==null&&(w.collectionid=i.collectionid),i.subdocs.add(w)}),y.forEach(w=>i.subdocs.delete(w)),i.emit("subdocs",[{loaded:l,added:c,removed:y},i,n]),y.forEach(w=>w.destroy())),e.length<=t+1?(i._transactionCleanups=[],i.emit("afterAllTransactions",[i,e])):Mi(e,t+1)}}},tt=(e,t,n=null,i=!0)=>{const s=e._transactionCleanups;let o=!1;e._transaction===null&&(o=!0,e._transaction=new $o(e,n,i),s.push(e._transaction),s.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{t(e._transaction)}finally{if(o){const u=e._transaction===s[0];e._transaction=null,u&&Mi(s,0)}}};class Go{constructor(t,n){this.insertions=n,this.deletions=t,this.meta=new Map}}const Oi=(e,t,n)=>{oe(e,n.deletions,i=>{i instanceof rt&&t.scope.some(s=>fn(s,i))&&_r(i,!1)})},xi=(e,t,n)=>{let i=null,s=null;const o=e.doc,u=e.scope;if(tt(o,c=>{for(;t.length>0&&i===null;){const l=o.store,y=t.pop(),w=new Set,h=[];let f=!1;oe(c,y.insertions,p=>{if(p instanceof rt){if(p.redone!==null){let{item:g,diff:E}=Pa(l,p.id);E>0&&(g=bt(c,K(g.id.client,g.id.clock+E))),p=g}!p.deleted&&u.some(g=>fn(g,p))&&h.push(p)}}),oe(c,y.deletions,p=>{p instanceof rt&&u.some(g=>fn(g,p))&&!un(y.insertions,p.id)&&w.add(p)}),w.forEach(p=>{f=es(c,p,w,y.insertions,e.ignoreRemoteMapChanges)!==null||f});for(let p=h.length-1;p>=0;p--){const g=h[p];e.deleteFilter(g)&&(g.delete(c),f=!0)}i=f?y:null}c.changed.forEach((l,y)=>{l.has(null)&&y._searchMarker&&(y._searchMarker.length=0)}),s=c},e),i!=null){const c=s.changedParentTypes;e.emit("stack-item-popped",[{stackItem:i,type:n,changedParentTypes:c},e])}return i};class Ul extends ye{constructor(t,{captureTimeout:n=500,captureTransaction:i=l=>!0,deleteFilter:s=()=>!0,trackedOrigins:o=new Set([null]),ignoreRemoteMapChanges:u=!1,doc:c=xr(t)?t[0].doc:t.doc}={}){super();this.scope=[],this.addToScope(t),this.deleteFilter=s,o.add(this),this.trackedOrigins=o,this.captureTransaction=i,this.undoStack=[],this.redoStack=[],this.undoing=!1,this.redoing=!1,this.doc=c,this.lastChange=0,this.ignoreRemoteMapChanges=u,this.captureTimeout=n,this.afterTransactionHandler=l=>{if(!this.captureTransaction(l)||!this.scope.some(I=>l.changedParentTypes.has(I))||!this.trackedOrigins.has(l.origin)&&(!l.origin||!this.trackedOrigins.has(l.origin.constructor)))return;const y=this.undoing,w=this.redoing,h=y?this.redoStack:this.undoStack;y?this.stopCapturing():w||this.clear(!1,!0);const f=new be;l.afterState.forEach((I,O)=>{const F=l.beforeState.get(O)||0,b=I-F;b>0&&je(f,O,F,b)});const p=Ft();let g=!1;if(this.lastChange>0&&p-this.lastChange<this.captureTimeout&&h.length>0&&!y&&!w){const I=h[h.length-1];I.deletions=sr([I.deletions,l.deleteSet]),I.insertions=sr([I.insertions,f])}else h.push(new Go(l.deleteSet,f)),g=!0;!y&&!w&&(this.lastChange=p),oe(l,l.deleteSet,I=>{I instanceof rt&&this.scope.some(O=>fn(O,I))&&_r(I,!0)});const E=[{stackItem:h[h.length-1],origin:l.origin,type:y?"redo":"undo",changedParentTypes:l.changedParentTypes},this];g?this.emit("stack-item-added",E):this.emit("stack-item-updated",E)},this.doc.on("afterTransaction",this.afterTransactionHandler),this.doc.on("destroy",()=>{this.destroy()})}addToScope(t){t=xr(t)?t:[t],t.forEach(n=>{this.scope.every(i=>i!==n)&&this.scope.push(n)})}addTrackedOrigin(t){this.trackedOrigins.add(t)}removeTrackedOrigin(t){this.trackedOrigins.delete(t)}clear(t=!0,n=!0){(t&&this.canUndo()||n&&this.canRedo())&&this.doc.transact(i=>{t&&(this.undoStack.forEach(s=>Oi(i,this,s)),this.undoStack=[]),n&&(this.redoStack.forEach(s=>Oi(i,this,s)),this.redoStack=[]),this.emit("stack-cleared",[{undoStackCleared:t,redoStackCleared:n}])})}stopCapturing(){this.lastChange=0}undo(){this.undoing=!0;let t;try{t=xi(this,this.undoStack,"undo")}finally{this.undoing=!1}return t}redo(){this.redoing=!0;let t;try{t=xi(this,this.redoStack,"redo")}finally{this.redoing=!1}return t}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}destroy(){this.trackedOrigins.delete(this),this.doc.off("afterTransaction",this.afterTransactionHandler),super.destroy()}}function*Jo(e){const t=J(e.restDecoder);for(let n=0;n<t;n++){const i=J(e.restDecoder),s=e.readClient();let o=J(e.restDecoder);for(let u=0;u<i;u++){const c=e.readInfo();if(c===10){const l=J(e.restDecoder);yield new Ct(K(s,o),l),o+=l}else if((rn&c)!==0){const l=(c&(jt|_t))===0,y=new rt(K(s,o),null,(c&_t)===_t?e.readLeftID():null,null,(c&jt)===jt?e.readRightID():null,l?e.readParentInfo()?e.readString():e.readLeftID():null,l&&(c&Ue)===Ue?e.readString():null,ns(e,c));yield y,o+=y.length}else{const l=e.readLen();yield new Et(K(s,o),l),o+=l}}}}class hr{constructor(t,n){this.gen=Jo(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===Ct);return this.curr}}class ur{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const Ko=e=>mn(e,yi,Ve),Xo=(e,t)=>{if(e.constructor===Et){const{client:n,clock:i}=e.id;return new Et(K(n,i+t),e.length-t)}else if(e.constructor===Ct){const{client:n,clock:i}=e.id;return new Ct(K(n,i+t),e.length-t)}else{const n=e,{client:i,clock:s}=n.id;return new rt(K(i,s+t),null,K(i,s+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},mn=(e,t=Se,n=ae)=>{if(e.length===1)return e[0];const i=e.map(w=>new t(Nt(w)));let s=i.map(w=>new hr(w,!0)),o=null;const u=new n,c=new ur(u);for(;s=s.filter(f=>f.curr!==null),s.sort((f,p)=>{if(f.curr.id.client===p.curr.id.client){const g=f.curr.id.clock-p.curr.id.clock;return g===0?f.curr.constructor===p.curr.constructor?0:f.curr.constructor===Ct?1:-1:g}else return p.curr.id.client-f.curr.id.client}),s.length!==0;){const w=s[0],h=w.curr.id.client;if(o!==null){let f=w.curr,p=!1;for(;f!==null&&f.id.clock+f.length<=o.struct.id.clock+o.struct.length&&f.id.client>=o.struct.id.client;)f=w.next(),p=!0;if(f===null||f.id.client!==h||p&&f.id.clock>o.struct.id.clock+o.struct.length)continue;if(h!==o.struct.id.client)zt(c,o.struct,o.offset),o={struct:f,offset:0},w.next();else if(o.struct.id.clock+o.struct.length<f.id.clock)if(o.struct.constructor===Ct)o.struct.length=f.id.clock+f.length-o.struct.id.clock;else{zt(c,o.struct,o.offset);const g=f.id.clock-o.struct.id.clock-o.struct.length;o={struct:new Ct(K(h,o.struct.id.clock+o.struct.length),g),offset:0}}else{const g=o.struct.id.clock+o.struct.length-f.id.clock;g>0&&(o.struct.constructor===Ct?o.struct.length-=g:f=Xo(f,g)),o.struct.mergeWith(f)||(zt(c,o.struct,o.offset),o={struct:f,offset:0},w.next())}}else o={struct:w.curr,offset:0},w.next();for(let f=w.curr;f!==null&&f.id.client===h&&f.id.clock===o.struct.id.clock+o.struct.length&&f.constructor!==Ct;f=w.next())zt(c,o.struct,o.offset),o={struct:f,offset:0}}o!==null&&(zt(c,o.struct,o.offset),o=null),dr(c);const l=i.map(w=>or(w)),y=sr(l);return _e(u,y),u.toUint8Array()},Zo=(e,t,n=Se,i=ae)=>{const s=_i(t),o=new i,u=new ur(o),c=new n(Nt(e)),l=new hr(c,!1);for(;l.curr;){const w=l.curr,h=w.id.client,f=s.get(h)||0;if(l.curr.constructor===Ct){l.next();continue}if(w.id.clock+w.length>f)for(zt(u,w,ee(f-w.id.clock,0)),l.next();l.curr&&l.curr.id.client===h;)zt(u,l.curr,0),l.next();else for(;l.curr&&l.curr.id.client===h&&l.curr.id.clock+l.curr.length<=f;)l.next()}dr(u);const y=or(c);return _e(o,y),o.toUint8Array()},Ni=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:st(e.encoder.restEncoder)}),e.encoder.restEncoder=gt(),e.written=0)},zt=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&Ni(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),H(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},dr=e=>{Ni(e);const t=e.encoder.restEncoder;H(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){const i=e.clientStructs[n];H(t,i.written),an(t,i.restEncoder)}},Qo=(e,t,n)=>{const i=new t(Nt(e)),s=new hr(i,!1),o=new n,u=new ur(o);for(let l=s.curr;l!==null;l=s.next())zt(u,l,0);dr(u);const c=or(i);return _e(o,c),o.toUint8Array()},ta=e=>Qo(e,Se,Ve);class wn{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null}get path(){return ea(this.currentTarget,this.target)}deletes(t){return un(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){const t=new Map,n=this.target;this.transaction.changed.get(n).forEach(s=>{if(s!==null){const o=n._map.get(s);let u,c;if(this.adds(o)){let l=o.left;for(;l!==null&&this.adds(l);)l=l.left;if(this.deletes(o))if(l!==null&&this.deletes(l))u="delete",c=xn(l.content.getContent());else return;else l!==null&&this.deletes(l)?(u="update",c=xn(l.content.getContent())):(u="add",c=void 0)}else if(this.deletes(o))u="delete",c=xn(o.content.getContent());else return;t.set(s,{action:u,oldValue:c})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){const n=this.target,i=te(),s=te(),o=[];if(t={added:i,deleted:s,delta:o,keys:this.keys},this.transaction.changed.get(n).has(null)){let c=null;const l=()=>{c&&o.push(c)};for(let y=n._start;y!==null;y=y.right)y.deleted?this.deletes(y)&&!this.adds(y)&&((c===null||c.delete===void 0)&&(l(),c={delete:0}),c.delete+=y.length,s.add(y)):this.adds(y)?((c===null||c.insert===void 0)&&(l(),c={insert:[]}),c.insert=c.insert.concat(y.content.getContent()),i.add(y)):((c===null||c.retain===void 0)&&(l(),c={retain:0}),c.retain+=y.length);c!==null&&c.retain===void 0&&l()}this._changes=t}return t}}const ea=(e,t)=>{const n=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)n.unshift(t._item.parentSub);else{let i=0,s=t._item.parent._start;for(;s!==t._item&&s!==null;)s.deleted||i++,s=s.right;n.unshift(i)}t=t._item.parent}return n},Ui=80;let fr=0;class na{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=fr++}}const ra=e=>{e.timestamp=fr++},Fi=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=fr++},ia=(e,t,n)=>{if(e.length>=Ui){const i=e.reduce((s,o)=>s.timestamp<o.timestamp?s:o);return Fi(i,t,n),i}else{const i=new na(t,n);return e.push(i),i}},bn=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const n=e._searchMarker.length===0?null:e._searchMarker.reduce((o,u)=>tn(t-o.index)<tn(t-u.index)?o:u);let i=e._start,s=0;for(n!==null&&(i=n.p,s=n.index,ra(n));i.right!==null&&s<t;){if(!i.deleted&&i.countable){if(t<s+i.length)break;s+=i.length}i=i.right}for(;i.left!==null&&s>t;)i=i.left,!i.deleted&&i.countable&&(s-=i.length);for(;i.left!==null&&i.left.id.client===i.id.client&&i.left.id.clock+i.left.length===i.id.clock;)i=i.left,!i.deleted&&i.countable&&(s-=i.length);return n!==null&&tn(n.index-s)<i.parent.length/Ui?(Fi(n,i,s),n):ia(e._searchMarker,i,s)},He=(e,t,n)=>{for(let i=e.length-1;i>=0;i--){const s=e[i];if(n>0){let o=s.p;for(o.marker=!1;o&&(o.deleted||!o.countable);)o=o.left,o&&!o.deleted&&o.countable&&(s.index-=o.length);if(o===null||o.marker===!0){e.splice(i,1);continue}s.p=o,o.marker=!0}(t<s.index||n>0&&t===s.index)&&(s.index=ee(t,s.index+n))}},_n=(e,t,n)=>{const i=e,s=t.changedParentTypes;for(;St(s,e,()=>[]).push(n),e._item!==null;)e=e._item.parent;ki(i._eH,n,t)};class mt{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Si(),this._dEH=Si(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw Ot()}clone(){throw Ot()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){Ei(this._eH,t)}observeDeep(t){Ei(this._dEH,t)}unobserve(t){Ci(this._eH,t)}unobserveDeep(t){Ci(this._dEH,t)}toJSON(){}}const Pi=(e,t,n)=>{t<0&&(t=e._length+t),n<0&&(n=e._length+n);let i=n-t;const s=[];let o=e._start;for(;o!==null&&i>0;){if(o.countable&&!o.deleted){const u=o.content.getContent();if(u.length<=t)t-=u.length;else{for(let c=t;c<u.length&&i>0;c++)s.push(u[c]),i--;t=0}}o=o.right}return s},Bi=e=>{const t=[];let n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){const i=n.content.getContent();for(let s=0;s<i.length;s++)t.push(i[s])}n=n.right}return t},We=(e,t)=>{let n=0,i=e._start;for(;i!==null;){if(i.countable&&!i.deleted){const s=i.content.getContent();for(let o=0;o<s.length;o++)t(s[o],n++,e)}i=i.right}},ji=(e,t)=>{const n=[];return We(e,(i,s)=>{n.push(t(i,s,e))}),n},sa=e=>{let t=e._start,n=null,i=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};n=t.content.getContent(),i=0,t=t.right}const s=n[i++];return n.length<=i&&(n=null),{done:!1,value:s}}}},Vi=(e,t)=>{const n=bn(e,t);let i=e._start;for(n!==null&&(i=n.p,t-=n.index);i!==null;i=i.right)if(!i.deleted&&i.countable){if(t<i.length)return i.content.getContent()[t];t-=i.length}},vn=(e,t,n,i)=>{let s=n;const o=e.doc,u=o.clientID,c=o.store,l=n===null?t._start:n.right;let y=[];const w=()=>{y.length>0&&(s=new rt(K(u,ht(c,u)),s,s&&s.lastId,l,l&&l.id,t,null,new he(y)),s.integrate(e,0),y=[])};i.forEach(h=>{if(h===null)y.push(h);else switch(h.constructor){case Number:case Object:case Boolean:case Array:case String:y.push(h);break;default:switch(w(),h.constructor){case Uint8Array:case ArrayBuffer:s=new rt(K(u,ht(c,u)),s,s&&s.lastId,l,l&&l.id,t,null,new Ye(new Uint8Array(h))),s.integrate(e,0);break;case ve:s=new rt(K(u,ht(c,u)),s,s&&s.lastId,l,l&&l.id,t,null,new Ge(h)),s.integrate(e,0);break;default:if(h instanceof mt)s=new rt(K(u,ht(c,u)),s,s&&s.lastId,l,l&&l.id,t,null,new Wt(h)),s.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),w()},qi=$t("Length exceeded!"),Hi=(e,t,n,i)=>{if(n>t._length)throw qi;if(n===0)return t._searchMarker&&He(t._searchMarker,n,i.length),vn(e,t,null,i);const s=n,o=bn(t,n);let u=t._start;for(o!==null&&(u=o.p,n-=o.index,n===0&&(u=u.prev,n+=u&&u.countable&&!u.deleted?u.length:0));u!==null;u=u.right)if(!u.deleted&&u.countable){if(n<=u.length){n<u.length&&bt(e,K(u.id.client,u.id.clock+n));break}n-=u.length}return t._searchMarker&&He(t._searchMarker,s,i.length),vn(e,t,u,i)},oa=(e,t,n)=>{let s=(t._searchMarker||[]).reduce((o,u)=>u.index>o.index?u:o,{index:0,p:t._start}).p;if(s)for(;s.right;)s=s.right;return vn(e,t,s,n)},Wi=(e,t,n,i)=>{if(i===0)return;const s=n,o=i,u=bn(t,n);let c=t._start;for(u!==null&&(c=u.p,n-=u.index);c!==null&&n>0;c=c.right)!c.deleted&&c.countable&&(n<c.length&&bt(e,K(c.id.client,c.id.clock+n)),n-=c.length);for(;i>0&&c!==null;)c.deleted||(i<c.length&&bt(e,K(c.id.client,c.id.clock+i)),c.delete(e),i-=c.length),c=c.right;if(i>0)throw qi;t._searchMarker&&He(t._searchMarker,s,-o+i)},Sn=(e,t,n)=>{const i=t._map.get(n);i!==void 0&&i.delete(e)},gr=(e,t,n,i)=>{const s=t._map.get(n)||null,o=e.doc,u=o.clientID;let c;if(i==null)c=new he([i]);else switch(i.constructor){case Number:case Object:case Boolean:case Array:case String:c=new he([i]);break;case Uint8Array:c=new Ye(i);break;case ve:c=new Ge(i);break;default:if(i instanceof mt)c=new Wt(i);else throw new Error("Unexpected content type")}new rt(K(u,ht(o.store,u)),s,s&&s.lastId,null,null,t,n,c).integrate(e,0)},pr=(e,t)=>{const n=e._map.get(t);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},$i=e=>{const t={};return e._map.forEach((n,i)=>{n.deleted||(t[i]=n.content.getContent()[n.length-1])}),t},Yi=(e,t)=>{const n=e._map.get(t);return n!==void 0&&!n.deleted},En=e=>Co(e.entries(),t=>!t[1].deleted);class aa extends wn{constructor(t,n){super(t,n);this._transaction=n}}class Ce extends mt{constructor(){super();this._prelimContent=[],this._searchMarker=[]}static from(t){const n=new Ce;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Ce}clone(){const t=new Ce;return t.insert(0,this.toArray().map(n=>n instanceof mt?n.clone():n)),t}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(t,n){super._callObserver(t,n),_n(this,t,new aa(this,t))}insert(t,n){this.doc!==null?tt(this.doc,i=>{Hi(i,this,t,n)}):this._prelimContent.splice(t,0,...n)}push(t){this.doc!==null?tt(this.doc,n=>{oa(n,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){this.doc!==null?tt(this.doc,i=>{Wi(i,this,t,n)}):this._prelimContent.splice(t,n)}get(t){return Vi(this,t)}toArray(){return Bi(this)}slice(t=0,n=this.length){return Pi(this,t,n)}toJSON(){return this.map(t=>t instanceof mt?t.toJSON():t)}map(t){return ji(this,t)}forEach(t){We(this,t)}[Symbol.iterator](){return sa(this)}_write(t){t.writeTypeRef(Ia)}}const la=e=>new Ce;class ca extends wn{constructor(t,n,i){super(t,n);this.keysChanged=i}}class ke extends mt{constructor(t){super();this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach((i,s)=>{this.set(s,i)}),this._prelimContent=null}_copy(){return new ke}clone(){const t=new ke;return this.forEach((n,i)=>{t.set(i,n instanceof mt?n.clone():n)}),t}_callObserver(t,n){_n(this,t,new ca(this,t,n))}toJSON(){const t={};return this._map.forEach((n,i)=>{if(!n.deleted){const s=n.content.getContent()[n.length-1];t[i]=s instanceof mt?s.toJSON():s}}),t}get size(){return[...En(this._map)].length}keys(){return nr(En(this._map),t=>t[0])}values(){return nr(En(this._map),t=>t[1].content.getContent()[t[1].length-1])}entries(){return nr(En(this._map),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this._map.forEach((n,i)=>{n.deleted||t(n.content.getContent()[n.length-1],i,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?tt(this.doc,n=>{Sn(n,this,t)}):this._prelimContent.delete(t)}set(t,n){return this.doc!==null?tt(this.doc,i=>{gr(i,this,t,n)}):this._prelimContent.set(t,n),n}get(t){return pr(this,t)}has(t){return Yi(this,t)}clear(){this.doc!==null?tt(this.doc,t=>{this.forEach(function(n,i,s){Sn(t,s,i)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(La)}}const ha=e=>new ke,Gt=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&Bs(e,t);class yr{constructor(t,n,i,s){this.left=t,this.right=n,this.index=i,this.currentAttributes=s}forward(){switch(this.right===null&&xt(),this.right.content.constructor){case ut:this.right.deleted||Re(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const zi=(e,t,n)=>{for(;t.right!==null&&n>0;){switch(t.right.content.constructor){case ut:t.right.deleted||Re(t.currentAttributes,t.right.content);break;default:t.right.deleted||(n<t.right.length&&bt(e,K(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},Cn=(e,t,n)=>{const i=new Map,s=bn(t,n);if(s){const o=new yr(s.p.left,s.p,s.index,i);return zi(e,o,n-s.index)}else{const o=new yr(null,t._start,0,i);return zi(e,o,n)}},Gi=(e,t,n,i)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===ut&&Gt(i.get(n.right.content.key),n.right.content.value));)n.right.deleted||i.delete(n.right.content.key),n.forward();const s=e.doc,o=s.clientID;i.forEach((u,c)=>{const l=n.left,y=n.right,w=new rt(K(o,ht(s.store,o)),l,l&&l.lastId,y,y&&y.id,t,null,new ut(c,u));w.integrate(e,0),n.right=w,n.forward()})},Re=(e,t)=>{const{key:n,value:i}=t;i===null?e.delete(n):e.set(n,i)},Ji=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===ut&&Gt(t[e.right.content.key]||null,e.right.content.value)))break;e.forward()}},Ki=(e,t,n,i)=>{const s=e.doc,o=s.clientID,u=new Map;for(const c in i){const l=i[c],y=n.currentAttributes.get(c)||null;if(!Gt(y,l)){u.set(c,y);const{left:w,right:h}=n;n.right=new rt(K(o,ht(s.store,o)),w,w&&w.lastId,h,h&&h.id,t,null,new ut(c,l)),n.right.integrate(e,0),n.forward()}}return u},mr=(e,t,n,i,s)=>{n.currentAttributes.forEach((f,p)=>{s[p]===void 0&&(s[p]=null)});const o=e.doc,u=o.clientID;Ji(n,s);const c=Ki(e,t,n,s),l=i.constructor===String?new Bt(i):i instanceof mt?new Wt(i):new ce(i);let{left:y,right:w,index:h}=n;t._searchMarker&&He(t._searchMarker,n.index,l.getLength()),w=new rt(K(u,ht(o.store,u)),y,y&&y.lastId,w,w&&w.id,t,null,l),w.integrate(e,0),n.right=w,n.index=h,n.forward(),Gi(e,t,n,c)},Xi=(e,t,n,i,s)=>{const o=e.doc,u=o.clientID;Ji(n,s);const c=Ki(e,t,n,s);t:for(;n.right!==null&&(i>0||c.size>0&&(n.right.deleted||n.right.content.constructor===ut));){if(!n.right.deleted)switch(n.right.content.constructor){case ut:{const{key:l,value:y}=n.right.content,w=s[l];if(w!==void 0){if(Gt(w,y))c.delete(l);else{if(i===0)break t;c.set(l,y)}n.right.delete(e)}else n.currentAttributes.set(l,y);break}default:i<n.right.length&&bt(e,K(n.right.id.client,n.right.id.clock+i)),i-=n.right.length;break}n.forward()}if(i>0){let l="";for(;i>0;i--)l+=`
`;n.right=new rt(K(u,ht(o.store,u)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new Bt(l)),n.right.integrate(e,0),n.forward()}Gi(e,t,n,c)},Zi=(e,t,n,i,s)=>{let o=n;const u=Qe(s);for(;o&&(!o.countable||o.deleted);)!o.deleted&&o.content.constructor===ut&&Re(u,o.content),o=o.right;let c=0,l=!1;for(;t!==o;){if(n===t&&(l=!0),!t.deleted){const y=t.content;switch(y.constructor){case ut:{const{key:w,value:h}=y,f=i.get(w)||null;((u.get(w)||null)!==h||f===h)&&(t.delete(e),c++,!l&&(s.get(w)||null)===h&&(i.get(w)||null)!==h&&(f===null?s.delete(w):s.set(w,f)));break}}}t=t.right}return c},ua=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===ut){const i=t.content.key;n.has(i)?t.delete(e):n.add(i)}t=t.left}},da=e=>{let t=0;return tt(e.doc,n=>{let i=e._start,s=e._start,o=ct();const u=Qe(o);for(;s;){if(s.deleted===!1)switch(s.content.constructor){case ut:Re(u,s.content);break;default:t+=Zi(n,i,s,o,u),o=Qe(u),i=s;break}s=s.right}}),t},Qi=(e,t,n)=>{const i=n,s=Qe(t.currentAttributes),o=t.right;for(;n>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case Wt:case ce:case Bt:n<t.right.length&&bt(e,K(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}o&&Zi(e,o,t.right,s,t.currentAttributes);const u=(t.left||t.right).parent;return u._searchMarker&&He(u._searchMarker,t.index,-i+n),t};class fa extends wn{constructor(t,n,i){super(t,n);this.childListChanged=!1,this.keysChanged=new Set,i.forEach(s=>{s===null?this.childListChanged=!0:this.keysChanged.add(s)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,n=[];tt(t,i=>{const s=new Map,o=new Map;let u=this.target._start,c=null;const l={};let y="",w=0,h=0;const f=()=>{if(c!==null){let p;switch(c){case"delete":p={delete:h},h=0;break;case"insert":p={insert:y},s.size>0&&(p.attributes={},s.forEach((g,E)=>{g!==null&&(p.attributes[E]=g)})),y="";break;case"retain":if(p={retain:w},Object.keys(l).length>0){p.attributes={};for(const g in l)p.attributes[g]=l[g]}w=0;break}n.push(p),c=null}};for(;u!==null;){switch(u.content.constructor){case Wt:case ce:this.adds(u)?this.deletes(u)||(f(),c="insert",y=u.content.getContent()[0],f()):this.deletes(u)?(c!=="delete"&&(f(),c="delete"),h+=1):u.deleted||(c!=="retain"&&(f(),c="retain"),w+=1);break;case Bt:this.adds(u)?this.deletes(u)||(c!=="insert"&&(f(),c="insert"),y+=u.content.str):this.deletes(u)?(c!=="delete"&&(f(),c="delete"),h+=u.length):u.deleted||(c!=="retain"&&(f(),c="retain"),w+=u.length);break;case ut:{const{key:p,value:g}=u.content;if(this.adds(u)){if(!this.deletes(u)){const E=s.get(p)||null;Gt(E,g)?g!==null&&u.delete(i):(c==="retain"&&f(),Gt(g,o.get(p)||null)?delete l[p]:l[p]=g)}}else if(this.deletes(u)){o.set(p,g);const E=s.get(p)||null;Gt(E,g)||(c==="retain"&&f(),l[p]=E)}else if(!u.deleted){o.set(p,g);const E=l[p];E!==void 0&&(Gt(E,g)?E!==null&&u.delete(i):(c==="retain"&&f(),g===null?delete l[p]:l[p]=g))}u.deleted||(c==="insert"&&f(),Re(s,u.content));break}}u=u.right}for(f();n.length>0;){const p=n[n.length-1];if(p.retain!==void 0&&p.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class Te extends mt{constructor(t){super();this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[]}get length(){return this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach(i=>i())}catch(i){console.error(i)}this._pending=null}_copy(){return new Te}clone(){const t=new Te;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);const i=new fa(this,t,n),s=t.doc;if(_n(this,t,i),!t.local){let o=!1;for(const[u,c]of t.afterState.entries()){const l=t.beforeState.get(u)||0;if(c!==l&&(Di(t,s.store.clients.get(u),l,c,y=>{!y.deleted&&y.content.constructor===ut&&(o=!0)}),o))break}o||oe(t,t.deleteSet,u=>{u instanceof Et||o||u.parent===this&&u.content.constructor===ut&&(o=!0)}),tt(s,u=>{o?da(this):oe(u,u.deleteSet,c=>{c instanceof Et||c.parent===this&&ua(u,c)})})}}toString(){let t="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Bt&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){this.doc!==null?tt(this.doc,i=>{const s=new yr(null,this._start,0,new Map);for(let o=0;o<t.length;o++){const u=t[o];if(u.insert!==void 0){const c=!n&&typeof u.insert=="string"&&o===t.length-1&&s.right===null&&u.insert.slice(-1)===`
`?u.insert.slice(0,-1):u.insert;(typeof c!="string"||c.length>0)&&mr(i,this,s,c,u.attributes||{})}else u.retain!==void 0?Xi(i,this,s,u.retain,u.attributes||{}):u.delete!==void 0&&Qi(i,s,u.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,n,i){const s=[],o=new Map,u=this.doc;let c="",l=this._start;function y(){if(c.length>0){const w={};let h=!1;o.forEach((p,g)=>{h=!0,w[g]=p});const f={insert:c};h&&(f.attributes=w),s.push(f),c=""}}return tt(u,w=>{for(t&&lr(w,t),n&&lr(w,n);l!==null;){if(qe(l,t)||n!==void 0&&qe(l,n))switch(l.content.constructor){case Bt:{const h=o.get("ychange");t!==void 0&&!qe(l,t)?(h===void 0||h.user!==l.id.client||h.type!=="removed")&&(y(),o.set("ychange",i?i("removed",l.id):{type:"removed"})):n!==void 0&&!qe(l,n)?(h===void 0||h.user!==l.id.client||h.type!=="added")&&(y(),o.set("ychange",i?i("added",l.id):{type:"added"})):h!==void 0&&(y(),o.delete("ychange")),c+=l.content.str;break}case Wt:case ce:{y();const h={insert:l.content.getContent()[0]};if(o.size>0){const f={};h.attributes=f,o.forEach((p,g)=>{f[g]=p})}s.push(h);break}case ut:qe(l,t)&&(y(),Re(o,l.content));break}l=l.right}y()},"cleanup"),s}insert(t,n,i){if(n.length<=0)return;const s=this.doc;s!==null?tt(s,o=>{const u=Cn(o,this,t);i||(i={},u.currentAttributes.forEach((c,l)=>{i[l]=c})),mr(o,this,u,n,i)}):this._pending.push(()=>this.insert(t,n,i))}insertEmbed(t,n,i={}){const s=this.doc;s!==null?tt(s,o=>{const u=Cn(o,this,t);mr(o,this,u,n,i)}):this._pending.push(()=>this.insertEmbed(t,n,i))}delete(t,n){if(n===0)return;const i=this.doc;i!==null?tt(i,s=>{Qi(s,Cn(s,this,t),n)}):this._pending.push(()=>this.delete(t,n))}format(t,n,i){if(n===0)return;const s=this.doc;s!==null?tt(s,o=>{const u=Cn(o,this,t);u.right!==null&&Xi(o,this,u,n,i)}):this._pending.push(()=>this.format(t,n,i))}removeAttribute(t){this.doc!==null?tt(this.doc,n=>{Sn(n,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,n){this.doc!==null?tt(this.doc,i=>{gr(i,this,t,n)}):this._pending.push(()=>this.setAttribute(t,n))}getAttribute(t){return pr(this,t)}getAttributes(){return $i(this)}_write(t){t.writeTypeRef(Ma)}}const ga=e=>new Te;class wr{constructor(t,n=()=>!0){this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(n)))do if(n=t.content.type,!t.deleted&&(n.constructor===$e||n.constructor===le)&&n._start!==null)t=n._start;else for(;t!==null;)if(t.right!==null){t=t.right;break}else t.parent===this._root?t=null:t=t.parent._item;while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class le extends mt{constructor(){super();this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new le}clone(){const t=new le;return t.insert(0,this.toArray().map(n=>n instanceof mt?n.clone():n)),t}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new wr(this,t)}querySelector(t){t=t.toUpperCase();const i=new wr(this,s=>s.nodeName&&s.nodeName.toUpperCase()===t).next();return i.done?null:i.value}querySelectorAll(t){return t=t.toUpperCase(),Array.from(new wr(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t))}_callObserver(t,n){_n(this,t,new ma(this,n,t))}toString(){return ji(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},i){const s=t.createDocumentFragment();return i!==void 0&&i._createAssociation(s,this),We(this,o=>{s.insertBefore(o.toDOM(t,n,i),null)}),s}insert(t,n){this.doc!==null?tt(this.doc,i=>{Hi(i,this,t,n)}):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(this.doc!==null)tt(this.doc,i=>{const s=t&&t instanceof mt?t._item:t;vn(i,this,s,n)});else{const i=this._prelimContent,s=t===null?0:i.findIndex(o=>o===t)+1;if(s===0&&t!==null)throw $t("Reference item not found");i.splice(s,0,...n)}}delete(t,n=1){this.doc!==null?tt(this.doc,i=>{Wi(i,this,t,n)}):this._prelimContent.splice(t,n)}toArray(){return Bi(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return Vi(this,t)}slice(t=0,n=this.length){return Pi(this,t,n)}forEach(t){We(this,t)}_write(t){t.writeTypeRef(xa)}}const pa=e=>new le;class $e extends le{constructor(t="UNDEFINED"){super();this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach((i,s)=>{this.setAttribute(s,i)}),this._prelimAttrs=null}_copy(){return new $e(this.nodeName)}clone(){const t=new $e(this.nodeName),n=this.getAttributes();for(const i in n)t.setAttribute(i,n[i]);return t.insert(0,this.toArray().map(i=>i instanceof mt?i.clone():i)),t}toString(){const t=this.getAttributes(),n=[],i=[];for(const c in t)i.push(c);i.sort();const s=i.length;for(let c=0;c<s;c++){const l=i[c];n.push(l+'="'+t[l]+'"')}const o=this.nodeName.toLocaleLowerCase(),u=n.length>0?" "+n.join(" "):"";return`<${o}${u}>${super.toString()}</${o}>`}removeAttribute(t){this.doc!==null?tt(this.doc,n=>{Sn(n,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,n){this.doc!==null?tt(this.doc,i=>{gr(i,this,t,n)}):this._prelimAttrs.set(t,n)}getAttribute(t){return pr(this,t)}hasAttribute(t){return Yi(this,t)}getAttributes(){return $i(this)}toDOM(t=document,n={},i){const s=t.createElement(this.nodeName),o=this.getAttributes();for(const u in o)s.setAttribute(u,o[u]);return We(this,u=>{s.appendChild(u.toDOM(t,n,i))}),i!==void 0&&i._createAssociation(s,this),s}_write(t){t.writeTypeRef(Oa),t.writeKey(this.nodeName)}}const ya=e=>new $e(e.readKey());class ma extends wn{constructor(t,n,i){super(t,i);this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(s=>{s===null?this.childListChanged=!0:this.attributesChanged.add(s)})}}class kn extends ke{constructor(t){super();this.hookName=t}_copy(){return new kn(this.hookName)}clone(){const t=new kn(this.hookName);return this.forEach((n,i)=>{t.set(i,n)}),t}toDOM(t=document,n={},i){const s=n[this.hookName];let o;return s!==void 0?o=s.createDom(this):o=document.createElement(this.hookName),o.setAttribute("data-yjs-hook",this.hookName),i!==void 0&&i._createAssociation(o,this),o}_write(t){t.writeTypeRef(Na),t.writeKey(this.hookName)}}const wa=e=>new kn(e.readKey());class Rn extends Te{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new Rn}clone(){const t=new Rn;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,i){const s=t.createTextNode(this.toString());return i!==void 0&&i._createAssociation(s,this),s}toString(){return this.toDelta().map(t=>{const n=[];for(const s in t.attributes){const o=[];for(const u in t.attributes[s])o.push({key:u,value:t.attributes[s][u]});o.sort((u,c)=>u.key<c.key?-1:1),n.push({nodeName:s,attrs:o})}n.sort((s,o)=>s.nodeName<o.nodeName?-1:1);let i="";for(let s=0;s<n.length;s++){const o=n[s];i+=`<${o.nodeName}`;for(let u=0;u<o.attrs.length;u++){const c=o.attrs[u];i+=` ${c.key}="${c.value}"`}i+=">"}i+=t.insert;for(let s=n.length-1;s>=0;s--)i+=`</${n[s].nodeName}>`;return i}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(Ua)}}const ba=e=>new Rn;class br{constructor(t,n){this.id=t,this.length=n}get deleted(){throw Ot()}mergeWith(t){return!1}write(t,n,i){throw Ot()}integrate(t,n){throw Ot()}}const _a=0;class Et extends br{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),Ti(t.doc.store,this)}write(t,n){t.writeInfo(_a),t.writeLen(this.length-n)}getMissing(t,n){return null}}class Ye{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Ye(this.content)}splice(t){throw Ot()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}}const va=e=>new Ye(e.readBuf());class ze{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new ze(this.len)}splice(t){const n=new ze(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){je(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}}const Sa=e=>new ze(e.readLen()),ts=(e,t)=>new ve(On(pe({guid:e},t),{shouldLoad:t.shouldLoad||t.autoLoad||!1}));class Ge{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),t.meta!==null&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Ge(ts(this.doc.guid,this.opts))}splice(t){throw Ot()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const Ea=e=>new Ge(ts(e.readString(),e.readAny()));class ce{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new ce(this.embed)}splice(t){throw Ot()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}}const Ca=e=>new ce(e.readJSON());class ut{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new ut(this.key,this.value)}splice(t){throw Ot()}mergeWith(t){return!1}integrate(t,n){n.parent._searchMarker=null}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const ka=e=>new ut(e.readKey(),e.readJSON());class Tn{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Tn(this.arr)}splice(t){const n=new Tn(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const i=this.arr.length;t.writeLen(i-n);for(let s=n;s<i;s++){const o=this.arr[s];t.writeString(o===void 0?"undefined":JSON.stringify(o))}}getRef(){return 2}}const Ra=e=>{const t=e.readLen(),n=[];for(let i=0;i<t;i++){const s=e.readString();s==="undefined"?n.push(void 0):n.push(JSON.parse(s))}return new Tn(n)};class he{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new he(this.arr)}splice(t){const n=new he(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const i=this.arr.length;t.writeLen(i-n);for(let s=n;s<i;s++){const o=this.arr[s];t.writeAny(o)}}getRef(){return 8}}const Ta=e=>{const t=e.readLen(),n=[];for(let i=0;i<t;i++)n.push(e.readAny());return new he(n)};class Bt{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Bt(this.str)}splice(t){const n=new Bt(this.str.slice(t));this.str=this.str.slice(0,t);const i=this.str.charCodeAt(t-1);return i>=55296&&i<=56319&&(this.str=this.str.slice(0,t-1)+"\uFFFD",n.str="\uFFFD"+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const Aa=e=>new Bt(e.readString()),Da=[la,ha,ga,ya,pa,wa,ba],Ia=0,La=1,Ma=2,Oa=3,xa=4,Na=5,Ua=6;class Wt{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Wt(this.type._copy())}splice(t){throw Ot()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;n!==null;)n.deleted?t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach(i=>{i.deleted?t._mergeStructs.push(i):i.delete(t)}),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;n!==null;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach(i=>{for(;i!==null;)i.gc(t,!0),i=i.left}),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}}const Fa=e=>new Wt(Da[e.readTypeRef()](e)),Pa=(e,t)=>{let n=t,i=0,s;do i>0&&(n=K(n.client,n.clock+i)),s=pn(e,n),i=n.clock-s.id.clock,n=s.redone;while(n!==null&&s instanceof rt);return{item:s,diff:i}},_r=(e,t)=>{for(;e!==null&&e.keep!==t;)e.keep=t,e=e.parent._item},An=(e,t,n)=>{const{client:i,clock:s}=t.id,o=new rt(K(i,s+n),t,K(i,s+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&o.markDeleted(),t.keep&&(o.keep=!0),t.redone!==null&&(o.redone=K(t.redone.client,t.redone.clock+n)),t.right=o,o.right!==null&&(o.right.left=o),e._mergeStructs.push(o),o.parentSub!==null&&o.right===null&&o.parent._map.set(o.parentSub,o),t.length=n,o},es=(e,t,n,i,s)=>{const o=e.doc,u=o.store,c=o.clientID,l=t.redone;if(l!==null)return bt(e,l);let y=t.parent._item,w=null,h;if(y!==null&&y.deleted===!0){if(y.redone===null&&(!n.has(y)||es(e,y,n,i,s)===null))return null;for(;y.redone!==null;)y=bt(e,y.redone)}const f=y===null?t.parent:y.content.type;if(t.parentSub===null){for(w=t.left,h=t;w!==null;){let I=w;for(;I!==null&&I.parent._item!==y;)I=I.redone===null?null:bt(e,I.redone);if(I!==null&&I.parent._item===y){w=I;break}w=w.left}for(;h!==null;){let I=h;for(;I!==null&&I.parent._item!==y;)I=I.redone===null?null:bt(e,I.redone);if(I!==null&&I.parent._item===y){h=I;break}h=h.right}}else if(h=null,t.right&&!s){for(w=t;w!==null&&w.right!==null&&un(i,w.right.id);)w=w.right;for(;w!==null&&w.redone!==null;)w=bt(e,w.redone);if(w&&w.right!==null)return null}else w=f._map.get(t.parentSub)||null;const p=ht(u,c),g=K(c,p),E=new rt(g,w,w&&w.lastId,h,h&&h.id,f,t.parentSub,t.content.copy());return t.redone=g,_r(E,!0),E.integrate(e,0),E};class rt extends br{constructor(t,n,i,s,o,u,c,l){super(t,l.getLength());this.origin=i,this.left=n,this.right=s,this.rightOrigin=o,this.parent=u,this.parentSub=c,this.redone=null,this.content=l,this.info=this.content.isCountable()?$r:0}set marker(t){(this.info&jn)>0!==t&&(this.info^=jn)}get marker(){return(this.info&jn)>0}get keep(){return(this.info&Wr)>0}set keep(t){this.keep!==t&&(this.info^=Wr)}get countable(){return(this.info&$r)>0}get deleted(){return(this.info&Bn)>0}set deleted(t){this.deleted!==t&&(this.info^=Bn)}markDeleted(){this.info|=Bn}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=ht(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=ht(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Ee&&this.id.client!==this.parent.client&&this.parent.clock>=ht(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=Ai(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=bt(t,this.rightOrigin),this.rightOrigin=this.right.id),(this.left&&this.left.constructor===Et||this.right&&this.right.constructor===Et)&&(this.parent=null),!this.parent)this.left&&this.left.constructor===rt&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===rt&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Ee){const i=pn(n,this.parent);i.constructor===Et?this.parent=null:this.parent=i.content.type}return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=Ai(t,t.doc.store,K(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let i=this.left,s;if(i!==null)s=i.right;else if(this.parentSub!==null)for(s=this.parent._map.get(this.parentSub)||null;s!==null&&s.left!==null;)s=s.left;else s=this.parent._start;const o=new Set,u=new Set;for(;s!==null&&s!==this.right;){if(u.add(s),o.add(s),dn(this.origin,s.origin)){if(s.id.client<this.id.client)i=s,o.clear();else if(dn(this.rightOrigin,s.rightOrigin))break}else if(s.origin!==null&&u.has(pn(t.doc.store,s.origin)))o.has(pn(t.doc.store,s.origin))||(i=s,o.clear());else break;s=s.right}this.left=i}if(this.left!==null){const i=this.left.right;this.right=i,this.left.right=this}else{let i;if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start,this.parent._start=this;this.right=i}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),Ti(t.doc.store,this),this.content.integrate(t,this),Li(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new Et(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:K(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&dn(t.origin,this.lastId)&&this.right===t&&dn(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const n=this.parent._searchMarker;return n&&n.forEach(i=>{i.p===t&&(i.p=this,!this.deleted&&this.countable&&(i.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),je(t.deleteSet,this.id.client,this.id.clock,this.length),Li(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw xt();this.content.gc(t),n?Wo(t,this,new Et(this.id,this.length)):this.content=new ze(this.length)}write(t,n){const i=n>0?K(this.id.client,this.id.clock+n-1):this.origin,s=this.rightOrigin,o=this.parentSub,u=this.content.getRef()&rn|(i===null?0:_t)|(s===null?0:jt)|(o===null?0:Ue);if(t.writeInfo(u),i!==null&&t.writeLeftID(i),s!==null&&t.writeRightID(s),i===null&&s===null){const c=this.parent;if(c._item!==void 0){const l=c._item;if(l===null){const y=qo(c);t.writeParentInfo(!0),t.writeString(y)}else t.writeParentInfo(!1),t.writeLeftID(l.id)}else c.constructor===String?(t.writeParentInfo(!0),t.writeString(c)):c.constructor===Ee?(t.writeParentInfo(!1),t.writeLeftID(c)):xt();o!==null&&t.writeString(o)}this.content.write(t,n)}}const ns=(e,t)=>Ba[t&rn](e),Ba=[()=>{xt()},Sa,Ra,va,Aa,Ca,ka,Fa,Ta,Ea,()=>{xt()}],ja=10;class Ct extends br{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){xt()}write(t,n){t.writeInfo(ja),H(t.restEncoder,this.length-n)}getMissing(t,n){return null}}const rs=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:{},is="__ $YJS$ __";rs[is]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),rs[is]=!0;const Va=1200,qa=2500,Dn=3e4,vr=e=>{if(e.shouldConnect&&e.ws===null){const t=new WebSocket(e.url),n=e.binaryType;let i=null;n&&(t.binaryType=n),e.ws=t,e.connecting=!0,e.connected=!1,t.onmessage=u=>{e.lastMessageReceived=Ft();const c=u.data,l=typeof c=="string"?JSON.parse(c):c;l&&l.type==="pong"&&(clearTimeout(i),i=setTimeout(o,Dn/2)),e.emit("message",[l,e])};const s=u=>{e.ws!==null&&(e.ws=null,e.connecting=!1,e.connected?(e.connected=!1,e.emit("disconnect",[{type:"disconnect",error:u},e])):e.unsuccessfulReconnects++,setTimeout(vr,Nn(As(e.unsuccessfulReconnects+1)*Va,qa),e)),clearTimeout(i)},o=()=>{e.ws===t&&e.send({type:"ping"})};t.onclose=()=>s(null),t.onerror=u=>s(u),t.onopen=()=>{e.lastMessageReceived=Ft(),e.connecting=!1,e.connected=!0,e.unsuccessfulReconnects=0,e.emit("connect",[{type:"connect"},e]),i=setTimeout(o,Dn/2)}}};class Ha extends ye{constructor(t,{binaryType:n}={}){super();this.url=t,this.ws=null,this.binaryType=n||null,this.connected=!1,this.connecting=!1,this.unsuccessfulReconnects=0,this.lastMessageReceived=0,this.shouldConnect=!0,this._checkInterval=setInterval(()=>{this.connected&&Dn<Ft()-this.lastMessageReceived&&this.ws.close()},Dn/2),vr(this)}send(t){this.ws&&this.ws.send(JSON.stringify(t))}destroy(){clearInterval(this._checkInterval),this.disconnect(),super.destroy()}disconnect(){this.shouldConnect=!1,this.ws!==null&&this.ws.close()}connect(){this.shouldConnect=!0,!this.connected&&this.ws===null&&vr(this)}}const ss=new Map;class Wa{constructor(t){this.room=t,this.onmessage=null,Us(n=>n.key===t&&this.onmessage!==null&&this.onmessage({data:Zr(n.newValue||"")}))}postMessage(t){jr.setItem(this.room,Xr(Xs(t)))}}const $a=typeof BroadcastChannel=="undefined"?Wa:BroadcastChannel,Sr=e=>St(ss,e,()=>{const t=te(),n=new $a(e);return n.onmessage=i=>t.forEach(s=>s(i.data,"broadcastchannel")),{bc:n,subs:t}}),Ya=(e,t)=>(Sr(e).subs.add(t),t),za=(e,t)=>{const n=Sr(e),i=n.subs.delete(t);return i&&n.subs.size===0&&(n.bc.close(),ss.delete(e)),i},Ga=(e,t,n=null)=>{const i=Sr(e);i.bc.postMessage(t),i.subs.forEach(s=>s(t,n))},Ja=()=>{let e=!0;return(t,n)=>{if(e){e=!1;try{t()}finally{e=!0}}else n!==void 0&&n()}};var kt=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function In(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var os={exports:{}};(function(e,t){(function(n){e.exports=n()})(function(){var n=Math.floor,i=Math.abs,s=Math.pow;return function(){function o(u,c,l){function y(f,p){if(!c[f]){if(!u[f]){var g=typeof In=="function"&&In;if(!p&&g)return g(f,!0);if(w)return w(f,!0);var E=new Error("Cannot find module '"+f+"'");throw E.code="MODULE_NOT_FOUND",E}var I=c[f]={exports:{}};u[f][0].call(I.exports,function(O){var F=u[f][1][O];return y(F||O)},I,I.exports,o,u,c,l)}return c[f].exports}for(var w=typeof In=="function"&&In,h=0;h<l.length;h++)y(l[h]);return y}return o}()({1:[function(o,u,c){function l(S){var k=S.length;if(0<k%4)throw new Error("Invalid string. Length must be a multiple of 4");var D=S.indexOf("=");D===-1&&(D=k);var m=D===k?0:4-D%4;return[D,m]}function y(S,k,D){return 3*(k+D)/4-D}function w(S){var k,D,m=l(S),C=m[0],A=m[1],v=new I(y(S,C,A)),R=0,x=0<A?C-4:C;for(D=0;D<x;D+=4)k=E[S.charCodeAt(D)]<<18|E[S.charCodeAt(D+1)]<<12|E[S.charCodeAt(D+2)]<<6|E[S.charCodeAt(D+3)],v[R++]=255&k>>16,v[R++]=255&k>>8,v[R++]=255&k;return A===2&&(k=E[S.charCodeAt(D)]<<2|E[S.charCodeAt(D+1)]>>4,v[R++]=255&k),A===1&&(k=E[S.charCodeAt(D)]<<10|E[S.charCodeAt(D+1)]<<4|E[S.charCodeAt(D+2)]>>2,v[R++]=255&k>>8,v[R++]=255&k),v}function h(S){return g[63&S>>18]+g[63&S>>12]+g[63&S>>6]+g[63&S]}function f(S,k,D){for(var m,C=[],A=k;A<D;A+=3)m=(16711680&S[A]<<16)+(65280&S[A+1]<<8)+(255&S[A+2]),C.push(h(m));return C.join("")}function p(S){for(var k,D=S.length,m=D%3,C=[],A=16383,v=0,R=D-m;v<R;v+=A)C.push(f(S,v,v+A>R?R:v+A));return m===1?(k=S[D-1],C.push(g[k>>2]+g[63&k<<4]+"==")):m===2&&(k=(S[D-2]<<8)+S[D-1],C.push(g[k>>10]+g[63&k>>4]+g[63&k<<2]+"=")),C.join("")}c.byteLength=function(S){var k=l(S),D=k[0],m=k[1];return 3*(D+m)/4-m},c.toByteArray=w,c.fromByteArray=p;for(var g=[],E=[],I=typeof Uint8Array=="undefined"?Array:Uint8Array,O="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",F=0,b=O.length;F<b;++F)g[F]=O[F],E[O.charCodeAt(F)]=F;E[45]=62,E[95]=63},{}],2:[function(){},{}],3:[function(o,u,c){(function(){(function(){var l=String.fromCharCode,y=Math.min;function w(r){if(2147483647<r)throw new RangeError('The value "'+r+'" is invalid for option "size"');var a=new Uint8Array(r);return a.__proto__=h.prototype,a}function h(r,a,d){if(typeof r=="number"){if(typeof a=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return E(r)}return f(r,a,d)}function f(r,a,d){if(typeof r=="string")return I(r,a);if(ArrayBuffer.isView(r))return O(r);if(r==null)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r);if(M(r,ArrayBuffer)||r&&M(r.buffer,ArrayBuffer))return F(r,a,d);if(typeof r=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var T=r.valueOf&&r.valueOf();if(T!=null&&T!==r)return h.from(T,a,d);var L=b(r);if(L)return L;if(typeof Symbol!="undefined"&&Symbol.toPrimitive!=null&&typeof r[Symbol.toPrimitive]=="function")return h.from(r[Symbol.toPrimitive]("string"),a,d);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r)}function p(r){if(typeof r!="number")throw new TypeError('"size" argument must be of type number');if(0>r)throw new RangeError('The value "'+r+'" is invalid for option "size"')}function g(r,a,d){return p(r),0>=r||a===void 0?w(r):typeof d=="string"?w(r).fill(a,d):w(r).fill(a)}function E(r){return p(r),w(0>r?0:0|S(r))}function I(r,a){if((typeof a!="string"||a==="")&&(a="utf8"),!h.isEncoding(a))throw new TypeError("Unknown encoding: "+a);var d=0|k(r,a),T=w(d),L=T.write(r,a);return L!==d&&(T=T.slice(0,L)),T}function O(r){for(var a=0>r.length?0:0|S(r.length),d=w(a),T=0;T<a;T+=1)d[T]=255&r[T];return d}function F(r,a,d){if(0>a||r.byteLength<a)throw new RangeError('"offset" is outside of buffer bounds');if(r.byteLength<a+(d||0))throw new RangeError('"length" is outside of buffer bounds');var T;return T=a===void 0&&d===void 0?new Uint8Array(r):d===void 0?new Uint8Array(r,a):new Uint8Array(r,a,d),T.__proto__=h.prototype,T}function b(r){if(h.isBuffer(r)){var a=0|S(r.length),d=w(a);return d.length===0||r.copy(d,0,0,a),d}return r.length===void 0?r.type==="Buffer"&&Array.isArray(r.data)?O(r.data):void 0:typeof r.length!="number"||N(r.length)?w(0):O(r)}function S(r){if(r>=2147483647)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+2147483647 .toString(16)+" bytes");return 0|r}function k(r,a){if(h.isBuffer(r))return r.length;if(ArrayBuffer.isView(r)||M(r,ArrayBuffer))return r.byteLength;if(typeof r!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof r);var d=r.length,T=2<arguments.length&&arguments[2]===!0;if(!T&&d===0)return 0;for(var L=!1;;)switch(a){case"ascii":case"latin1":case"binary":return d;case"utf8":case"utf-8":return fe(r).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*d;case"hex":return d>>>1;case"base64":return Dt(r).length;default:if(L)return T?-1:fe(r).length;a=(""+a).toLowerCase(),L=!0}}function D(r,a,d){var T=!1;if((a===void 0||0>a)&&(a=0),a>this.length||((d===void 0||d>this.length)&&(d=this.length),0>=d)||(d>>>=0,a>>>=0,d<=a))return"";for(r||(r="utf8");;)switch(r){case"hex":return Tt(this,a,d);case"utf8":case"utf-8":return et(this,a,d);case"ascii":return z(this,a,d);case"latin1":case"binary":return De(this,a,d);case"base64":return G(this,a,d);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Kt(this,a,d);default:if(T)throw new TypeError("Unknown encoding: "+r);r=(r+"").toLowerCase(),T=!0}}function m(r,a,d){var T=r[a];r[a]=r[d],r[d]=T}function C(r,a,d,T,L){if(r.length===0)return-1;if(typeof d=="string"?(T=d,d=0):2147483647<d?d=2147483647:-2147483648>d&&(d=-2147483648),d=+d,N(d)&&(d=L?0:r.length-1),0>d&&(d=r.length+d),d>=r.length){if(L)return-1;d=r.length-1}else if(0>d)if(L)d=0;else return-1;if(typeof a=="string"&&(a=h.from(a,T)),h.isBuffer(a))return a.length===0?-1:A(r,a,d,T,L);if(typeof a=="number")return a&=255,typeof Uint8Array.prototype.indexOf=="function"?L?Uint8Array.prototype.indexOf.call(r,a,d):Uint8Array.prototype.lastIndexOf.call(r,a,d):A(r,[a],d,T,L);throw new TypeError("val must be string, number or Buffer")}function A(r,a,d,T,L){function U(Ie,Ze){return j===1?Ie[Ze]:Ie.readUInt16BE(Ze*j)}var j=1,Z=r.length,it=a.length;if(T!==void 0&&(T=(T+"").toLowerCase(),T==="ucs2"||T==="ucs-2"||T==="utf16le"||T==="utf-16le")){if(2>r.length||2>a.length)return-1;j=2,Z/=2,it/=2,d/=2}var Q;if(L){var X=-1;for(Q=d;Q<Z;Q++)if(U(r,Q)!==U(a,X===-1?0:Q-X))X!==-1&&(Q-=Q-X),X=-1;else if(X===-1&&(X=Q),Q-X+1===it)return X*j}else for(d+it>Z&&(d=Z-it),Q=d;0<=Q;Q--){for(var wt=!0,ge=0;ge<it;ge++)if(U(r,Q+ge)!==U(a,ge)){wt=!1;break}if(wt)return Q}return-1}function v(r,a,d,T){d=+d||0;var L=r.length-d;T?(T=+T,T>L&&(T=L)):T=L;var U=a.length;T>U/2&&(T=U/2);for(var j,Z=0;Z<T;++Z){if(j=parseInt(a.substr(2*Z,2),16),N(j))return Z;r[d+Z]=j}return Z}function R(r,a,d,T){return It(fe(a,r.length-d),r,d,T)}function x(r,a,d,T){return It(Xe(a),r,d,T)}function P(r,a,d,T){return x(r,a,d,T)}function q(r,a,d,T){return It(Dt(a),r,d,T)}function Y(r,a,d,T){return It(Qt(a,r.length-d),r,d,T)}function G(r,a,d){return a===0&&d===r.length?B.fromByteArray(r):B.fromByteArray(r.slice(a,d))}function et(r,a,d){d=y(r.length,d);for(var T=[],L=a;L<d;){var U=r[L],j=null,Z=239<U?4:223<U?3:191<U?2:1;if(L+Z<=d){var it,Q,X,wt;Z===1?128>U&&(j=U):Z===2?(it=r[L+1],(192&it)==128&&(wt=(31&U)<<6|63&it,127<wt&&(j=wt))):Z===3?(it=r[L+1],Q=r[L+2],(192&it)==128&&(192&Q)==128&&(wt=(15&U)<<12|(63&it)<<6|63&Q,2047<wt&&(55296>wt||57343<wt)&&(j=wt))):Z===4&&(it=r[L+1],Q=r[L+2],X=r[L+3],(192&it)==128&&(192&Q)==128&&(192&X)==128&&(wt=(15&U)<<18|(63&it)<<12|(63&Q)<<6|63&X,65535<wt&&1114112>wt&&(j=wt)))}j===null?(j=65533,Z=1):65535<j&&(j-=65536,T.push(55296|1023&j>>>10),j=56320|1023&j),T.push(j),L+=Z}return at(T)}function at(r){var a=r.length;if(a<=4096)return l.apply(String,r);for(var d="",T=0;T<a;)d+=l.apply(String,r.slice(T,T+=4096));return d}function z(r,a,d){var T="";d=y(r.length,d);for(var L=a;L<d;++L)T+=l(127&r[L]);return T}function De(r,a,d){var T="";d=y(r.length,d);for(var L=a;L<d;++L)T+=l(r[L]);return T}function Tt(r,a,d){var T=r.length;(!a||0>a)&&(a=0),(!d||0>d||d>T)&&(d=T);for(var L="",U=a;U<d;++U)L+=de(r[U]);return L}function Kt(r,a,d){for(var T=r.slice(a,d),L="",U=0;U<T.length;U+=2)L+=l(T[U]+256*T[U+1]);return L}function lt(r,a,d){if(r%1!=0||0>r)throw new RangeError("offset is not uint");if(r+a>d)throw new RangeError("Trying to access beyond buffer length")}function nt(r,a,d,T,L,U){if(!h.isBuffer(r))throw new TypeError('"buffer" argument must be a Buffer instance');if(a>L||a<U)throw new RangeError('"value" argument is out of bounds');if(d+T>r.length)throw new RangeError("Index out of range")}function At(r,a,d,T){if(d+T>r.length)throw new RangeError("Index out of range");if(0>d)throw new RangeError("Index out of range")}function Xt(r,a,d,T,L){return a=+a,d>>>=0,L||At(r,a,d,4),V.write(r,a,d,T,23,4),d+4}function Zt(r,a,d,T,L){return a=+a,d>>>=0,L||At(r,a,d,8),V.write(r,a,d,T,52,8),d+8}function Ke(r){if(r=r.split("=")[0],r=r.trim().replace(_,""),2>r.length)return"";for(;r.length%4!=0;)r+="=";return r}function de(r){return 16>r?"0"+r.toString(16):r.toString(16)}function fe(r,a){a=a||1/0;for(var d,T=r.length,L=null,U=[],j=0;j<T;++j){if(d=r.charCodeAt(j),55295<d&&57344>d){if(!L){if(56319<d){-1<(a-=3)&&U.push(239,191,189);continue}else if(j+1===T){-1<(a-=3)&&U.push(239,191,189);continue}L=d;continue}if(56320>d){-1<(a-=3)&&U.push(239,191,189),L=d;continue}d=(L-55296<<10|d-56320)+65536}else L&&-1<(a-=3)&&U.push(239,191,189);if(L=null,128>d){if(0>(a-=1))break;U.push(d)}else if(2048>d){if(0>(a-=2))break;U.push(192|d>>6,128|63&d)}else if(65536>d){if(0>(a-=3))break;U.push(224|d>>12,128|63&d>>6,128|63&d)}else if(1114112>d){if(0>(a-=4))break;U.push(240|d>>18,128|63&d>>12,128|63&d>>6,128|63&d)}else throw new Error("Invalid code point")}return U}function Xe(r){for(var a=[],d=0;d<r.length;++d)a.push(255&r.charCodeAt(d));return a}function Qt(r,a){for(var d,T,L,U=[],j=0;j<r.length&&!(0>(a-=2));++j)d=r.charCodeAt(j),T=d>>8,L=d%256,U.push(L),U.push(T);return U}function Dt(r){return B.toByteArray(Ke(r))}function It(r,a,d,T){for(var L=0;L<T&&!(L+d>=a.length||L>=r.length);++L)a[L+d]=r[L];return L}function M(r,a){return r instanceof a||r!=null&&r.constructor!=null&&r.constructor.name!=null&&r.constructor.name===a.name}function N(r){return r!==r}var B=o("base64-js"),V=o("ieee754");c.Buffer=h,c.SlowBuffer=function(r){return+r!=r&&(r=0),h.alloc(+r)},c.INSPECT_MAX_BYTES=50,c.kMaxLength=2147483647,h.TYPED_ARRAY_SUPPORT=function(){try{var r=new Uint8Array(1);return r.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},r.foo()===42}catch{return!1}}(),h.TYPED_ARRAY_SUPPORT||typeof console=="undefined"||typeof console.error!="function"||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(h.prototype,"parent",{enumerable:!0,get:function(){return h.isBuffer(this)?this.buffer:void 0}}),Object.defineProperty(h.prototype,"offset",{enumerable:!0,get:function(){return h.isBuffer(this)?this.byteOffset:void 0}}),typeof Symbol!="undefined"&&Symbol.species!=null&&h[Symbol.species]===h&&Object.defineProperty(h,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),h.poolSize=8192,h.from=function(r,a,d){return f(r,a,d)},h.prototype.__proto__=Uint8Array.prototype,h.__proto__=Uint8Array,h.alloc=function(r,a,d){return g(r,a,d)},h.allocUnsafe=function(r){return E(r)},h.allocUnsafeSlow=function(r){return E(r)},h.isBuffer=function(r){return r!=null&&r._isBuffer===!0&&r!==h.prototype},h.compare=function(r,a){if(M(r,Uint8Array)&&(r=h.from(r,r.offset,r.byteLength)),M(a,Uint8Array)&&(a=h.from(a,a.offset,a.byteLength)),!h.isBuffer(r)||!h.isBuffer(a))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(r===a)return 0;for(var d=r.length,T=a.length,L=0,U=y(d,T);L<U;++L)if(r[L]!==a[L]){d=r[L],T=a[L];break}return d<T?-1:T<d?1:0},h.isEncoding=function(r){switch((r+"").toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},h.concat=function(r,a){if(!Array.isArray(r))throw new TypeError('"list" argument must be an Array of Buffers');if(r.length===0)return h.alloc(0);var d;if(a===void 0)for(a=0,d=0;d<r.length;++d)a+=r[d].length;var T=h.allocUnsafe(a),L=0;for(d=0;d<r.length;++d){var U=r[d];if(M(U,Uint8Array)&&(U=h.from(U)),!h.isBuffer(U))throw new TypeError('"list" argument must be an Array of Buffers');U.copy(T,L),L+=U.length}return T},h.byteLength=k,h.prototype._isBuffer=!0,h.prototype.swap16=function(){var r=this.length;if(r%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var a=0;a<r;a+=2)m(this,a,a+1);return this},h.prototype.swap32=function(){var r=this.length;if(r%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var a=0;a<r;a+=4)m(this,a,a+3),m(this,a+1,a+2);return this},h.prototype.swap64=function(){var r=this.length;if(r%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var a=0;a<r;a+=8)m(this,a,a+7),m(this,a+1,a+6),m(this,a+2,a+5),m(this,a+3,a+4);return this},h.prototype.toString=function(){var r=this.length;return r===0?"":arguments.length===0?et(this,0,r):D.apply(this,arguments)},h.prototype.toLocaleString=h.prototype.toString,h.prototype.equals=function(r){if(!h.isBuffer(r))throw new TypeError("Argument must be a Buffer");return this===r||h.compare(this,r)===0},h.prototype.inspect=function(){var r="",a=c.INSPECT_MAX_BYTES;return r=this.toString("hex",0,a).replace(/(.{2})/g,"$1 ").trim(),this.length>a&&(r+=" ... "),"<Buffer "+r+">"},h.prototype.compare=function(r,a,d,T,L){if(M(r,Uint8Array)&&(r=h.from(r,r.offset,r.byteLength)),!h.isBuffer(r))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof r);if(a===void 0&&(a=0),d===void 0&&(d=r?r.length:0),T===void 0&&(T=0),L===void 0&&(L=this.length),0>a||d>r.length||0>T||L>this.length)throw new RangeError("out of range index");if(T>=L&&a>=d)return 0;if(T>=L)return-1;if(a>=d)return 1;if(a>>>=0,d>>>=0,T>>>=0,L>>>=0,this===r)return 0;for(var U=L-T,j=d-a,Z=y(U,j),it=this.slice(T,L),Q=r.slice(a,d),X=0;X<Z;++X)if(it[X]!==Q[X]){U=it[X],j=Q[X];break}return U<j?-1:j<U?1:0},h.prototype.includes=function(r,a,d){return this.indexOf(r,a,d)!==-1},h.prototype.indexOf=function(r,a,d){return C(this,r,a,d,!0)},h.prototype.lastIndexOf=function(r,a,d){return C(this,r,a,d,!1)},h.prototype.write=function(r,a,d,T){if(a===void 0)T="utf8",d=this.length,a=0;else if(d===void 0&&typeof a=="string")T=a,d=this.length,a=0;else if(isFinite(a))a>>>=0,isFinite(d)?(d>>>=0,T===void 0&&(T="utf8")):(T=d,d=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var L=this.length-a;if((d===void 0||d>L)&&(d=L),0<r.length&&(0>d||0>a)||a>this.length)throw new RangeError("Attempt to write outside buffer bounds");T||(T="utf8");for(var U=!1;;)switch(T){case"hex":return v(this,r,a,d);case"utf8":case"utf-8":return R(this,r,a,d);case"ascii":return x(this,r,a,d);case"latin1":case"binary":return P(this,r,a,d);case"base64":return q(this,r,a,d);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Y(this,r,a,d);default:if(U)throw new TypeError("Unknown encoding: "+T);T=(""+T).toLowerCase(),U=!0}},h.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},h.prototype.slice=function(r,a){var d=this.length;r=~~r,a=a===void 0?d:~~a,0>r?(r+=d,0>r&&(r=0)):r>d&&(r=d),0>a?(a+=d,0>a&&(a=0)):a>d&&(a=d),a<r&&(a=r);var T=this.subarray(r,a);return T.__proto__=h.prototype,T},h.prototype.readUIntLE=function(r,a,d){r>>>=0,a>>>=0,d||lt(r,a,this.length);for(var T=this[r],L=1,U=0;++U<a&&(L*=256);)T+=this[r+U]*L;return T},h.prototype.readUIntBE=function(r,a,d){r>>>=0,a>>>=0,d||lt(r,a,this.length);for(var T=this[r+--a],L=1;0<a&&(L*=256);)T+=this[r+--a]*L;return T},h.prototype.readUInt8=function(r,a){return r>>>=0,a||lt(r,1,this.length),this[r]},h.prototype.readUInt16LE=function(r,a){return r>>>=0,a||lt(r,2,this.length),this[r]|this[r+1]<<8},h.prototype.readUInt16BE=function(r,a){return r>>>=0,a||lt(r,2,this.length),this[r]<<8|this[r+1]},h.prototype.readUInt32LE=function(r,a){return r>>>=0,a||lt(r,4,this.length),(this[r]|this[r+1]<<8|this[r+2]<<16)+16777216*this[r+3]},h.prototype.readUInt32BE=function(r,a){return r>>>=0,a||lt(r,4,this.length),16777216*this[r]+(this[r+1]<<16|this[r+2]<<8|this[r+3])},h.prototype.readIntLE=function(r,a,d){r>>>=0,a>>>=0,d||lt(r,a,this.length);for(var T=this[r],L=1,U=0;++U<a&&(L*=256);)T+=this[r+U]*L;return L*=128,T>=L&&(T-=s(2,8*a)),T},h.prototype.readIntBE=function(r,a,d){r>>>=0,a>>>=0,d||lt(r,a,this.length);for(var T=a,L=1,U=this[r+--T];0<T&&(L*=256);)U+=this[r+--T]*L;return L*=128,U>=L&&(U-=s(2,8*a)),U},h.prototype.readInt8=function(r,a){return r>>>=0,a||lt(r,1,this.length),128&this[r]?-1*(255-this[r]+1):this[r]},h.prototype.readInt16LE=function(r,a){r>>>=0,a||lt(r,2,this.length);var d=this[r]|this[r+1]<<8;return 32768&d?4294901760|d:d},h.prototype.readInt16BE=function(r,a){r>>>=0,a||lt(r,2,this.length);var d=this[r+1]|this[r]<<8;return 32768&d?4294901760|d:d},h.prototype.readInt32LE=function(r,a){return r>>>=0,a||lt(r,4,this.length),this[r]|this[r+1]<<8|this[r+2]<<16|this[r+3]<<24},h.prototype.readInt32BE=function(r,a){return r>>>=0,a||lt(r,4,this.length),this[r]<<24|this[r+1]<<16|this[r+2]<<8|this[r+3]},h.prototype.readFloatLE=function(r,a){return r>>>=0,a||lt(r,4,this.length),V.read(this,r,!0,23,4)},h.prototype.readFloatBE=function(r,a){return r>>>=0,a||lt(r,4,this.length),V.read(this,r,!1,23,4)},h.prototype.readDoubleLE=function(r,a){return r>>>=0,a||lt(r,8,this.length),V.read(this,r,!0,52,8)},h.prototype.readDoubleBE=function(r,a){return r>>>=0,a||lt(r,8,this.length),V.read(this,r,!1,52,8)},h.prototype.writeUIntLE=function(r,a,d,T){if(r=+r,a>>>=0,d>>>=0,!T){var L=s(2,8*d)-1;nt(this,r,a,d,L,0)}var U=1,j=0;for(this[a]=255&r;++j<d&&(U*=256);)this[a+j]=255&r/U;return a+d},h.prototype.writeUIntBE=function(r,a,d,T){if(r=+r,a>>>=0,d>>>=0,!T){var L=s(2,8*d)-1;nt(this,r,a,d,L,0)}var U=d-1,j=1;for(this[a+U]=255&r;0<=--U&&(j*=256);)this[a+U]=255&r/j;return a+d},h.prototype.writeUInt8=function(r,a,d){return r=+r,a>>>=0,d||nt(this,r,a,1,255,0),this[a]=255&r,a+1},h.prototype.writeUInt16LE=function(r,a,d){return r=+r,a>>>=0,d||nt(this,r,a,2,65535,0),this[a]=255&r,this[a+1]=r>>>8,a+2},h.prototype.writeUInt16BE=function(r,a,d){return r=+r,a>>>=0,d||nt(this,r,a,2,65535,0),this[a]=r>>>8,this[a+1]=255&r,a+2},h.prototype.writeUInt32LE=function(r,a,d){return r=+r,a>>>=0,d||nt(this,r,a,4,4294967295,0),this[a+3]=r>>>24,this[a+2]=r>>>16,this[a+1]=r>>>8,this[a]=255&r,a+4},h.prototype.writeUInt32BE=function(r,a,d){return r=+r,a>>>=0,d||nt(this,r,a,4,4294967295,0),this[a]=r>>>24,this[a+1]=r>>>16,this[a+2]=r>>>8,this[a+3]=255&r,a+4},h.prototype.writeIntLE=function(r,a,d,T){if(r=+r,a>>>=0,!T){var L=s(2,8*d-1);nt(this,r,a,d,L-1,-L)}var U=0,j=1,Z=0;for(this[a]=255&r;++U<d&&(j*=256);)0>r&&Z===0&&this[a+U-1]!==0&&(Z=1),this[a+U]=255&(r/j>>0)-Z;return a+d},h.prototype.writeIntBE=function(r,a,d,T){if(r=+r,a>>>=0,!T){var L=s(2,8*d-1);nt(this,r,a,d,L-1,-L)}var U=d-1,j=1,Z=0;for(this[a+U]=255&r;0<=--U&&(j*=256);)0>r&&Z===0&&this[a+U+1]!==0&&(Z=1),this[a+U]=255&(r/j>>0)-Z;return a+d},h.prototype.writeInt8=function(r,a,d){return r=+r,a>>>=0,d||nt(this,r,a,1,127,-128),0>r&&(r=255+r+1),this[a]=255&r,a+1},h.prototype.writeInt16LE=function(r,a,d){return r=+r,a>>>=0,d||nt(this,r,a,2,32767,-32768),this[a]=255&r,this[a+1]=r>>>8,a+2},h.prototype.writeInt16BE=function(r,a,d){return r=+r,a>>>=0,d||nt(this,r,a,2,32767,-32768),this[a]=r>>>8,this[a+1]=255&r,a+2},h.prototype.writeInt32LE=function(r,a,d){return r=+r,a>>>=0,d||nt(this,r,a,4,2147483647,-2147483648),this[a]=255&r,this[a+1]=r>>>8,this[a+2]=r>>>16,this[a+3]=r>>>24,a+4},h.prototype.writeInt32BE=function(r,a,d){return r=+r,a>>>=0,d||nt(this,r,a,4,2147483647,-2147483648),0>r&&(r=4294967295+r+1),this[a]=r>>>24,this[a+1]=r>>>16,this[a+2]=r>>>8,this[a+3]=255&r,a+4},h.prototype.writeFloatLE=function(r,a,d){return Xt(this,r,a,!0,d)},h.prototype.writeFloatBE=function(r,a,d){return Xt(this,r,a,!1,d)},h.prototype.writeDoubleLE=function(r,a,d){return Zt(this,r,a,!0,d)},h.prototype.writeDoubleBE=function(r,a,d){return Zt(this,r,a,!1,d)},h.prototype.copy=function(r,a,d,T){if(!h.isBuffer(r))throw new TypeError("argument should be a Buffer");if(d||(d=0),T||T===0||(T=this.length),a>=r.length&&(a=r.length),a||(a=0),0<T&&T<d&&(T=d),T===d||r.length===0||this.length===0)return 0;if(0>a)throw new RangeError("targetStart out of bounds");if(0>d||d>=this.length)throw new RangeError("Index out of range");if(0>T)throw new RangeError("sourceEnd out of bounds");T>this.length&&(T=this.length),r.length-a<T-d&&(T=r.length-a+d);var L=T-d;if(this===r&&typeof Uint8Array.prototype.copyWithin=="function")this.copyWithin(a,d,T);else if(this===r&&d<a&&a<T)for(var U=L-1;0<=U;--U)r[U+a]=this[U+d];else Uint8Array.prototype.set.call(r,this.subarray(d,T),a);return L},h.prototype.fill=function(r,a,d,T){if(typeof r=="string"){if(typeof a=="string"?(T=a,a=0,d=this.length):typeof d=="string"&&(T=d,d=this.length),T!==void 0&&typeof T!="string")throw new TypeError("encoding must be a string");if(typeof T=="string"&&!h.isEncoding(T))throw new TypeError("Unknown encoding: "+T);if(r.length===1){var L=r.charCodeAt(0);(T==="utf8"&&128>L||T==="latin1")&&(r=L)}}else typeof r=="number"&&(r&=255);if(0>a||this.length<a||this.length<d)throw new RangeError("Out of range index");if(d<=a)return this;a>>>=0,d=d===void 0?this.length:d>>>0,r||(r=0);var U;if(typeof r=="number")for(U=a;U<d;++U)this[U]=r;else{var j=h.isBuffer(r)?r:h.from(r,T),Z=j.length;if(Z===0)throw new TypeError('The value "'+r+'" is invalid for argument "value"');for(U=0;U<d-a;++U)this[U+a]=j[U%Z]}return this};var _=/[^+/0-9A-Za-z-_]/g}).call(this)}).call(this,o("buffer").Buffer)},{"base64-js":1,buffer:3,ieee754:9}],4:[function(o,u,c){(function(l){(function(){function y(){let h;try{h=c.storage.getItem("debug")}catch{}return!h&&typeof l!="undefined"&&"env"in l&&(h=l.env.DEBUG),h}c.formatArgs=function(h){if(h[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+h[0]+(this.useColors?"%c ":" ")+"+"+u.exports.humanize(this.diff),!this.useColors)return;const f="color: "+this.color;h.splice(1,0,f,"color: inherit");let p=0,g=0;h[0].replace(/%[a-zA-Z%]/g,E=>{E==="%%"||(p++,E==="%c"&&(g=p))}),h.splice(g,0,f)},c.save=function(h){try{h?c.storage.setItem("debug",h):c.storage.removeItem("debug")}catch{}},c.load=y,c.useColors=function(){return!!(typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))||!(typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&(typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},c.storage=function(){try{return localStorage}catch{}}(),c.destroy=(()=>{let h=!1;return()=>{h||(h=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),c.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],c.log=console.debug||console.log||(()=>{}),u.exports=o("./common")(c);const{formatters:w}=u.exports;w.j=function(h){try{return JSON.stringify(h)}catch(f){return"[UnexpectedJSONParseError]: "+f.message}}}).call(this)}).call(this,o("_process"))},{"./common":5,_process:12}],5:[function(o,u){u.exports=function(c){function l(h){function f(...E){if(!f.enabled)return;const I=f,O=+new Date,F=O-(p||O);I.diff=F,I.prev=p,I.curr=O,p=O,E[0]=l.coerce(E[0]),typeof E[0]!="string"&&E.unshift("%O");let b=0;E[0]=E[0].replace(/%([a-zA-Z%])/g,(k,D)=>{if(k==="%%")return"%";b++;const m=l.formatters[D];if(typeof m=="function"){const C=E[b];k=m.call(I,C),E.splice(b,1),b--}return k}),l.formatArgs.call(I,E),(I.log||l.log).apply(I,E)}let p,g=null;return f.namespace=h,f.useColors=l.useColors(),f.color=l.selectColor(h),f.extend=y,f.destroy=l.destroy,Object.defineProperty(f,"enabled",{enumerable:!0,configurable:!1,get:()=>g===null?l.enabled(h):g,set:E=>{g=E}}),typeof l.init=="function"&&l.init(f),f}function y(h,f){const p=l(this.namespace+(typeof f=="undefined"?":":f)+h);return p.log=this.log,p}function w(h){return h.toString().substring(2,h.toString().length-2).replace(/\.\*\?$/,"*")}return l.debug=l,l.default=l,l.coerce=function(h){return h instanceof Error?h.stack||h.message:h},l.disable=function(){const h=[...l.names.map(w),...l.skips.map(w).map(f=>"-"+f)].join(",");return l.enable(""),h},l.enable=function(h){l.save(h),l.names=[],l.skips=[];let f;const p=(typeof h=="string"?h:"").split(/[\s,]+/),g=p.length;for(f=0;f<g;f++)p[f]&&(h=p[f].replace(/\*/g,".*?"),h[0]==="-"?l.skips.push(new RegExp("^"+h.substr(1)+"$")):l.names.push(new RegExp("^"+h+"$")))},l.enabled=function(h){if(h[h.length-1]==="*")return!0;let f,p;for(f=0,p=l.skips.length;f<p;f++)if(l.skips[f].test(h))return!1;for(f=0,p=l.names.length;f<p;f++)if(l.names[f].test(h))return!0;return!1},l.humanize=o("ms"),l.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(c).forEach(h=>{l[h]=c[h]}),l.names=[],l.skips=[],l.formatters={},l.selectColor=function(h){let f=0;for(let p=0;p<h.length;p++)f=(f<<5)-f+h.charCodeAt(p),f|=0;return l.colors[i(f)%l.colors.length]},l.enable(l.load()),l}},{ms:11}],6:[function(o,u){function c(l,y){for(const w in y)Object.defineProperty(l,w,{value:y[w],enumerable:!0,configurable:!0});return l}u.exports=function(l,y,w){if(!l||typeof l=="string")throw new TypeError("Please pass an Error to err-code");w||(w={}),typeof y=="object"&&(w=y,y=""),y&&(w.code=y);try{return c(l,w)}catch{w.message=l.message,w.stack=l.stack;const f=function(){};return f.prototype=Object.create(Object.getPrototypeOf(l)),c(new f,w)}}},{}],7:[function(o,u){function c(v){console&&console.warn&&console.warn(v)}function l(){l.init.call(this)}function y(v){if(typeof v!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof v)}function w(v){return v._maxListeners===void 0?l.defaultMaxListeners:v._maxListeners}function h(v,R,x,P){var q,Y,G;if(y(x),Y=v._events,Y===void 0?(Y=v._events=Object.create(null),v._eventsCount=0):(Y.newListener!==void 0&&(v.emit("newListener",R,x.listener?x.listener:x),Y=v._events),G=Y[R]),G===void 0)G=Y[R]=x,++v._eventsCount;else if(typeof G=="function"?G=Y[R]=P?[x,G]:[G,x]:P?G.unshift(x):G.push(x),q=w(v),0<q&&G.length>q&&!G.warned){G.warned=!0;var et=new Error("Possible EventEmitter memory leak detected. "+G.length+" "+(R+" listeners added. Use emitter.setMaxListeners() to increase limit"));et.name="MaxListenersExceededWarning",et.emitter=v,et.type=R,et.count=G.length,c(et)}return v}function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(v,R,x){var P={fired:!1,wrapFn:void 0,target:v,type:R,listener:x},q=f.bind(P);return q.listener=x,P.wrapFn=q,q}function g(v,R,x){var P=v._events;if(P===void 0)return[];var q=P[R];return q===void 0?[]:typeof q=="function"?x?[q.listener||q]:[q]:x?F(q):I(q,q.length)}function E(v){var R=this._events;if(R!==void 0){var x=R[v];if(typeof x=="function")return 1;if(x!==void 0)return x.length}return 0}function I(v,R){for(var x=Array(R),P=0;P<R;++P)x[P]=v[P];return x}function O(v,R){for(;R+1<v.length;R++)v[R]=v[R+1];v.pop()}function F(v){for(var R=Array(v.length),x=0;x<R.length;++x)R[x]=v[x].listener||v[x];return R}function b(v,R,x){typeof v.on=="function"&&S(v,"error",R,x)}function S(v,R,x,P){if(typeof v.on=="function")P.once?v.once(R,x):v.on(R,x);else if(typeof v.addEventListener=="function")v.addEventListener(R,function q(Y){P.once&&v.removeEventListener(R,q),x(Y)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof v)}var k,D=typeof Reflect=="object"?Reflect:null,m=D&&typeof D.apply=="function"?D.apply:function(v,R,x){return Function.prototype.apply.call(v,R,x)};k=D&&typeof D.ownKeys=="function"?D.ownKeys:Object.getOwnPropertySymbols?function(v){return Object.getOwnPropertyNames(v).concat(Object.getOwnPropertySymbols(v))}:function(v){return Object.getOwnPropertyNames(v)};var C=Number.isNaN||function(v){return v!==v};u.exports=l,u.exports.once=function(v,R){return new Promise(function(x,P){function q(G){v.removeListener(R,Y),P(G)}function Y(){typeof v.removeListener=="function"&&v.removeListener("error",q),x([].slice.call(arguments))}S(v,R,Y,{once:!0}),R!=="error"&&b(v,q,{once:!0})})},l.EventEmitter=l,l.prototype._events=void 0,l.prototype._eventsCount=0,l.prototype._maxListeners=void 0;var A=10;Object.defineProperty(l,"defaultMaxListeners",{enumerable:!0,get:function(){return A},set:function(v){if(typeof v!="number"||0>v||C(v))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+v+".");A=v}}),l.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},l.prototype.setMaxListeners=function(v){if(typeof v!="number"||0>v||C(v))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+v+".");return this._maxListeners=v,this},l.prototype.getMaxListeners=function(){return w(this)},l.prototype.emit=function(v){for(var R=[],x=1;x<arguments.length;x++)R.push(arguments[x]);var P=v==="error",q=this._events;if(q!==void 0)P=P&&q.error===void 0;else if(!P)return!1;if(P){var Y;if(0<R.length&&(Y=R[0]),Y instanceof Error)throw Y;var G=new Error("Unhandled error."+(Y?" ("+Y.message+")":""));throw G.context=Y,G}var et=q[v];if(et===void 0)return!1;if(typeof et=="function")m(et,this,R);else for(var at=et.length,z=I(et,at),x=0;x<at;++x)m(z[x],this,R);return!0},l.prototype.addListener=function(v,R){return h(this,v,R,!1)},l.prototype.on=l.prototype.addListener,l.prototype.prependListener=function(v,R){return h(this,v,R,!0)},l.prototype.once=function(v,R){return y(R),this.on(v,p(this,v,R)),this},l.prototype.prependOnceListener=function(v,R){return y(R),this.prependListener(v,p(this,v,R)),this},l.prototype.removeListener=function(v,R){var x,P,q,Y,G;if(y(R),P=this._events,P===void 0)return this;if(x=P[v],x===void 0)return this;if(x===R||x.listener===R)--this._eventsCount==0?this._events=Object.create(null):(delete P[v],P.removeListener&&this.emit("removeListener",v,x.listener||R));else if(typeof x!="function"){for(q=-1,Y=x.length-1;0<=Y;Y--)if(x[Y]===R||x[Y].listener===R){G=x[Y].listener,q=Y;break}if(0>q)return this;q===0?x.shift():O(x,q),x.length===1&&(P[v]=x[0]),P.removeListener!==void 0&&this.emit("removeListener",v,G||R)}return this},l.prototype.off=l.prototype.removeListener,l.prototype.removeAllListeners=function(v){var R,x,P;if(x=this._events,x===void 0)return this;if(x.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):x[v]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete x[v]),this;if(arguments.length===0){var q,Y=Object.keys(x);for(P=0;P<Y.length;++P)q=Y[P],q!=="removeListener"&&this.removeAllListeners(q);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(R=x[v],typeof R=="function")this.removeListener(v,R);else if(R!==void 0)for(P=R.length-1;0<=P;P--)this.removeListener(v,R[P]);return this},l.prototype.listeners=function(v){return g(this,v,!0)},l.prototype.rawListeners=function(v){return g(this,v,!1)},l.listenerCount=function(v,R){return typeof v.listenerCount=="function"?v.listenerCount(R):E.call(v,R)},l.prototype.listenerCount=E,l.prototype.eventNames=function(){return 0<this._eventsCount?k(this._events):[]}},{}],8:[function(o,u){u.exports=function(){if(typeof globalThis=="undefined")return null;var c={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return c.RTCPeerConnection?c:null}},{}],9:[function(o,u,c){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */c.read=function(l,y,w,h,f){var p,g,E=8*f-h-1,I=(1<<E)-1,O=I>>1,F=-7,b=w?f-1:0,S=w?-1:1,k=l[y+b];for(b+=S,p=k&(1<<-F)-1,k>>=-F,F+=E;0<F;p=256*p+l[y+b],b+=S,F-=8);for(g=p&(1<<-F)-1,p>>=-F,F+=h;0<F;g=256*g+l[y+b],b+=S,F-=8);if(p===0)p=1-O;else{if(p===I)return g?NaN:(k?-1:1)*(1/0);g+=s(2,h),p-=O}return(k?-1:1)*g*s(2,p-h)},c.write=function(l,y,w,h,f,p){var g,E,I,O=Math.LN2,F=Math.log,b=8*p-f-1,S=(1<<b)-1,k=S>>1,D=f===23?s(2,-24)-s(2,-77):0,m=h?0:p-1,C=h?1:-1,A=0>y||y===0&&0>1/y?1:0;for(y=i(y),isNaN(y)||y===1/0?(E=isNaN(y)?1:0,g=S):(g=n(F(y)/O),1>y*(I=s(2,-g))&&(g--,I*=2),y+=1<=g+k?D/I:D*s(2,1-k),2<=y*I&&(g++,I/=2),g+k>=S?(E=0,g=S):1<=g+k?(E=(y*I-1)*s(2,f),g+=k):(E=y*s(2,k-1)*s(2,f),g=0));8<=f;l[w+m]=255&E,m+=C,E/=256,f-=8);for(g=g<<f|E,b+=f;0<b;l[w+m]=255&g,m+=C,g/=256,b-=8);l[w+m-C]|=128*A}},{}],10:[function(o,u){u.exports=typeof Object.create=="function"?function(c,l){l&&(c.super_=l,c.prototype=Object.create(l.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}))}:function(c,l){if(l){c.super_=l;var y=function(){};y.prototype=l.prototype,c.prototype=new y,c.prototype.constructor=c}}},{}],11:[function(o,u){var c=Math.round;function l(f){if(f+="",!(100<f.length)){var p=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(f);if(p){var g=parseFloat(p[1]),E=(p[2]||"ms").toLowerCase();return E==="years"||E==="year"||E==="yrs"||E==="yr"||E==="y"?315576e5*g:E==="weeks"||E==="week"||E==="w"?6048e5*g:E==="days"||E==="day"||E==="d"?864e5*g:E==="hours"||E==="hour"||E==="hrs"||E==="hr"||E==="h"?36e5*g:E==="minutes"||E==="minute"||E==="mins"||E==="min"||E==="m"?6e4*g:E==="seconds"||E==="second"||E==="secs"||E==="sec"||E==="s"?1e3*g:E==="milliseconds"||E==="millisecond"||E==="msecs"||E==="msec"||E==="ms"?g:void 0}}}function y(f){var p=i(f);return 864e5<=p?c(f/864e5)+"d":36e5<=p?c(f/36e5)+"h":6e4<=p?c(f/6e4)+"m":1e3<=p?c(f/1e3)+"s":f+"ms"}function w(f){var p=i(f);return 864e5<=p?h(f,p,864e5,"day"):36e5<=p?h(f,p,36e5,"hour"):6e4<=p?h(f,p,6e4,"minute"):1e3<=p?h(f,p,1e3,"second"):f+" ms"}function h(f,p,g,E){return c(f/g)+" "+E+(p>=1.5*g?"s":"")}u.exports=function(f,p){p=p||{};var g=typeof f;if(g=="string"&&0<f.length)return l(f);if(g==="number"&&isFinite(f))return p.long?w(f):y(f);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(f))}},{}],12:[function(o,u){function c(){throw new Error("setTimeout has not been defined")}function l(){throw new Error("clearTimeout has not been defined")}function y(D){if(E===setTimeout)return setTimeout(D,0);if((E===c||!E)&&setTimeout)return E=setTimeout,setTimeout(D,0);try{return E(D,0)}catch{try{return E.call(null,D,0)}catch{return E.call(this,D,0)}}}function w(D){if(I===clearTimeout)return clearTimeout(D);if((I===l||!I)&&clearTimeout)return I=clearTimeout,clearTimeout(D);try{return I(D)}catch{try{return I.call(null,D)}catch{return I.call(this,D)}}}function h(){S&&F&&(S=!1,F.length?b=F.concat(b):k=-1,b.length&&f())}function f(){if(!S){var D=y(h);S=!0;for(var m=b.length;m;){for(F=b,b=[];++k<m;)F&&F[k].run();k=-1,m=b.length}F=null,S=!1,w(D)}}function p(D,m){this.fun=D,this.array=m}function g(){}var E,I,O=u.exports={};(function(){try{E=typeof setTimeout=="function"?setTimeout:c}catch{E=c}try{I=typeof clearTimeout=="function"?clearTimeout:l}catch{I=l}})();var F,b=[],S=!1,k=-1;O.nextTick=function(D){var m=Array(arguments.length-1);if(1<arguments.length)for(var C=1;C<arguments.length;C++)m[C-1]=arguments[C];b.push(new p(D,m)),b.length!==1||S||y(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},O.title="browser",O.browser=!0,O.env={},O.argv=[],O.version="",O.versions={},O.on=g,O.addListener=g,O.once=g,O.off=g,O.removeListener=g,O.removeAllListeners=g,O.emit=g,O.prependListener=g,O.prependOnceListener=g,O.listeners=function(){return[]},O.binding=function(){throw new Error("process.binding is not supported")},O.cwd=function(){return"/"},O.chdir=function(){throw new Error("process.chdir is not supported")},O.umask=function(){return 0}},{}],13:[function(o,u){(function(c){(function(){/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let l;u.exports=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window=="undefined"?c:window):y=>(l||(l=Promise.resolve())).then(y).catch(w=>setTimeout(()=>{throw w},0))}).call(this)}).call(this,typeof kt=="undefined"?typeof self=="undefined"?typeof window=="undefined"?{}:window:self:kt)},{}],14:[function(o,u){(function(c,l){(function(){var y=o("safe-buffer").Buffer,w=l.crypto||l.msCrypto;u.exports=w&&w.getRandomValues?function(h,f){if(h>4294967295)throw new RangeError("requested too many random bytes");var p=y.allocUnsafe(h);if(0<h)if(65536<h)for(var g=0;g<h;g+=65536)w.getRandomValues(p.slice(g,g+65536));else w.getRandomValues(p);return typeof f=="function"?c.nextTick(function(){f(null,p)}):p}:function(){throw new Error(`Secure random number generation is not supported by this browser.
Use Chrome, Firefox or Internet Explorer 11`)}}).call(this)}).call(this,o("_process"),typeof kt=="undefined"?typeof self=="undefined"?typeof window=="undefined"?{}:window:self:kt)},{_process:12,"safe-buffer":30}],15:[function(o,u){function c(g,E){g.prototype=Object.create(E.prototype),g.prototype.constructor=g,g.__proto__=E}function l(g,E,I){function O(b,S,k){return typeof E=="string"?E:E(b,S,k)}I||(I=Error);var F=function(b){function S(k,D,m){return b.call(this,O(k,D,m))||this}return c(S,b),S}(I);F.prototype.name=I.name,F.prototype.code=g,p[g]=F}function y(g,E){if(Array.isArray(g)){var I=g.length;return g=g.map(function(O){return O+""}),2<I?"one of ".concat(E," ").concat(g.slice(0,I-1).join(", "),", or ")+g[I-1]:I===2?"one of ".concat(E," ").concat(g[0]," or ").concat(g[1]):"of ".concat(E," ").concat(g[0])}return"of ".concat(E," ").concat(g+"")}function w(g,E,I){return g.substr(!I||0>I?0:+I,E.length)===E}function h(g,E,I){return(I===void 0||I>g.length)&&(I=g.length),g.substring(I-E.length,I)===E}function f(g,E,I){return typeof I!="number"&&(I=0),!(I+E.length>g.length)&&g.indexOf(E,I)!==-1}var p={};l("ERR_INVALID_OPT_VALUE",function(g,E){return'The value "'+E+'" is invalid for option "'+g+'"'},TypeError),l("ERR_INVALID_ARG_TYPE",function(g,E,I){var O;typeof E=="string"&&w(E,"not ")?(O="must not be",E=E.replace(/^not /,"")):O="must be";var F;if(h(g," argument"))F="The ".concat(g," ").concat(O," ").concat(y(E,"type"));else{var b=f(g,".")?"property":"argument";F='The "'.concat(g,'" ').concat(b," ").concat(O," ").concat(y(E,"type"))}return F+=". Received type ".concat(typeof I),F},TypeError),l("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),l("ERR_METHOD_NOT_IMPLEMENTED",function(g){return"The "+g+" method is not implemented"}),l("ERR_STREAM_PREMATURE_CLOSE","Premature close"),l("ERR_STREAM_DESTROYED",function(g){return"Cannot call "+g+" after a stream was destroyed"}),l("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),l("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),l("ERR_STREAM_WRITE_AFTER_END","write after end"),l("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),l("ERR_UNKNOWN_ENCODING",function(g){return"Unknown encoding: "+g},TypeError),l("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),u.exports.codes=p},{}],16:[function(o,u){(function(c){(function(){function l(O){return this instanceof l?(f.call(this,O),p.call(this,O),this.allowHalfOpen=!0,void(O&&(O.readable===!1&&(this.readable=!1),O.writable===!1&&(this.writable=!1),O.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",y))))):new l(O)}function y(){this._writableState.ended||c.nextTick(w,this)}function w(O){O.end()}var h=Object.keys||function(O){var F=[];for(var b in O)F.push(b);return F};u.exports=l;var f=o("./_stream_readable"),p=o("./_stream_writable");o("inherits")(l,f);for(var g,E=h(p.prototype),I=0;I<E.length;I++)g=E[I],l.prototype[g]||(l.prototype[g]=p.prototype[g]);Object.defineProperty(l.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(l.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(l.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(l.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._writableState!==void 0&&this._readableState.destroyed&&this._writableState.destroyed},set:function(O){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=O,this._writableState.destroyed=O)}})}).call(this)}).call(this,o("_process"))},{"./_stream_readable":18,"./_stream_writable":20,_process:12,inherits:10}],17:[function(o,u){function c(y){return this instanceof c?void l.call(this,y):new c(y)}u.exports=c;var l=o("./_stream_transform");o("inherits")(c,l),c.prototype._transform=function(y,w,h){h(null,y)}},{"./_stream_transform":19,inherits:10}],18:[function(o,u){(function(c,l){(function(){function y(_){return Kt.from(_)}function w(_){return Kt.isBuffer(_)||_ instanceof lt}function h(_,r,a){return typeof _.prependListener=="function"?_.prependListener(r,a):void(_._events&&_._events[r]?Array.isArray(_._events[r])?_._events[r].unshift(a):_._events[r]=[a,_._events[r]]:_.on(r,a))}function f(_,r,a){at=at||o("./_stream_duplex"),_=_||{},typeof a!="boolean"&&(a=r instanceof at),this.objectMode=!!_.objectMode,a&&(this.objectMode=this.objectMode||!!_.readableObjectMode),this.highWaterMark=Xe(this,_,"readableHighWaterMark",a),this.buffer=new Ke,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=_.emitClose!==!1,this.autoDestroy=!!_.autoDestroy,this.destroyed=!1,this.defaultEncoding=_.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,_.encoding&&(!At&&(At=o("string_decoder/").StringDecoder),this.decoder=new At(_.encoding),this.encoding=_.encoding)}function p(_){if(at=at||o("./_stream_duplex"),!(this instanceof p))return new p(_);var r=this instanceof at;this._readableState=new f(_,this,r),this.readable=!0,_&&(typeof _.read=="function"&&(this._read=_.read),typeof _.destroy=="function"&&(this._destroy=_.destroy)),Tt.call(this)}function g(_,r,a,d,T){z("readableAddChunk",r);var L=_._readableState;if(r===null)L.reading=!1,b(_,L);else{var U;if(T||(U=I(L,r)),U)B(_,U);else if(!(L.objectMode||r&&0<r.length))d||(L.reading=!1,D(_,L));else if(typeof r=="string"||L.objectMode||Object.getPrototypeOf(r)===Kt.prototype||(r=y(r)),d)L.endEmitted?B(_,new N):E(_,L,r,!0);else if(L.ended)B(_,new It);else{if(L.destroyed)return!1;L.reading=!1,L.decoder&&!a?(r=L.decoder.write(r),L.objectMode||r.length!==0?E(_,L,r,!1):D(_,L)):E(_,L,r,!1)}}return!L.ended&&(L.length<L.highWaterMark||L.length===0)}function E(_,r,a,d){r.flowing&&r.length===0&&!r.sync?(r.awaitDrain=0,_.emit("data",a)):(r.length+=r.objectMode?1:a.length,d?r.buffer.unshift(a):r.buffer.push(a),r.needReadable&&S(_)),D(_,r)}function I(_,r){var a;return w(r)||typeof r=="string"||r===void 0||_.objectMode||(a=new Dt("chunk",["string","Buffer","Uint8Array"],r)),a}function O(_){return 1073741824<=_?_=1073741824:(_--,_|=_>>>1,_|=_>>>2,_|=_>>>4,_|=_>>>8,_|=_>>>16,_++),_}function F(_,r){return 0>=_||r.length===0&&r.ended?0:r.objectMode?1:_===_?(_>r.highWaterMark&&(r.highWaterMark=O(_)),_<=r.length?_:r.ended?r.length:(r.needReadable=!0,0)):r.flowing&&r.length?r.buffer.head.data.length:r.length}function b(_,r){if(z("onEofChunk"),!r.ended){if(r.decoder){var a=r.decoder.end();a&&a.length&&(r.buffer.push(a),r.length+=r.objectMode?1:a.length)}r.ended=!0,r.sync?S(_):(r.needReadable=!1,!r.emittedReadable&&(r.emittedReadable=!0,k(_)))}}function S(_){var r=_._readableState;z("emitReadable",r.needReadable,r.emittedReadable),r.needReadable=!1,r.emittedReadable||(z("emitReadable",r.flowing),r.emittedReadable=!0,c.nextTick(k,_))}function k(_){var r=_._readableState;z("emitReadable_",r.destroyed,r.length,r.ended),!r.destroyed&&(r.length||r.ended)&&(_.emit("readable"),r.emittedReadable=!1),r.needReadable=!r.flowing&&!r.ended&&r.length<=r.highWaterMark,P(_)}function D(_,r){r.readingMore||(r.readingMore=!0,c.nextTick(m,_,r))}function m(_,r){for(;!r.reading&&!r.ended&&(r.length<r.highWaterMark||r.flowing&&r.length===0);){var a=r.length;if(z("maybeReadMore read 0"),_.read(0),a===r.length)break}r.readingMore=!1}function C(_){return function(){var r=_._readableState;z("pipeOnDrain",r.awaitDrain),r.awaitDrain&&r.awaitDrain--,r.awaitDrain===0&&De(_,"data")&&(r.flowing=!0,P(_))}}function A(_){var r=_._readableState;r.readableListening=0<_.listenerCount("readable"),r.resumeScheduled&&!r.paused?r.flowing=!0:0<_.listenerCount("data")&&_.resume()}function v(_){z("readable nexttick read 0"),_.read(0)}function R(_,r){r.resumeScheduled||(r.resumeScheduled=!0,c.nextTick(x,_,r))}function x(_,r){z("resume",r.reading),r.reading||_.read(0),r.resumeScheduled=!1,_.emit("resume"),P(_),r.flowing&&!r.reading&&_.read(0)}function P(_){var r=_._readableState;for(z("flow",r.flowing);r.flowing&&_.read()!==null;);}function q(_,r){if(r.length===0)return null;var a;return r.objectMode?a=r.buffer.shift():!_||_>=r.length?(a=r.decoder?r.buffer.join(""):r.buffer.length===1?r.buffer.first():r.buffer.concat(r.length),r.buffer.clear()):a=r.buffer.consume(_,r.decoder),a}function Y(_){var r=_._readableState;z("endReadable",r.endEmitted),r.endEmitted||(r.ended=!0,c.nextTick(G,r,_))}function G(_,r){if(z("endReadableNT",_.endEmitted,_.length),!_.endEmitted&&_.length===0&&(_.endEmitted=!0,r.readable=!1,r.emit("end"),_.autoDestroy)){var a=r._writableState;(!a||a.autoDestroy&&a.finished)&&r.destroy()}}function et(_,r){for(var a=0,d=_.length;a<d;a++)if(_[a]===r)return a;return-1}u.exports=p;var at;p.ReadableState=f;var z;o("events").EventEmitter;var De=function(_,r){return _.listeners(r).length},Tt=o("./internal/streams/stream"),Kt=o("buffer").Buffer,lt=l.Uint8Array||function(){},nt=o("util");z=nt&&nt.debuglog?nt.debuglog("stream"):function(){};var At,Xt,Zt,Ke=o("./internal/streams/buffer_list"),de=o("./internal/streams/destroy"),fe=o("./internal/streams/state"),Xe=fe.getHighWaterMark,Qt=o("../errors").codes,Dt=Qt.ERR_INVALID_ARG_TYPE,It=Qt.ERR_STREAM_PUSH_AFTER_EOF,M=Qt.ERR_METHOD_NOT_IMPLEMENTED,N=Qt.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;o("inherits")(p,Tt);var B=de.errorOrDestroy,V=["error","close","destroy","pause","resume"];Object.defineProperty(p.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._readableState.destroyed},set:function(_){this._readableState&&(this._readableState.destroyed=_)}}),p.prototype.destroy=de.destroy,p.prototype._undestroy=de.undestroy,p.prototype._destroy=function(_,r){r(_)},p.prototype.push=function(_,r){var a,d=this._readableState;return d.objectMode?a=!0:typeof _=="string"&&(r=r||d.defaultEncoding,r!==d.encoding&&(_=Kt.from(_,r),r=""),a=!0),g(this,_,r,!1,a)},p.prototype.unshift=function(_){return g(this,_,null,!0,!1)},p.prototype.isPaused=function(){return this._readableState.flowing===!1},p.prototype.setEncoding=function(_){At||(At=o("string_decoder/").StringDecoder);var r=new At(_);this._readableState.decoder=r,this._readableState.encoding=this._readableState.decoder.encoding;for(var a=this._readableState.buffer.head,d="";a!==null;)d+=r.write(a.data),a=a.next;return this._readableState.buffer.clear(),d!==""&&this._readableState.buffer.push(d),this._readableState.length=d.length,this},p.prototype.read=function(_){z("read",_),_=parseInt(_,10);var r=this._readableState,a=_;if(_!==0&&(r.emittedReadable=!1),_===0&&r.needReadable&&((r.highWaterMark===0?0<r.length:r.length>=r.highWaterMark)||r.ended))return z("read: emitReadable",r.length,r.ended),r.length===0&&r.ended?Y(this):S(this),null;if(_=F(_,r),_===0&&r.ended)return r.length===0&&Y(this),null;var d=r.needReadable;z("need readable",d),(r.length===0||r.length-_<r.highWaterMark)&&(d=!0,z("length less than watermark",d)),r.ended||r.reading?(d=!1,z("reading or ended",d)):d&&(z("do read"),r.reading=!0,r.sync=!0,r.length===0&&(r.needReadable=!0),this._read(r.highWaterMark),r.sync=!1,!r.reading&&(_=F(a,r)));var T;return T=0<_?q(_,r):null,T===null?(r.needReadable=r.length<=r.highWaterMark,_=0):(r.length-=_,r.awaitDrain=0),r.length===0&&(!r.ended&&(r.needReadable=!0),a!==_&&r.ended&&Y(this)),T!==null&&this.emit("data",T),T},p.prototype._read=function(){B(this,new M("_read()"))},p.prototype.pipe=function(_,r){function a(Le,Me){z("onunpipe"),Le===Q&&Me&&Me.hasUnpiped===!1&&(Me.hasUnpiped=!0,T())}function d(){z("onend"),_.end()}function T(){z("cleanup"),_.removeListener("close",j),_.removeListener("finish",Z),_.removeListener("drain",Ie),_.removeListener("error",U),_.removeListener("unpipe",a),Q.removeListener("end",d),Q.removeListener("end",it),Q.removeListener("data",L),Ze=!0,X.awaitDrain&&(!_._writableState||_._writableState.needDrain)&&Ie()}function L(Le){z("ondata");var Me=_.write(Le);z("dest.write",Me),Me===!1&&((X.pipesCount===1&&X.pipes===_||1<X.pipesCount&&et(X.pipes,_)!==-1)&&!Ze&&(z("false write response, pause",X.awaitDrain),X.awaitDrain++),Q.pause())}function U(Le){z("onerror",Le),it(),_.removeListener("error",U),De(_,"error")===0&&B(_,Le)}function j(){_.removeListener("finish",Z),it()}function Z(){z("onfinish"),_.removeListener("close",j),it()}function it(){z("unpipe"),Q.unpipe(_)}var Q=this,X=this._readableState;switch(X.pipesCount){case 0:X.pipes=_;break;case 1:X.pipes=[X.pipes,_];break;default:X.pipes.push(_)}X.pipesCount+=1,z("pipe count=%d opts=%j",X.pipesCount,r);var wt=(!r||r.end!==!1)&&_!==c.stdout&&_!==c.stderr,ge=wt?d:it;X.endEmitted?c.nextTick(ge):Q.once("end",ge),_.on("unpipe",a);var Ie=C(Q);_.on("drain",Ie);var Ze=!1;return Q.on("data",L),h(_,"error",U),_.once("close",j),_.once("finish",Z),_.emit("pipe",Q),X.flowing||(z("pipe resume"),Q.resume()),_},p.prototype.unpipe=function(_){var r=this._readableState,a={hasUnpiped:!1};if(r.pipesCount===0)return this;if(r.pipesCount===1)return _&&_!==r.pipes?this:(_||(_=r.pipes),r.pipes=null,r.pipesCount=0,r.flowing=!1,_&&_.emit("unpipe",this,a),this);if(!_){var d=r.pipes,T=r.pipesCount;r.pipes=null,r.pipesCount=0,r.flowing=!1;for(var L=0;L<T;L++)d[L].emit("unpipe",this,{hasUnpiped:!1});return this}var U=et(r.pipes,_);return U===-1?this:(r.pipes.splice(U,1),r.pipesCount-=1,r.pipesCount===1&&(r.pipes=r.pipes[0]),_.emit("unpipe",this,a),this)},p.prototype.on=function(_,r){var a=Tt.prototype.on.call(this,_,r),d=this._readableState;return _==="data"?(d.readableListening=0<this.listenerCount("readable"),d.flowing!==!1&&this.resume()):_=="readable"&&!d.endEmitted&&!d.readableListening&&(d.readableListening=d.needReadable=!0,d.flowing=!1,d.emittedReadable=!1,z("on readable",d.length,d.reading),d.length?S(this):!d.reading&&c.nextTick(v,this)),a},p.prototype.addListener=p.prototype.on,p.prototype.removeListener=function(_,r){var a=Tt.prototype.removeListener.call(this,_,r);return _==="readable"&&c.nextTick(A,this),a},p.prototype.removeAllListeners=function(_){var r=Tt.prototype.removeAllListeners.apply(this,arguments);return(_==="readable"||_===void 0)&&c.nextTick(A,this),r},p.prototype.resume=function(){var _=this._readableState;return _.flowing||(z("resume"),_.flowing=!_.readableListening,R(this,_)),_.paused=!1,this},p.prototype.pause=function(){return z("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(z("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},p.prototype.wrap=function(_){var r=this,a=this._readableState,d=!1;for(var T in _.on("end",function(){if(z("wrapped end"),a.decoder&&!a.ended){var U=a.decoder.end();U&&U.length&&r.push(U)}r.push(null)}),_.on("data",function(U){if(z("wrapped data"),a.decoder&&(U=a.decoder.write(U)),!(a.objectMode&&U==null)&&(a.objectMode||U&&U.length)){var j=r.push(U);j||(d=!0,_.pause())}}),_)this[T]===void 0&&typeof _[T]=="function"&&(this[T]=function(U){return function(){return _[U].apply(_,arguments)}}(T));for(var L=0;L<V.length;L++)_.on(V[L],this.emit.bind(this,V[L]));return this._read=function(U){z("wrapped _read",U),d&&(d=!1,_.resume())},this},typeof Symbol=="function"&&(p.prototype[Symbol.asyncIterator]=function(){return Xt===void 0&&(Xt=o("./internal/streams/async_iterator")),Xt(this)}),Object.defineProperty(p.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(p.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(p.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(_){this._readableState&&(this._readableState.flowing=_)}}),p._fromList=q,Object.defineProperty(p.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),typeof Symbol=="function"&&(p.from=function(_,r){return Zt===void 0&&(Zt=o("./internal/streams/from")),Zt(p,_,r)})}).call(this)}).call(this,o("_process"),typeof kt=="undefined"?typeof self=="undefined"?typeof window=="undefined"?{}:window:self:kt)},{"../errors":15,"./_stream_duplex":16,"./internal/streams/async_iterator":21,"./internal/streams/buffer_list":22,"./internal/streams/destroy":23,"./internal/streams/from":25,"./internal/streams/state":27,"./internal/streams/stream":28,_process:12,buffer:3,events:7,inherits:10,"string_decoder/":31,util:2}],19:[function(o,u){function c(O,F){var b=this._transformState;b.transforming=!1;var S=b.writecb;if(S===null)return this.emit("error",new p);b.writechunk=null,b.writecb=null,F!=null&&this.push(F),S(O);var k=this._readableState;k.reading=!1,(k.needReadable||k.length<k.highWaterMark)&&this._read(k.highWaterMark)}function l(O){return this instanceof l?(I.call(this,O),this._transformState={afterTransform:c.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,O&&(typeof O.transform=="function"&&(this._transform=O.transform),typeof O.flush=="function"&&(this._flush=O.flush)),void this.on("prefinish",y)):new l(O)}function y(){var O=this;typeof this._flush!="function"||this._readableState.destroyed?w(this,null,null):this._flush(function(F,b){w(O,F,b)})}function w(O,F,b){if(F)return O.emit("error",F);if(b!=null&&O.push(b),O._writableState.length)throw new E;if(O._transformState.transforming)throw new g;return O.push(null)}u.exports=l;var h=o("../errors").codes,f=h.ERR_METHOD_NOT_IMPLEMENTED,p=h.ERR_MULTIPLE_CALLBACK,g=h.ERR_TRANSFORM_ALREADY_TRANSFORMING,E=h.ERR_TRANSFORM_WITH_LENGTH_0,I=o("./_stream_duplex");o("inherits")(l,I),l.prototype.push=function(O,F){return this._transformState.needTransform=!1,I.prototype.push.call(this,O,F)},l.prototype._transform=function(O,F,b){b(new f("_transform()"))},l.prototype._write=function(O,F,b){var S=this._transformState;if(S.writecb=b,S.writechunk=O,S.writeencoding=F,!S.transforming){var k=this._readableState;(S.needTransform||k.needReadable||k.length<k.highWaterMark)&&this._read(k.highWaterMark)}},l.prototype._read=function(){var O=this._transformState;O.writechunk===null||O.transforming?O.needTransform=!0:(O.transforming=!0,this._transform(O.writechunk,O.writeencoding,O.afterTransform))},l.prototype._destroy=function(O,F){I.prototype._destroy.call(this,O,function(b){F(b)})}},{"../errors":15,"./_stream_duplex":16,inherits:10}],20:[function(o,u){(function(c,l){(function(){function y(M){var N=this;this.next=null,this.entry=null,this.finish=function(){Y(N,M)}}function w(M){return z.from(M)}function h(M){return z.isBuffer(M)||M instanceof De}function f(){}function p(M,N,B){G=G||o("./_stream_duplex"),M=M||{},typeof B!="boolean"&&(B=N instanceof G),this.objectMode=!!M.objectMode,B&&(this.objectMode=this.objectMode||!!M.writableObjectMode),this.highWaterMark=lt(this,M,"writableHighWaterMark",B),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var V=M.decodeStrings===!1;this.decodeStrings=!V,this.defaultEncoding=M.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(_){D(N,_)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=M.emitClose!==!1,this.autoDestroy=!!M.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new y(this)}function g(M){G=G||o("./_stream_duplex");var N=this instanceof G;return N||It.call(g,this)?(this._writableState=new p(M,this,N),this.writable=!0,M&&(typeof M.write=="function"&&(this._write=M.write),typeof M.writev=="function"&&(this._writev=M.writev),typeof M.destroy=="function"&&(this._destroy=M.destroy),typeof M.final=="function"&&(this._final=M.final)),void at.call(this)):new g(M)}function E(M,N){var B=new Xe;Dt(M,B),c.nextTick(N,B)}function I(M,N,B,V){var _;return B===null?_=new fe:typeof B!="string"&&!N.objectMode&&(_=new At("chunk",["string","Buffer"],B)),!_||(Dt(M,_),c.nextTick(V,_),!1)}function O(M,N,B){return M.objectMode||M.decodeStrings===!1||typeof N!="string"||(N=z.from(N,B)),N}function F(M,N,B,V,_,r){if(!B){var a=O(N,V,_);V!==a&&(B=!0,_="buffer",V=a)}var d=N.objectMode?1:V.length;N.length+=d;var T=N.length<N.highWaterMark;if(T||(N.needDrain=!0),N.writing||N.corked){var L=N.lastBufferedRequest;N.lastBufferedRequest={chunk:V,encoding:_,isBuf:B,callback:r,next:null},L?L.next=N.lastBufferedRequest:N.bufferedRequest=N.lastBufferedRequest,N.bufferedRequestCount+=1}else b(M,N,!1,d,V,_,r);return T}function b(M,N,B,V,_,r,a){N.writelen=V,N.writecb=a,N.writing=!0,N.sync=!0,N.destroyed?N.onwrite(new de("write")):B?M._writev(_,N.onwrite):M._write(_,r,N.onwrite),N.sync=!1}function S(M,N,B,V,_){--N.pendingcb,B?(c.nextTick(_,V),c.nextTick(P,M,N),M._writableState.errorEmitted=!0,Dt(M,V)):(_(V),M._writableState.errorEmitted=!0,Dt(M,V),P(M,N))}function k(M){M.writing=!1,M.writecb=null,M.length-=M.writelen,M.writelen=0}function D(M,N){var B=M._writableState,V=B.sync,_=B.writecb;if(typeof _!="function")throw new Zt;if(k(B),N)S(M,B,V,N,_);else{var r=v(B)||M.destroyed;r||B.corked||B.bufferProcessing||!B.bufferedRequest||A(M,B),V?c.nextTick(m,M,B,r,_):m(M,B,r,_)}}function m(M,N,B,V){B||C(M,N),N.pendingcb--,V(),P(M,N)}function C(M,N){N.length===0&&N.needDrain&&(N.needDrain=!1,M.emit("drain"))}function A(M,N){N.bufferProcessing=!0;var B=N.bufferedRequest;if(M._writev&&B&&B.next){var V=N.bufferedRequestCount,_=Array(V),r=N.corkedRequestsFree;r.entry=B;for(var a=0,d=!0;B;)_[a]=B,B.isBuf||(d=!1),B=B.next,a+=1;_.allBuffers=d,b(M,N,!0,N.length,_,"",r.finish),N.pendingcb++,N.lastBufferedRequest=null,r.next?(N.corkedRequestsFree=r.next,r.next=null):N.corkedRequestsFree=new y(N),N.bufferedRequestCount=0}else{for(;B;){var T=B.chunk,L=B.encoding,U=B.callback,j=N.objectMode?1:T.length;if(b(M,N,!1,j,T,L,U),B=B.next,N.bufferedRequestCount--,N.writing)break}B===null&&(N.lastBufferedRequest=null)}N.bufferedRequest=B,N.bufferProcessing=!1}function v(M){return M.ending&&M.length===0&&M.bufferedRequest===null&&!M.finished&&!M.writing}function R(M,N){M._final(function(B){N.pendingcb--,B&&Dt(M,B),N.prefinished=!0,M.emit("prefinish"),P(M,N)})}function x(M,N){N.prefinished||N.finalCalled||(typeof M._final!="function"||N.destroyed?(N.prefinished=!0,M.emit("prefinish")):(N.pendingcb++,N.finalCalled=!0,c.nextTick(R,M,N)))}function P(M,N){var B=v(N);if(B&&(x(M,N),N.pendingcb===0&&(N.finished=!0,M.emit("finish"),N.autoDestroy))){var V=M._readableState;(!V||V.autoDestroy&&V.endEmitted)&&M.destroy()}return B}function q(M,N,B){N.ending=!0,P(M,N),B&&(N.finished?c.nextTick(B):M.once("finish",B)),N.ended=!0,M.writable=!1}function Y(M,N,B){var V=M.entry;for(M.entry=null;V;){var _=V.callback;N.pendingcb--,_(B),V=V.next}N.corkedRequestsFree.next=M}u.exports=g;var G;g.WritableState=p;var et={deprecate:o("util-deprecate")},at=o("./internal/streams/stream"),z=o("buffer").Buffer,De=l.Uint8Array||function(){},Tt=o("./internal/streams/destroy"),Kt=o("./internal/streams/state"),lt=Kt.getHighWaterMark,nt=o("../errors").codes,At=nt.ERR_INVALID_ARG_TYPE,Xt=nt.ERR_METHOD_NOT_IMPLEMENTED,Zt=nt.ERR_MULTIPLE_CALLBACK,Ke=nt.ERR_STREAM_CANNOT_PIPE,de=nt.ERR_STREAM_DESTROYED,fe=nt.ERR_STREAM_NULL_VALUES,Xe=nt.ERR_STREAM_WRITE_AFTER_END,Qt=nt.ERR_UNKNOWN_ENCODING,Dt=Tt.errorOrDestroy;o("inherits")(g,at),p.prototype.getBuffer=function(){for(var M=this.bufferedRequest,N=[];M;)N.push(M),M=M.next;return N},function(){try{Object.defineProperty(p.prototype,"buffer",{get:et.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var It;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(It=Function.prototype[Symbol.hasInstance],Object.defineProperty(g,Symbol.hasInstance,{value:function(M){return!!It.call(this,M)||this===g&&M&&M._writableState instanceof p}})):It=function(M){return M instanceof this},g.prototype.pipe=function(){Dt(this,new Ke)},g.prototype.write=function(M,N,B){var V=this._writableState,_=!1,r=!V.objectMode&&h(M);return r&&!z.isBuffer(M)&&(M=w(M)),typeof N=="function"&&(B=N,N=null),r?N="buffer":!N&&(N=V.defaultEncoding),typeof B!="function"&&(B=f),V.ending?E(this,B):(r||I(this,V,M,B))&&(V.pendingcb++,_=F(this,V,r,M,N,B)),_},g.prototype.cork=function(){this._writableState.corked++},g.prototype.uncork=function(){var M=this._writableState;M.corked&&(M.corked--,!M.writing&&!M.corked&&!M.bufferProcessing&&M.bufferedRequest&&A(this,M))},g.prototype.setDefaultEncoding=function(M){if(typeof M=="string"&&(M=M.toLowerCase()),!(-1<["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((M+"").toLowerCase())))throw new Qt(M);return this._writableState.defaultEncoding=M,this},Object.defineProperty(g.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(g.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),g.prototype._write=function(M,N,B){B(new Xt("_write()"))},g.prototype._writev=null,g.prototype.end=function(M,N,B){var V=this._writableState;return typeof M=="function"?(B=M,M=null,N=null):typeof N=="function"&&(B=N,N=null),M!=null&&this.write(M,N),V.corked&&(V.corked=1,this.uncork()),V.ending||q(this,V,B),this},Object.defineProperty(g.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(g.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState!==void 0&&this._writableState.destroyed},set:function(M){this._writableState&&(this._writableState.destroyed=M)}}),g.prototype.destroy=Tt.destroy,g.prototype._undestroy=Tt.undestroy,g.prototype._destroy=function(M,N){N(M)}}).call(this)}).call(this,o("_process"),typeof kt=="undefined"?typeof self=="undefined"?typeof window=="undefined"?{}:window:self:kt)},{"../errors":15,"./_stream_duplex":16,"./internal/streams/destroy":23,"./internal/streams/state":27,"./internal/streams/stream":28,_process:12,buffer:3,inherits:10,"util-deprecate":32}],21:[function(o,u){(function(c){(function(){function l(C,A,v){return A in C?Object.defineProperty(C,A,{value:v,enumerable:!0,configurable:!0,writable:!0}):C[A]=v,C}function y(C,A){return{value:C,done:A}}function w(C){var A=C[E];if(A!==null){var v=C[k].read();v!==null&&(C[b]=null,C[E]=null,C[I]=null,A(y(v,!1)))}}function h(C){c.nextTick(w,C)}function f(C,A){return function(v,R){C.then(function(){return A[F]?void v(y(void 0,!0)):void A[S](v,R)},R)}}var p,g=o("./end-of-stream"),E=Symbol("lastResolve"),I=Symbol("lastReject"),O=Symbol("error"),F=Symbol("ended"),b=Symbol("lastPromise"),S=Symbol("handlePromise"),k=Symbol("stream"),D=Object.getPrototypeOf(function(){}),m=Object.setPrototypeOf((p={get stream(){return this[k]},next:function(){var C=this,A=this[O];if(A!==null)return Promise.reject(A);if(this[F])return Promise.resolve(y(void 0,!0));if(this[k].destroyed)return new Promise(function(P,q){c.nextTick(function(){C[O]?q(C[O]):P(y(void 0,!0))})});var v,R=this[b];if(R)v=new Promise(f(R,this));else{var x=this[k].read();if(x!==null)return Promise.resolve(y(x,!1));v=new Promise(this[S])}return this[b]=v,v}},l(p,Symbol.asyncIterator,function(){return this}),l(p,"return",function(){var C=this;return new Promise(function(A,v){C[k].destroy(null,function(R){return R?void v(R):void A(y(void 0,!0))})})}),p),D);u.exports=function(C){var A,v=Object.create(m,(A={},l(A,k,{value:C,writable:!0}),l(A,E,{value:null,writable:!0}),l(A,I,{value:null,writable:!0}),l(A,O,{value:null,writable:!0}),l(A,F,{value:C._readableState.endEmitted,writable:!0}),l(A,S,{value:function(R,x){var P=v[k].read();P?(v[b]=null,v[E]=null,v[I]=null,R(y(P,!1))):(v[E]=R,v[I]=x)},writable:!0}),A));return v[b]=null,g(C,function(R){if(R&&R.code!=="ERR_STREAM_PREMATURE_CLOSE"){var x=v[I];return x!==null&&(v[b]=null,v[E]=null,v[I]=null,x(R)),void(v[O]=R)}var P=v[E];P!==null&&(v[b]=null,v[E]=null,v[I]=null,P(y(void 0,!0))),v[F]=!0}),C.on("readable",h.bind(null,v)),v}}).call(this)}).call(this,o("_process"))},{"./end-of-stream":24,_process:12}],22:[function(o,u){function c(b,S){var k=Object.keys(b);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(b);S&&(D=D.filter(function(m){return Object.getOwnPropertyDescriptor(b,m).enumerable})),k.push.apply(k,D)}return k}function l(b){for(var S,k=1;k<arguments.length;k++)S=arguments[k]==null?{}:arguments[k],k%2?c(Object(S),!0).forEach(function(D){y(b,D,S[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(b,Object.getOwnPropertyDescriptors(S)):c(Object(S)).forEach(function(D){Object.defineProperty(b,D,Object.getOwnPropertyDescriptor(S,D))});return b}function y(b,S,k){return S in b?Object.defineProperty(b,S,{value:k,enumerable:!0,configurable:!0,writable:!0}):b[S]=k,b}function w(b,S){if(!(b instanceof S))throw new TypeError("Cannot call a class as a function")}function h(b,S){for(var k,D=0;D<S.length;D++)k=S[D],k.enumerable=k.enumerable||!1,k.configurable=!0,"value"in k&&(k.writable=!0),Object.defineProperty(b,k.key,k)}function f(b,S,k){return S&&h(b.prototype,S),k&&h(b,k),b}function p(b,S,k){E.prototype.copy.call(b,S,k)}var g=o("buffer"),E=g.Buffer,I=o("util"),O=I.inspect,F=O&&O.custom||"inspect";u.exports=function(){function b(){w(this,b),this.head=null,this.tail=null,this.length=0}return f(b,[{key:"push",value:function(S){var k={data:S,next:null};0<this.length?this.tail.next=k:this.head=k,this.tail=k,++this.length}},{key:"unshift",value:function(S){var k={data:S,next:this.head};this.length===0&&(this.tail=k),this.head=k,++this.length}},{key:"shift",value:function(){if(this.length!==0){var S=this.head.data;return this.head=this.length===1?this.tail=null:this.head.next,--this.length,S}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(S){if(this.length===0)return"";for(var k=this.head,D=""+k.data;k=k.next;)D+=S+k.data;return D}},{key:"concat",value:function(S){if(this.length===0)return E.alloc(0);for(var k=E.allocUnsafe(S>>>0),D=this.head,m=0;D;)p(D.data,k,m),m+=D.data.length,D=D.next;return k}},{key:"consume",value:function(S,k){var D;return S<this.head.data.length?(D=this.head.data.slice(0,S),this.head.data=this.head.data.slice(S)):S===this.head.data.length?D=this.shift():D=k?this._getString(S):this._getBuffer(S),D}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(S){var k=this.head,D=1,m=k.data;for(S-=m.length;k=k.next;){var C=k.data,A=S>C.length?C.length:S;if(m+=A===C.length?C:C.slice(0,S),S-=A,S===0){A===C.length?(++D,this.head=k.next?k.next:this.tail=null):(this.head=k,k.data=C.slice(A));break}++D}return this.length-=D,m}},{key:"_getBuffer",value:function(S){var k=E.allocUnsafe(S),D=this.head,m=1;for(D.data.copy(k),S-=D.data.length;D=D.next;){var C=D.data,A=S>C.length?C.length:S;if(C.copy(k,k.length-S,0,A),S-=A,S===0){A===C.length?(++m,this.head=D.next?D.next:this.tail=null):(this.head=D,D.data=C.slice(A));break}++m}return this.length-=m,k}},{key:F,value:function(S,k){return O(this,l({},k,{depth:0,customInspect:!1}))}}]),b}()},{buffer:3,util:2}],23:[function(o,u){(function(c){(function(){function l(h,f){w(h,f),y(h)}function y(h){h._writableState&&!h._writableState.emitClose||h._readableState&&!h._readableState.emitClose||h.emit("close")}function w(h,f){h.emit("error",f)}u.exports={destroy:function(h,f){var p=this,g=this._readableState&&this._readableState.destroyed,E=this._writableState&&this._writableState.destroyed;return g||E?(f?f(h):h&&(this._writableState?!this._writableState.errorEmitted&&(this._writableState.errorEmitted=!0,c.nextTick(w,this,h)):c.nextTick(w,this,h)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(h||null,function(I){!f&&I?p._writableState?p._writableState.errorEmitted?c.nextTick(y,p):(p._writableState.errorEmitted=!0,c.nextTick(l,p,I)):c.nextTick(l,p,I):f?(c.nextTick(y,p),f(I)):c.nextTick(y,p)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(h,f){var p=h._readableState,g=h._writableState;p&&p.autoDestroy||g&&g.autoDestroy?h.destroy(f):h.emit("error",f)}}}).call(this)}).call(this,o("_process"))},{_process:12}],24:[function(o,u){function c(f){var p=!1;return function(){if(!p){p=!0;for(var g=arguments.length,E=Array(g),I=0;I<g;I++)E[I]=arguments[I];f.apply(this,E)}}}function l(){}function y(f){return f.setHeader&&typeof f.abort=="function"}function w(f,p,g){if(typeof p=="function")return w(f,null,p);p||(p={}),g=c(g||l);var E=p.readable||p.readable!==!1&&f.readable,I=p.writable||p.writable!==!1&&f.writable,O=function(){f.writable||b()},F=f._writableState&&f._writableState.finished,b=function(){I=!1,F=!0,E||g.call(f)},S=f._readableState&&f._readableState.endEmitted,k=function(){E=!1,S=!0,I||g.call(f)},D=function(A){g.call(f,A)},m=function(){var A;return E&&!S?(f._readableState&&f._readableState.ended||(A=new h),g.call(f,A)):I&&!F?(f._writableState&&f._writableState.ended||(A=new h),g.call(f,A)):void 0},C=function(){f.req.on("finish",b)};return y(f)?(f.on("complete",b),f.on("abort",m),f.req?C():f.on("request",C)):I&&!f._writableState&&(f.on("end",O),f.on("close",O)),f.on("end",k),f.on("finish",b),p.error!==!1&&f.on("error",D),f.on("close",m),function(){f.removeListener("complete",b),f.removeListener("abort",m),f.removeListener("request",C),f.req&&f.req.removeListener("finish",b),f.removeListener("end",O),f.removeListener("close",O),f.removeListener("finish",b),f.removeListener("end",k),f.removeListener("error",D),f.removeListener("close",m)}}var h=o("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;u.exports=w},{"../../../errors":15}],25:[function(o,u){u.exports=function(){throw new Error("Readable.from is not available in the browser")}},{}],26:[function(o,u){function c(F){var b=!1;return function(){b||(b=!0,F.apply(void 0,arguments))}}function l(F){if(F)throw F}function y(F){return F.setHeader&&typeof F.abort=="function"}function w(F,b,S,k){k=c(k);var D=!1;F.on("close",function(){D=!0}),g===void 0&&(g=o("./end-of-stream")),g(F,{readable:b,writable:S},function(C){return C?k(C):(D=!0,void k())});var m=!1;return function(C){if(!D)return m?void 0:(m=!0,y(F)?F.abort():typeof F.destroy=="function"?F.destroy():void k(C||new O("pipe")))}}function h(F){F()}function f(F,b){return F.pipe(b)}function p(F){return F.length&&typeof F[F.length-1]=="function"?F.pop():l}var g,E=o("../../../errors").codes,I=E.ERR_MISSING_ARGS,O=E.ERR_STREAM_DESTROYED;u.exports=function(){for(var F=arguments.length,b=Array(F),S=0;S<F;S++)b[S]=arguments[S];var k=p(b);if(Array.isArray(b[0])&&(b=b[0]),2>b.length)throw new I("streams");var D,m=b.map(function(C,A){var v=A<b.length-1;return w(C,v,0<A,function(R){D||(D=R),R&&m.forEach(h),v||(m.forEach(h),k(D))})});return b.reduce(f)}},{"../../../errors":15,"./end-of-stream":24}],27:[function(o,u){function c(y,w,h){return y.highWaterMark==null?w?y[h]:null:y.highWaterMark}var l=o("../../../errors").codes.ERR_INVALID_OPT_VALUE;u.exports={getHighWaterMark:function(y,w,h,f){var p=c(w,f,h);if(p!=null){if(!(isFinite(p)&&n(p)===p)||0>p){var g=f?h:"highWaterMark";throw new l(g,p)}return n(p)}return y.objectMode?16:16384}}},{"../../../errors":15}],28:[function(o,u){u.exports=o("events").EventEmitter},{events:7}],29:[function(o,u,c){c=u.exports=o("./lib/_stream_readable.js"),c.Stream=c,c.Readable=c,c.Writable=o("./lib/_stream_writable.js"),c.Duplex=o("./lib/_stream_duplex.js"),c.Transform=o("./lib/_stream_transform.js"),c.PassThrough=o("./lib/_stream_passthrough.js"),c.finished=o("./lib/internal/streams/end-of-stream.js"),c.pipeline=o("./lib/internal/streams/pipeline.js")},{"./lib/_stream_duplex.js":16,"./lib/_stream_passthrough.js":17,"./lib/_stream_readable.js":18,"./lib/_stream_transform.js":19,"./lib/_stream_writable.js":20,"./lib/internal/streams/end-of-stream.js":24,"./lib/internal/streams/pipeline.js":26}],30:[function(o,u,c){function l(f,p){for(var g in f)p[g]=f[g]}function y(f,p,g){return h(f,p,g)}/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var w=o("buffer"),h=w.Buffer;h.from&&h.alloc&&h.allocUnsafe&&h.allocUnsafeSlow?u.exports=w:(l(w,c),c.Buffer=y),y.prototype=Object.create(h.prototype),l(h,y),y.from=function(f,p,g){if(typeof f=="number")throw new TypeError("Argument must not be a number");return h(f,p,g)},y.alloc=function(f,p,g){if(typeof f!="number")throw new TypeError("Argument must be a number");var E=h(f);return p===void 0?E.fill(0):typeof g=="string"?E.fill(p,g):E.fill(p),E},y.allocUnsafe=function(f){if(typeof f!="number")throw new TypeError("Argument must be a number");return h(f)},y.allocUnsafeSlow=function(f){if(typeof f!="number")throw new TypeError("Argument must be a number");return w.SlowBuffer(f)}},{buffer:3}],31:[function(o,u,c){function l(m){if(!m)return"utf8";for(var C;;)switch(m){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return m;default:if(C)return;m=(""+m).toLowerCase(),C=!0}}function y(m){var C=l(m);if(typeof C!="string"&&(k.isEncoding===D||!D(m)))throw new Error("Unknown encoding: "+m);return C||m}function w(m){this.encoding=y(m);var C;switch(this.encoding){case"utf16le":this.text=E,this.end=I,C=4;break;case"utf8":this.fillLast=g,C=4;break;case"base64":this.text=O,this.end=F,C=3;break;default:return this.write=b,void(this.end=S)}this.lastNeed=0,this.lastTotal=0,this.lastChar=k.allocUnsafe(C)}function h(m){return 127>=m?0:m>>5==6?2:m>>4==14?3:m>>3==30?4:m>>6==2?-1:-2}function f(m,C,A){var v=C.length-1;if(v<A)return 0;var R=h(C[v]);return 0<=R?(0<R&&(m.lastNeed=R-1),R):--v<A||R===-2?0:(R=h(C[v]),0<=R?(0<R&&(m.lastNeed=R-2),R):--v<A||R===-2?0:(R=h(C[v]),0<=R?(0<R&&(R===2?R=0:m.lastNeed=R-3),R):0))}function p(m,C){if((192&C[0])!=128)return m.lastNeed=0,"\uFFFD";if(1<m.lastNeed&&1<C.length){if((192&C[1])!=128)return m.lastNeed=1,"\uFFFD";if(2<m.lastNeed&&2<C.length&&(192&C[2])!=128)return m.lastNeed=2,"\uFFFD"}}function g(m){var C=this.lastTotal-this.lastNeed,A=p(this,m);return A===void 0?this.lastNeed<=m.length?(m.copy(this.lastChar,C,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(m.copy(this.lastChar,C,0,m.length),void(this.lastNeed-=m.length)):A}function E(m,C){if((m.length-C)%2==0){var A=m.toString("utf16le",C);if(A){var v=A.charCodeAt(A.length-1);if(55296<=v&&56319>=v)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=m[m.length-2],this.lastChar[1]=m[m.length-1],A.slice(0,-1)}return A}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=m[m.length-1],m.toString("utf16le",C,m.length-1)}function I(m){var C=m&&m.length?this.write(m):"";if(this.lastNeed){var A=this.lastTotal-this.lastNeed;return C+this.lastChar.toString("utf16le",0,A)}return C}function O(m,C){var A=(m.length-C)%3;return A==0?m.toString("base64",C):(this.lastNeed=3-A,this.lastTotal=3,A==1?this.lastChar[0]=m[m.length-1]:(this.lastChar[0]=m[m.length-2],this.lastChar[1]=m[m.length-1]),m.toString("base64",C,m.length-A))}function F(m){var C=m&&m.length?this.write(m):"";return this.lastNeed?C+this.lastChar.toString("base64",0,3-this.lastNeed):C}function b(m){return m.toString(this.encoding)}function S(m){return m&&m.length?this.write(m):""}var k=o("safe-buffer").Buffer,D=k.isEncoding||function(m){switch(m=""+m,m&&m.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};c.StringDecoder=w,w.prototype.write=function(m){if(m.length===0)return"";var C,A;if(this.lastNeed){if(C=this.fillLast(m),C===void 0)return"";A=this.lastNeed,this.lastNeed=0}else A=0;return A<m.length?C?C+this.text(m,A):this.text(m,A):C||""},w.prototype.end=function(m){var C=m&&m.length?this.write(m):"";return this.lastNeed?C+"\uFFFD":C},w.prototype.text=function(m,C){var A=f(this,m,C);if(!this.lastNeed)return m.toString("utf8",C);this.lastTotal=A;var v=m.length-(A-this.lastNeed);return m.copy(this.lastChar,0,v),m.toString("utf8",C,v)},w.prototype.fillLast=function(m){return this.lastNeed<=m.length?(m.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(m.copy(this.lastChar,this.lastTotal-this.lastNeed,0,m.length),void(this.lastNeed-=m.length))}},{"safe-buffer":30}],32:[function(o,u){(function(c){(function(){function l(y){try{if(!c.localStorage)return!1}catch{return!1}var w=c.localStorage[y];return w!=null&&(w+"").toLowerCase()==="true"}u.exports=function(y,w){function h(){if(!f){if(l("throwDeprecation"))throw new Error(w);l("traceDeprecation")?console.trace(w):console.warn(w),f=!0}return y.apply(this,arguments)}if(l("noDeprecation"))return y;var f=!1;return h}}).call(this)}).call(this,typeof kt=="undefined"?typeof self=="undefined"?typeof window=="undefined"?{}:window:self:kt)},{}],"/":[function(o,u){function c(F){return F.replace(/a=ice-options:trickle\s\n/g,"")}function l(F){console.warn(F)}/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const y=o("debug")("simple-peer"),w=o("get-browser-rtc"),h=o("randombytes"),f=o("readable-stream"),p=o("queue-microtask"),g=o("err-code"),{Buffer:E}=o("buffer"),I=65536;class O extends f.Duplex{constructor(b){if(b=Object.assign({allowHalfOpen:!1},b),super(b),this._id=h(4).toString("hex").slice(0,7),this._debug("new peer %o",b),this.channelName=b.initiator?b.channelName||h(20).toString("hex"):null,this.initiator=b.initiator||!1,this.channelConfig=b.channelConfig||O.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},O.config,b.config),this.offerOptions=b.offerOptions||{},this.answerOptions=b.answerOptions||{},this.sdpTransform=b.sdpTransform||(S=>S),this.streams=b.streams||(b.stream?[b.stream]:[]),this.trickle=b.trickle===void 0||b.trickle,this.allowHalfTrickle=b.allowHalfTrickle!==void 0&&b.allowHalfTrickle,this.iceCompleteTimeout=b.iceCompleteTimeout||5e3,this.destroyed=!1,this.destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=b.wrtc&&typeof b.wrtc=="object"?b.wrtc:w(),!this._wrtc)throw g(typeof window=="undefined"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(S){return void this.destroy(g(S,"ERR_PC_CONSTRUCTOR"))}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=S=>{this._onIceCandidate(S)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(S=>{this.destroy(g(S,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=S=>{this._setupData(S)},this.streams&&this.streams.forEach(S=>{this.addStream(S)}),this._pc.ontrack=S=>{this._onTrack(S)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(b){if(!this.destroying){if(this.destroyed)throw g(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof b=="string")try{b=JSON.parse(b)}catch{b={}}this._debug("signal()"),b.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),b.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(b.transceiverRequest.kind,b.transceiverRequest.init)),b.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(b.candidate):this._pendingCandidates.push(b.candidate)),b.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(b)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(S=>{this._addIceCandidate(S)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(S=>{this.destroy(g(S,"ERR_SET_REMOTE_DESCRIPTION"))}),b.sdp||b.candidate||b.renegotiate||b.transceiverRequest||this.destroy(g(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(b){const S=new this._wrtc.RTCIceCandidate(b);this._pc.addIceCandidate(S).catch(k=>{!S.address||S.address.endsWith(".local")?l("Ignoring unsupported ICE candidate."):this.destroy(g(k,"ERR_ADD_ICE_CANDIDATE"))})}send(b){if(!this.destroying){if(this.destroyed)throw g(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(b)}}addTransceiver(b,S){if(!this.destroying){if(this.destroyed)throw g(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(b,S),this._needsNegotiation()}catch(k){this.destroy(g(k,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:b,init:S}})}}addStream(b){if(!this.destroying){if(this.destroyed)throw g(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),b.getTracks().forEach(S=>{this.addTrack(S,b)})}}addTrack(b,S){if(this.destroying)return;if(this.destroyed)throw g(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const k=this._senderMap.get(b)||new Map;let D=k.get(S);if(!D)D=this._pc.addTrack(b,S),k.set(S,D),this._senderMap.set(b,k),this._needsNegotiation();else throw D.removed?g(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):g(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(b,S,k){if(this.destroying)return;if(this.destroyed)throw g(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const D=this._senderMap.get(b),m=D?D.get(k):null;if(!m)throw g(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");S&&this._senderMap.set(S,D),m.replaceTrack==null?this.destroy(g(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK")):m.replaceTrack(S)}removeTrack(b,S){if(this.destroying)return;if(this.destroyed)throw g(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const k=this._senderMap.get(b),D=k?k.get(S):null;if(!D)throw g(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{D.removed=!0,this._pc.removeTrack(D)}catch(m){m.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(D):this.destroy(g(m,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(b){if(!this.destroying){if(this.destroyed)throw g(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),b.getTracks().forEach(S=>{this.removeTrack(S,b)})}}_needsNegotiation(){this._debug("_needsNegotiation"),this._batchedNegotiation||(this._batchedNegotiation=!0,p(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this.destroying){if(this.destroyed)throw g(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}destroy(b){this._destroy(b,()=>{})}_destroy(b,S){this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",b&&(b.message||b)),p(()=>{if(this.destroyed=!0,this.destroying=!1,this._debug("destroy (error: %s)",b&&(b.message||b)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,b&&this.emit("error",b),this.emit("close"),S()}))}_setupData(b){if(!b.channel)return this.destroy(g(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=b.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=I),this.channelName=this._channel.label,this._channel.onmessage=k=>{this._onChannelMessage(k)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=k=>{const D=k.error instanceof Error?k.error:new Error(`Datachannel error: ${k.message} ${k.filename}:${k.lineno}:${k.colno}`);this.destroy(g(D,"ERR_DATA_CHANNEL"))};let S=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(S&&this._onChannelClose(),S=!0):S=!1},5e3)}_read(){}_write(b,S,k){if(this.destroyed)return k(g(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(b)}catch(D){return this.destroy(g(D,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>I?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=k):k(null)}else this._debug("write before connect"),this._chunk=b,this._cb=k}_onFinish(){if(!this.destroyed){const b=()=>{setTimeout(()=>this.destroy(),1e3)};this._connected?b():this.once("connect",b)}}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(b=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(b.sdp=c(b.sdp)),b.sdp=this.sdpTransform(b.sdp);const S=()=>{if(!this.destroyed){const k=this._pc.localDescription||b;this._debug("signal"),this.emit("signal",{type:k.type,sdp:k.sdp})}};this._pc.setLocalDescription(b).then(()=>{this._debug("createOffer success"),this.destroyed||(this.trickle||this._iceComplete?S():this.once("_iceComplete",S))}).catch(k=>{this.destroy(g(k,"ERR_SET_LOCAL_DESCRIPTION"))})}).catch(b=>{this.destroy(g(b,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(b=>{b.mid||!b.sender.track||b.requested||(b.requested=!0,this.addTransceiver(b.sender.track.kind))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(b=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(b.sdp=c(b.sdp)),b.sdp=this.sdpTransform(b.sdp);const S=()=>{if(!this.destroyed){const k=this._pc.localDescription||b;this._debug("signal"),this.emit("signal",{type:k.type,sdp:k.sdp}),this.initiator||this._requestMissingTransceivers()}};this._pc.setLocalDescription(b).then(()=>{this.destroyed||(this.trickle||this._iceComplete?S():this.once("_iceComplete",S))}).catch(k=>{this.destroy(g(k,"ERR_SET_LOCAL_DESCRIPTION"))})}).catch(b=>{this.destroy(g(b,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._pc.connectionState==="failed"&&this.destroy(g(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const b=this._pc.iceConnectionState,S=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",b,S),this.emit("iceStateChange",b,S),(b==="connected"||b==="completed")&&(this._pcReady=!0,this._maybeReady()),b==="failed"&&this.destroy(g(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),b==="closed"&&this.destroy(g(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(b){const S=k=>(Object.prototype.toString.call(k.values)==="[object Array]"&&k.values.forEach(D=>{Object.assign(k,D)}),k);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(k=>{const D=[];k.forEach(m=>{D.push(S(m))}),b(null,D)},k=>b(k)):0<this._pc.getStats.length?this._pc.getStats(k=>{if(this.destroyed)return;const D=[];k.result().forEach(m=>{const C={};m.names().forEach(A=>{C[A]=m.stat(A)}),C.id=m.id,C.type=m.type,C.timestamp=m.timestamp,D.push(S(C))}),b(null,D)},k=>b(k)):b(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const b=()=>{this.destroyed||this.getStats((S,k)=>{if(this.destroyed)return;S&&(k=[]);const D={},m={},C={};let A=!1;k.forEach(R=>{(R.type==="remotecandidate"||R.type==="remote-candidate")&&(D[R.id]=R),(R.type==="localcandidate"||R.type==="local-candidate")&&(m[R.id]=R),(R.type==="candidatepair"||R.type==="candidate-pair")&&(C[R.id]=R)});const v=R=>{A=!0;let x=m[R.localCandidateId];x&&(x.ip||x.address)?(this.localAddress=x.ip||x.address,this.localPort=+x.port):x&&x.ipAddress?(this.localAddress=x.ipAddress,this.localPort=+x.portNumber):typeof R.googLocalAddress=="string"&&(x=R.googLocalAddress.split(":"),this.localAddress=x[0],this.localPort=+x[1]),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let P=D[R.remoteCandidateId];P&&(P.ip||P.address)?(this.remoteAddress=P.ip||P.address,this.remotePort=+P.port):P&&P.ipAddress?(this.remoteAddress=P.ipAddress,this.remotePort=+P.portNumber):typeof R.googRemoteAddress=="string"&&(P=R.googRemoteAddress.split(":"),this.remoteAddress=P[0],this.remotePort=+P[1]),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(k.forEach(R=>{R.type==="transport"&&R.selectedCandidatePairId&&v(C[R.selectedCandidatePairId]),(R.type==="googCandidatePair"&&R.googActiveConnection==="true"||(R.type==="candidatepair"||R.type==="candidate-pair")&&R.selected)&&v(R)}),!A&&(!Object.keys(C).length||Object.keys(m).length))return void setTimeout(b,100);if(this._connecting=!1,this._connected=!0,this._chunk){try{this.send(this._chunk)}catch(x){return this.destroy(g(x,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const R=this._cb;this._cb=null,R(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};b()}_onInterval(){this._cb&&this._channel&&!(this._channel.bufferedAmount>I)&&this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(b=>{this._pc.removeTrack(b),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(b){this.destroyed||(b.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:b.candidate.candidate,sdpMLineIndex:b.candidate.sdpMLineIndex,sdpMid:b.candidate.sdpMid}}):!b.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),b.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(b){if(this.destroyed)return;let S=b.data;S instanceof ArrayBuffer&&(S=E.from(S)),this.push(S)}_onChannelBufferedAmountLow(){if(!this.destroyed&&this._cb){this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const b=this._cb;this._cb=null,b(null)}}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.destroy())}_onTrack(b){this.destroyed||b.streams.forEach(S=>{this._debug("on track"),this.emit("track",b.track,S),this._remoteTracks.push({track:b.track,stream:S}),this._remoteStreams.some(k=>k.id===S.id)||(this._remoteStreams.push(S),p(()=>{this._debug("on stream"),this.emit("stream",S)}))})}_debug(){const b=[].slice.call(arguments);b[0]="["+this._id+"] "+b[0],y.apply(null,b)}}O.WEBRTC_SUPPORT=!!w(),O.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},O.channelConfig={},u.exports=O},{buffer:3,debug:4,"err-code":6,"get-browser-rtc":8,"queue-microtask":13,randombytes:14,"readable-stream":29}]},{},[])("/")})})(os);var Ka=os.exports;const Er=0,Cr=1,as=2,ls=(e,t)=>{H(e,Er);const n=jo(t);ot(e,n)},cs=(e,t,n)=>{H(e,Cr),ot(e,Uo(t,n))},Xa=(e,t,n)=>cs(t,n,ft(e)),hs=(e,t,n)=>{try{Oo(t,ft(e),n)}catch(i){console.error("Caught error while handling a Yjs update",i)}},Za=(e,t)=>{H(e,as),ot(e,t)},Qa=hs,tl=(e,t,n,i)=>{const s=J(e);switch(s){case Er:Xa(e,t,n);break;case Cr:hs(e,n,i);break;case as:Qa(e,n,i);break;default:throw new Error("Unknown message type")}return s},kr=3e4;class el extends ye{constructor(t){super();this.doc=t,this.clientID=t.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{const n=Ft();this.getLocalState()!==null&&kr/2<=n-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const i=[];this.meta.forEach((s,o)=>{o!==this.clientID&&kr<=n-s.lastUpdated&&this.states.has(o)&&i.push(o)}),i.length>0&&Rr(this,i,"timeout")},Lt(kr/10)),t.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(t){const n=this.clientID,i=this.meta.get(n),s=i===void 0?0:i.clock+1,o=this.states.get(n);t===null?this.states.delete(n):this.states.set(n,t),this.meta.set(n,{clock:s,lastUpdated:Ft()});const u=[],c=[],l=[],y=[];t===null?y.push(n):o==null?t!=null&&u.push(n):(c.push(n),Ne(o,t)||l.push(n)),(u.length>0||l.length>0||y.length>0)&&this.emit("change",[{added:u,updated:l,removed:y},"local"]),this.emit("update",[{added:u,updated:c,removed:y},"local"])}setLocalStateField(t,n){const i=this.getLocalState();i!==null&&this.setLocalState(On(pe({},i),{[t]:n}))}getStates(){return this.states}}const Rr=(e,t,n)=>{const i=[];for(let s=0;s<t.length;s++){const o=t[s];if(e.states.has(o)){if(e.states.delete(o),o===e.clientID){const u=e.meta.get(o);e.meta.set(o,{clock:u.clock+1,lastUpdated:Ft()})}i.push(o)}}i.length>0&&(e.emit("change",[{added:[],updated:[],removed:i},n]),e.emit("update",[{added:[],updated:[],removed:i},n]))},Ln=(e,t,n=e.states)=>{const i=t.length,s=gt();H(s,i);for(let o=0;o<i;o++){const u=t[o],c=n.get(u)||null,l=e.meta.get(u).clock;H(s,u),H(s,l),Ut(s,JSON.stringify(c))}return st(s)},nl=(e,t,n)=>{const i=Nt(t),s=Ft(),o=[],u=[],c=[],l=[],y=J(i);for(let w=0;w<y;w++){const h=J(i);let f=J(i);const p=JSON.parse(Vt(i)),g=e.meta.get(h),E=e.states.get(h),I=g===void 0?0:g.clock;(I<f||I===f&&p===null&&e.states.has(h))&&(p===null?h===e.clientID&&e.getLocalState()!=null?f++:e.states.delete(h):e.states.set(h,p),e.meta.set(h,{clock:f,lastUpdated:s}),g===void 0&&p!==null?o.push(h):g!==void 0&&p===null?l.push(h):p!==null&&(Ne(p,E)||c.push(h),u.push(h)))}(o.length>0||c.length>0||l.length>0)&&e.emit("change",[{added:o,updated:c,removed:l},n]),(o.length>0||u.length>0||l.length>0)&&e.emit("update",[{added:o,updated:u,removed:l},n])},rl=(e,t)=>{const n=Un(e).buffer,i=Un(t).buffer;return crypto.subtle.importKey("raw",n,"PBKDF2",!1,["deriveKey"]).then(s=>crypto.subtle.deriveKey({name:"PBKDF2",salt:i,iterations:1e5,hash:"SHA-256"},s,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]))},us=(e,t)=>{if(!t)return Kn(e);const n=crypto.getRandomValues(new Uint8Array(12));return crypto.subtle.encrypt({name:"AES-GCM",iv:n},t,e).then(i=>{const s=gt();return Ut(s,"AES-GCM"),ot(s,n),ot(s,new Uint8Array(i)),st(s)})},il=(e,t)=>{const n=gt();return we(n,e),us(st(n),t)},ds=(e,t)=>{if(!t)return Kn(e);const n=Nt(e);Vt(n)!=="AES-GCM"&&mo($t("Unknown encryption algorithm"));const s=ft(n),o=ft(n);return crypto.subtle.decrypt({name:"AES-GCM",iv:s},t,o).then(u=>new Uint8Array(u))},sl=(e,t)=>ds(e,t).then(n=>me(Nt(new Uint8Array(n)))),Rt=Eo("y-webrtc"),Ae=0,fs=3,Je=1,Tr=4,Mn=new Map,ue=new Map,gs=e=>{let t=!0;e.webrtcConns.forEach(n=>{n.synced||(t=!1)}),(!t&&e.synced||t&&!e.synced)&&(e.synced=t,e.provider.emit("synced",[{synced:t}]),Rt("synced ",vt,e.name,Yt," with all peers"))},ps=(e,t,n)=>{const i=Nt(t),s=gt(),o=J(i);if(e===void 0)return null;const u=e.awareness,c=e.doc;let l=!1;switch(o){case Ae:{H(s,Ae);const y=tl(i,s,c,e);y===Cr&&!e.synced&&n(),y===Er&&(l=!0);break}case fs:H(s,Je),ot(s,Ln(u,Array.from(u.getStates().keys()))),l=!0;break;case Je:nl(u,ft(i),e);break;case Tr:{const y=ie(i)===1,w=Vt(i);if(w!==e.peerId&&(e.bcConns.has(w)&&!y||!e.bcConns.has(w)&&y)){const h=[],f=[];y?(e.bcConns.add(w),f.push(w)):(e.bcConns.delete(w),h.push(w)),e.provider.emit("peers",[{added:f,removed:h,webrtcPeers:Array.from(e.webrtcConns.keys()),bcPeers:Array.from(e.bcConns)}]),ws(e)}break}default:return console.error("Unable to compute message"),s}return l?s:null},ol=(e,t)=>{const n=e.room;return Rt("received message from ",vt,e.remotePeerId,cn," (",n.name,")",Yt,Be),ps(n,t,()=>{e.synced=!0,Rt("synced ",vt,n.name,Yt," with ",vt,e.remotePeerId),gs(n)})},Ar=(e,t)=>{Rt("send message to ",vt,e.remotePeerId,Yt,cn," (",e.room.name,")",Be);try{e.peer.send(st(t))}catch{}},al=(e,t)=>{Rt("broadcast message in ",vt,e.name,Yt),e.webrtcConns.forEach(n=>{try{n.peer.send(t)}catch{}})};class ys{constructor(t,n,i,s){Rt("establishing connection to ",vt,i),this.room=s,this.remotePeerId=i,this.closed=!1,this.connected=!1,this.synced=!1,this.peer=new Ka(pe({initiator:n},s.provider.peerOpts)),this.peer.on("signal",o=>{Ir(t,s,{to:i,from:s.peerId,type:"signal",signal:o})}),this.peer.on("connect",()=>{Rt("connected to ",vt,i),this.connected=!0;const u=s.provider.doc,c=s.awareness,l=gt();H(l,Ae),ls(l,u),Ar(this,l);const y=c.getStates();if(y.size>0){const w=gt();H(w,Je),ot(w,Ln(c,Array.from(y.keys()))),Ar(this,w)}}),this.peer.on("close",()=>{this.connected=!1,this.closed=!0,s.webrtcConns.has(this.remotePeerId)&&(s.webrtcConns.delete(this.remotePeerId),s.provider.emit("peers",[{removed:[this.remotePeerId],added:[],webrtcPeers:Array.from(s.webrtcConns.keys()),bcPeers:Array.from(s.bcConns)}])),gs(s),this.peer.destroy(),Rt("closed connection to ",vt,i),Dr(s)}),this.peer.on("error",o=>{Rt("Error in connection to ",vt,i,": ",o),Dr(s)}),this.peer.on("data",o=>{const u=ol(this,o);u!==null&&Ar(this,u)})}destroy(){this.peer.destroy()}}const Jt=(e,t)=>us(t,e.key).then(n=>e.mux(()=>Ga(e.name,n))),ms=(e,t)=>{e.bcconnected&&Jt(e,t),al(e,t)},Dr=e=>{Mn.forEach(t=>{t.connected&&(t.send({type:"subscribe",topics:[e.name]}),e.webrtcConns.size<e.provider.maxConns&&Ir(t,e,{type:"announce",from:e.peerId}))})},ws=e=>{if(e.provider.filterBcConns){const t=gt();H(t,Tr),Pe(t,1),Ut(t,e.peerId),Jt(e,st(t))}};class ll{constructor(t,n,i,s){this.peerId=si(),this.doc=t,this.awareness=n.awareness,this.provider=n,this.synced=!1,this.name=i,this.key=s,this.webrtcConns=new Map,this.bcConns=new Set,this.mux=Ja(),this.bcconnected=!1,this._bcSubscriber=o=>ds(new Uint8Array(o),s).then(u=>this.mux(()=>{const c=ps(this,u,()=>{});c&&Jt(this,st(c))})),this._docUpdateHandler=(o,u)=>{const c=gt();H(c,Ae),Za(c,o),ms(this,st(c))},this._awarenessUpdateHandler=({added:o,updated:u,removed:c},l)=>{const y=o.concat(u).concat(c),w=gt();H(w,Je),ot(w,Ln(this.awareness,y)),ms(this,st(w))},this._beforeUnloadHandler=()=>{Rr(this.awareness,[t.clientID],"window unload"),ue.forEach(o=>{o.disconnect()})},typeof window!="undefined"?window.addEventListener("beforeunload",this._beforeUnloadHandler):typeof process!="undefined"&&process.on("exit",this._beforeUnloadHandler)}connect(){this.doc.on("update",this._docUpdateHandler),this.awareness.on("update",this._awarenessUpdateHandler),Dr(this);const t=this.name;Ya(t,this._bcSubscriber),this.bcconnected=!0,ws(this);const n=gt();H(n,Ae),ls(n,this.doc),Jt(this,st(n));const i=gt();H(i,Ae),cs(i,this.doc),Jt(this,st(i));const s=gt();H(s,fs),Jt(this,st(s));const o=gt();H(o,Je),ot(o,Ln(this.awareness,[this.doc.clientID])),Jt(this,st(o))}disconnect(){Mn.forEach(n=>{n.connected&&n.send({type:"unsubscribe",topics:[this.name]})}),Rr(this.awareness,[this.doc.clientID],"disconnect");const t=gt();H(t,Tr),Pe(t,0),Ut(t,this.peerId),Jt(this,st(t)),za(this.name,this._bcSubscriber),this.bcconnected=!1,this.doc.off("update",this._docUpdateHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.webrtcConns.forEach(n=>n.destroy())}destroy(){this.disconnect(),typeof window!="undefined"?window.removeEventListener("beforeunload",this._beforeUnloadHandler):typeof process!="undefined"&&process.off("exit",this._beforeUnloadHandler)}}const cl=(e,t,n,i)=>{if(ue.has(n))throw $t(`A Yjs Doc connected to room "${n}" already exists!`);const s=new ll(e,t,n,i);return ue.set(n,s),s},Ir=(e,t,n)=>{t.key?il(n,t.key).then(i=>{e.send({type:"publish",topic:t.name,data:Xr(i)})}):e.send({type:"publish",topic:t.name,data:n})};class hl extends Ha{constructor(t){super(t);this.providers=new Set,this.on("connect",()=>{Rt(`connected (${t})`);const n=Array.from(ue.keys());this.send({type:"subscribe",topics:n}),ue.forEach(i=>Ir(this,i,{type:"announce",from:i.peerId}))}),this.on("message",n=>{switch(n.type){case"publish":{const i=n.topic,s=ue.get(i);if(s==null||typeof i!="string")return;const o=u=>{const c=s.webrtcConns,l=s.peerId;if(u==null||u.from===l||u.to!==void 0&&u.to!==l||s.bcConns.has(u.from))return;const y=c.has(u.from)?()=>{}:()=>s.provider.emit("peers",[{removed:[],added:[u.from],webrtcPeers:Array.from(s.webrtcConns.keys()),bcPeers:Array.from(s.bcConns)}]);switch(u.type){case"announce":c.size<s.provider.maxConns&&(St(c,u.from,()=>new ys(this,!0,u.from,s)),y());break;case"signal":u.to===l&&(St(c,u.from,()=>new ys(this,!1,u.from,s)).peer.signal(u.signal),y());break}};s.key?typeof n.data=="string"&&sl(Zr(n.data),s.key).then(o):o(n.data)}}}),this.on("disconnect",()=>Rt(`disconnect (${t})`))}}class ul extends ye{constructor(t,n,{signaling:i=["wss://signaling.yjs.dev","wss://y-webrtc-signaling-eu.herokuapp.com","wss://y-webrtc-signaling-us.herokuapp.com"],password:s=null,awareness:o=new el(n),maxConns:u=20+Lt(po()*15),filterBcConns:c=!0,peerOpts:l={}}={}){super();this.roomName=t,this.doc=n,this.filterBcConns=c,this.awareness=o,this.shouldConnect=!1,this.signalingUrls=i,this.signalingConns=[],this.maxConns=u,this.peerOpts=l,this.key=s?rl(s,t):Kn(null),this.room=null,this.key.then(y=>{this.room=cl(n,this,t,y),this.shouldConnect?this.room.connect():this.room.disconnect()}),this.connect(),this.destroy=this.destroy.bind(this),n.on("destroy",this.destroy)}get connected(){return this.room!==null&&this.shouldConnect}connect(){this.shouldConnect=!0,this.signalingUrls.forEach(t=>{const n=St(Mn,t,()=>new hl(t));this.signalingConns.push(n),n.providers.add(this)}),this.room&&this.room.connect()}disconnect(){this.shouldConnect=!1,this.signalingConns.forEach(t=>{t.providers.delete(this),t.providers.size===0&&(t.destroy(),Mn.delete(t.url))}),this.room&&this.room.disconnect()}destroy(){this.doc.off("destroy",this.destroy),this.key.then(()=>{this.room.destroy(),ue.delete(this.roomName)}),super.destroy()}}var $=class{static clamp(e,t,n){return Math.max(t,typeof n!="undefined"?Math.min(e,n):e)}static clampV(e,t,n){return e.map(i=>n?$.clamp(i,t,n):$.clamp(i,t))}static cross(e,t,n){return(t[0]-e[0])*(n[1]-e[1])-(n[0]-e[0])*(t[1]-e[1])}static snap(e,t=1){return[Math.round(e[0]/t)*t,Math.round(e[1]/t)*t]}},W=$;W.neg=e=>[-e[0],-e[1]],W.add=(e,t)=>[e[0]+t[0],e[1]+t[1]],W.addScalar=(e,t)=>[e[0]+t,e[1]+t],W.sub=(e,t)=>[e[0]-t[0],e[1]-t[1]],W.subScalar=(e,t)=>[e[0]-t,e[1]-t],W.vec=(e,t)=>[t[0]-e[0],t[1]-e[1]],W.mul=(e,t)=>[e[0]*t,e[1]*t],W.mulV=(e,t)=>[e[0]*t[0],e[1]*t[1]],W.div=(e,t)=>[e[0]/t,e[1]/t],W.divV=(e,t)=>[e[0]/t[0],e[1]/t[1]],W.per=e=>[e[1],-e[0]],W.dpr=(e,t)=>e[0]*t[0]+e[1]*t[1],W.cpr=(e,t)=>e[0]*t[1]-t[0]*e[1],W.len2=e=>e[0]*e[0]+e[1]*e[1],W.len=e=>Math.hypot(e[0],e[1]),W.pry=(e,t)=>$.dpr(e,t)/$.len(t),W.uni=e=>$.div(e,$.len(e)),W.normalize=e=>$.uni(e),W.tangent=(e,t)=>$.uni($.sub(e,t)),W.dist2=(e,t)=>$.len2($.sub(e,t)),W.dist=(e,t)=>Math.hypot(e[1]-t[1],e[0]-t[0]),W.fastDist=(e,t)=>{const n=[t[0]-e[0],t[1]-e[1]],i=[Math.abs(n[0]),Math.abs(n[1])];let s=1/Math.max(i[0],i[1]);return s=s*(1.29289-(i[0]+i[1])*s*.29289),[n[0]*s,n[1]*s]},W.ang=(e,t)=>Math.atan2($.cpr(e,t),$.dpr(e,t)),W.angle=(e,t)=>Math.atan2(t[1]-e[1],t[0]-e[0]),W.med=(e,t)=>$.mul($.add(e,t),.5),W.rot=(e,t=0)=>[e[0]*Math.cos(t)-e[1]*Math.sin(t),e[0]*Math.sin(t)+e[1]*Math.cos(t)],W.rotWith=(e,t,n=0)=>{if(n===0)return e;const i=Math.sin(n),s=Math.cos(n),o=e[0]-t[0],u=e[1]-t[1],c=o*s-u*i,l=o*i+u*s;return[c+t[0],l+t[1]]},W.isEqual=(e,t)=>e[0]===t[0]&&e[1]===t[1],W.lrp=(e,t,n)=>$.add(e,$.mul($.sub(t,e),n)),W.int=(e,t,n,i,s=1)=>{const o=($.clamp(n,i)-n)/(i-n);return $.add($.mul(e,1-o),$.mul(t,s))},W.ang3=(e,t,n)=>{const i=$.vec(t,e),s=$.vec(t,n);return $.ang(i,s)},W.abs=e=>[Math.abs(e[0]),Math.abs(e[1])],W.rescale=(e,t)=>{const n=$.len(e);return[t*e[0]/n,t*e[1]/n]},W.isLeft=(e,t,n)=>(t[0]-e[0])*(n[1]-e[1])-(n[0]-e[0])*(t[1]-e[1]),W.clockwise=(e,t,n)=>$.isLeft(e,t,n)>0,W.toFixed=(e,t=2)=>e.map(n=>+n.toFixed(t)),W.nearestPointOnLineThroughPoint=(e,t,n)=>$.add(e,$.mul(t,$.pry($.sub(n,e),t))),W.distanceToLineThroughPoint=(e,t,n)=>$.dist(n,$.nearestPointOnLineThroughPoint(e,t,n)),W.nearestPointOnLineSegment=(e,t,n,i=!0)=>{const s=$.uni($.sub(t,e)),o=$.add(e,$.mul(s,$.pry($.sub(n,e),s)));if(i){if(o[0]<Math.min(e[0],t[0]))return e[0]<t[0]?e:t;if(o[0]>Math.max(e[0],t[0]))return e[0]>t[0]?e:t;if(o[1]<Math.min(e[1],t[1]))return e[1]<t[1]?e:t;if(o[1]>Math.max(e[1],t[1]))return e[1]>t[1]?e:t}return o},W.distanceToLineSegment=(e,t,n,i=!0)=>$.dist(n,$.nearestPointOnLineSegment(e,t,n,i)),W.nudge=(e,t,n)=>$.isEqual(e,t)?e:$.add(e,$.mul($.uni($.sub(t,e)),n)),W.nudgeAtAngle=(e,t,n)=>[Math.cos(t)*n+e[0],Math.sin(t)*n+e[1]],W.toPrecision=(e,t=4)=>[+e[0].toPrecision(t),+e[1].toPrecision(t)],W.pointsBetween=(e,t,n=6)=>Array.from(Array(n)).map((i,s)=>{const o=s/(n-1),u=Math.min(1,.5+Math.abs(.5-o));return[...$.lrp(e,t,o),u]}),W.slope=(e,t)=>e[0]===t[0]?NaN:(e[1]-t[1])/(e[0]-t[0]),W.max=(...e)=>[Math.max(...e.map(t=>t[0])),Math.max(...e.map(t=>t[1]))],W.min=(...e)=>[Math.max(...e.map(t=>t[0])),Math.max(...e.map(t=>t[1]))];var dl=class{constructor(e=[]){this.points=[],this.lengths=[],this.totalLength=0,this.addPoint=t=>{if(this.prev){const n=W.dist(this.prev,t);this.lengths.push(n),this.totalLength+=n,this.points.push(t)}this.prev=t},this.clear=()=>{this.points=this.prev?[this.prev]:[],this.totalLength=0},this.getSplinePoint=t=>{const{points:n}=this,i=n.length-1,s=Math.trunc(t),o=Math.min(s+1,i),u=Math.min(o+1,i),c=Math.min(u+1,i),l=o-1,y=t-s,w=y*y,h=w*y,f=-h+2*w-y,p=3*h-5*w+2,g=-3*h+4*w+y,E=h-w;return[(n[l][0]*f+n[o][0]*p+n[u][0]*g+n[c][0]*E)/2,(n[l][1]*f+n[o][1]*p+n[u][1]*g+n[c][1]*E)/2]},this.points=e,this.lengths=e.map((t,n,i)=>n===0?0:W.dist(t,i[n-1])),this.totalLength=this.lengths.reduce((t,n)=>t+n,0)}},Lr=class{constructor(e){this.state="idle",this.queue=[],this.timestamp=performance.now(),this.lastRequestId=0,this.timeoutId=0,this.spline=new dl,this.addPoint=t=>{clearTimeout(this.timeoutId);const n=performance.now(),i=Math.min(n-this.timestamp,Lr.MAX_INTERVAL);if(!this.prevPoint){this.spline.clear(),this.prevPoint=t,this.spline.addPoint(t),this.cb(t),this.state="stopped";return}if(this.state==="stopped"){if(W.dist(this.prevPoint,t)<4){this.cb(t);return}this.spline.clear(),this.spline.addPoint(this.prevPoint),this.spline.addPoint(this.prevPoint),this.spline.addPoint(t),this.state="idle"}else this.spline.addPoint(t);if(i<16){this.prevPoint=t,this.timestamp=n,this.cb(t);return}const s={start:this.spline.points.length-3,from:this.prevPoint,to:t,duration:i};switch(this.prevPoint=t,this.timestamp=n,this.state){case"idle":{this.state="animating",this.animateNext(s);break}case"animating":{this.queue.push(s);break}}},this.animateNext=t=>{const n=performance.now(),i=()=>{const s=(performance.now()-n)/t.duration;if(s<=1&&this.spline.points.length>0){try{this.cb(this.spline.getSplinePoint(s+t.start))}catch(u){console.warn(u)}this.lastRequestId=requestAnimationFrame(i);return}const o=this.queue.shift();o?(this.state="animating",this.animateNext(o)):(this.state="idle",this.timeoutId=setTimeout(()=>{this.state="stopped"},Lr.MAX_INTERVAL))};i()},this.dispose=()=>{clearTimeout(this.timeoutId)},this.cb=e}},bs=Lr;bs.MAX_INTERVAL=300;let fl=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((t,n)=>(n&=63,n<36?t+=n.toString(36):n<62?t+=(n-26).toString(36).toUpperCase():n>62?t+="-":t+="_",t),"");var Mr={exports:{}};(function(e,t){(function(n,i){{var s=i();e&&e.exports&&(t=e.exports=s),t.randomColor=s}})(kt,function(){var n=null,i={};O();var s=[],o=function(m){if(m=m||{},m.seed!==void 0&&m.seed!==null&&m.seed===parseInt(m.seed,10))n=m.seed;else if(typeof m.seed=="string")n=k(m.seed);else{if(m.seed!==void 0&&m.seed!==null)throw new TypeError("The seed value must be an integer or string");n=null}var C,A,v;if(m.count!==null&&m.count!==void 0){for(var R=m.count,x=[],P=0;P<m.count;P++)s.push(!1);for(m.count=null;R>x.length;){var q=o(m);n!==null&&(m.seed=n),x.push(q)}return m.count=R,x}return C=u(m),A=c(C,m),v=l(C,A,m),y([C,A,v],m)};function u(m){if(s.length>0){var C=D(m.hue),A=g(C),v=(C[1]-C[0])/s.length,R=parseInt((A-C[0])/v);s[R]===!0?R=(R+2)%s.length:s[R]=!0;var x=(C[0]+R*v)%359,P=(C[0]+(R+1)*v)%359;return C=[x,P],A=g(C),A<0&&(A=360+A),A}else{var C=h(m.hue);return A=g(C),A<0&&(A=360+A),A}}function c(m,C){if(C.hue==="monochrome")return 0;if(C.luminosity==="random")return g([0,100]);var A=f(m),v=A[0],R=A[1];switch(C.luminosity){case"bright":v=55;break;case"dark":v=R-10;break;case"light":R=55;break}return g([v,R])}function l(m,C,A){var v=w(m,C),R=100;switch(A.luminosity){case"dark":R=v+20;break;case"light":v=(R+v)/2;break;case"random":v=0,R=100;break}return g([v,R])}function y(m,C){switch(C.format){case"hsvArray":return m;case"hslArray":return S(m);case"hsl":var A=S(m);return"hsl("+A[0]+", "+A[1]+"%, "+A[2]+"%)";case"hsla":var v=S(m),P=C.alpha||Math.random();return"hsla("+v[0]+", "+v[1]+"%, "+v[2]+"%, "+P+")";case"rgbArray":return F(m);case"rgb":var R=F(m);return"rgb("+R.join(", ")+")";case"rgba":var x=F(m),P=C.alpha||Math.random();return"rgba("+x.join(", ")+", "+P+")";default:return E(m)}}function w(m,C){for(var A=p(m).lowerBounds,v=0;v<A.length-1;v++){var R=A[v][0],x=A[v][1],P=A[v+1][0],q=A[v+1][1];if(C>=R&&C<=P){var Y=(q-x)/(P-R),G=x-Y*R;return Y*C+G}}return 0}function h(m){if(typeof parseInt(m)=="number"){var C=parseInt(m);if(C<360&&C>0)return[C,C]}if(typeof m=="string"){if(i[m]){var A=i[m];if(A.hueRange)return A.hueRange}else if(m.match(/^#?([0-9A-F]{3}|[0-9A-F]{6})$/i)){var v=b(m)[0];return[v,v]}}return[0,360]}function f(m){return p(m).saturationRange}function p(m){m>=334&&m<=360&&(m-=360);for(var C in i){var A=i[C];if(A.hueRange&&m>=A.hueRange[0]&&m<=A.hueRange[1])return i[C]}return"Color not found"}function g(m){if(n===null){var C=.618033988749895,A=Math.random();return A+=C,A%=1,Math.floor(m[0]+A*(m[1]+1-m[0]))}else{var v=m[1]||1,R=m[0]||0;n=(n*9301+49297)%233280;var x=n/233280;return Math.floor(R+x*(v-R))}}function E(m){var C=F(m);function A(R){var x=R.toString(16);return x.length==1?"0"+x:x}var v="#"+A(C[0])+A(C[1])+A(C[2]);return v}function I(m,C,A){var v=A[0][0],R=A[A.length-1][0],x=A[A.length-1][1],P=A[0][1];i[m]={hueRange:C,lowerBounds:A,saturationRange:[v,R],brightnessRange:[x,P]}}function O(){I("monochrome",null,[[0,0],[100,0]]),I("red",[-26,18],[[20,100],[30,92],[40,89],[50,85],[60,78],[70,70],[80,60],[90,55],[100,50]]),I("orange",[18,46],[[20,100],[30,93],[40,88],[50,86],[60,85],[70,70],[100,70]]),I("yellow",[46,62],[[25,100],[40,94],[50,89],[60,86],[70,84],[80,82],[90,80],[100,75]]),I("green",[62,178],[[30,100],[40,90],[50,85],[60,81],[70,74],[80,64],[90,50],[100,40]]),I("blue",[178,257],[[20,100],[30,86],[40,80],[50,74],[60,60],[70,52],[80,44],[90,39],[100,35]]),I("purple",[257,282],[[20,100],[30,87],[40,79],[50,70],[60,65],[70,59],[80,52],[90,45],[100,42]]),I("pink",[282,334],[[20,100],[30,90],[40,86],[60,84],[80,80],[90,75],[100,73]])}function F(m){var C=m[0];C===0&&(C=1),C===360&&(C=359),C=C/360;var A=m[1]/100,v=m[2]/100,R=Math.floor(C*6),x=C*6-R,P=v*(1-A),q=v*(1-x*A),Y=v*(1-(1-x)*A),G=256,et=256,at=256;switch(R){case 0:G=v,et=Y,at=P;break;case 1:G=q,et=v,at=P;break;case 2:G=P,et=v,at=Y;break;case 3:G=P,et=q,at=v;break;case 4:G=Y,et=P,at=v;break;case 5:G=v,et=P,at=q;break}var z=[Math.floor(G*255),Math.floor(et*255),Math.floor(at*255)];return z}function b(m){m=m.replace(/^#/,""),m=m.length===3?m.replace(/(.)/g,"$1$1"):m;var C=parseInt(m.substr(0,2),16)/255,A=parseInt(m.substr(2,2),16)/255,v=parseInt(m.substr(4,2),16)/255,R=Math.max(C,A,v),x=R-Math.min(C,A,v),P=R?x/R:0;switch(R){case C:return[60*((A-v)/x%6)||0,P,R];case A:return[60*((v-C)/x+2)||0,P,R];case v:return[60*((C-A)/x+4)||0,P,R]}}function S(m){var C=m[0],A=m[1]/100,v=m[2]/100,R=(2-A)*v;return[C,Math.round(A*v/(R<1?R:2-R)*1e4)/100,R/2*100]}function k(m){for(var C=0,A=0;A!==m.length&&!(C>=Number.MAX_SAFE_INTEGER);A++)C+=m.charCodeAt(A);return C}function D(m){if(isNaN(m)){if(typeof m=="string"){if(i[m]){var A=i[m];if(A.hueRange)return A.hueRange}else if(m.match(/^#?([0-9A-F]{3}|[0-9A-F]{6})$/i)){var v=b(m)[0];return p(v).hueRange}}}else{var C=parseInt(m);if(C<360&&C>0)return p(m).hueRange}return[0,360]}return o})})(Mr,Mr.exports);var gl=Mr.exports;function _s(e){return`<svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="13 9 35 35"
      width="36"
      height="36"
      fill="none"
      fillRule="evenodd"
    >
      <g fill="rgba(0,0,0,.2)" transform="translate(1,1)">
        <path d="m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z" />
        <path d="m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z" />
      </g>
      <g fill="white">
        <path d="m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z" />
        <path d="m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z" />
      </g>
      <g fill="${e}">
        <path d="m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z" />
        <path d="m13 10.814v11.188l2.969-2.866.428-.139h4.768z" />
      </g>
    </svg>`}function vs(e){const t=`<div id="cursor_${e.id}" class="cursor">
    ${_s(e.color)}
    <p id="chat_${e.id}" class="chat" style="background-color: ${e.color}">${e.chat}</p>
  </div>`,n=document.createElement("template");return n.innerHTML=t,n.content.firstChild}const Ss={triggerKey:"/",cursorDivId:"cursor-chat-layer",chatDivId:"cursor-chat-box",userMetaData:{},renderCursor:vs,yDoc:void 0,color:void 0,shouldChangeUserCursor:void 0},pl=/[\r\n%#()<>?[\\\]^`{|}]/g;function yl(e){return e=e.replace(/"/g,"'"),e=e.replace(/>\s{1,}</g,"><"),e=e.replace(/\s{2,}/g," "),e.replace(pl,encodeURIComponent)}const ml=(e=`cursor-chat-room-${window.location.host+window.location.pathname}`,t={})=>{const{triggerKey:n,cursorDivId:i,chatDivId:s,userMetaData:o,renderCursor:u,color:c,yDoc:l,shouldChangeUserCursor:y}=pe(pe({},Ss),t),w=document.getElementById(i),h=document.getElementById(s);if(!w||!h)throw"Couldn't find cursor-chat-related divs! Make sure DOM content is fully loaded before initializing";const f={id:fl(),x:0,y:0,chat:"",color:c!=null?c:gl(),userMetaData:o};let p,g;l!==void 0?p=l:(p=new ve,g=new ul(e,p,{signaling:["wss://signalling.communities.digital","wss://signaling.yjs.dev","wss://y-webrtc-signaling-eu.herokuapp.com"]}));const E=p.getMap("state");let I=!1;if(y){const b=yl(_s(f.color));document.documentElement.style.cursor=`url("data:image/svg+xml,${b}"), auto`}const O=()=>{E.delete(f.id),g==null||g.destroy()};addEventListener("beforeunload",O),setInterval(()=>{I&&(E.set(f.id,f),I=!1)},80),document.onmousemove=b=>{f.x!==b.pageX&&f.y!==b.pageY&&(I=!0,f.x=b.pageX,f.y=b.pageY,h.style.setProperty("transform",`translate(${f.x}px, ${f.y}px)`))},document.addEventListener("keydown",b=>{b.key===n?h.style.getPropertyValue("display")==="block"&&h.value===""?(b.preventDefault(),h.style.setProperty("display","none")):(b.preventDefault(),h.style.setProperty("display","block"),h.focus()):b.key==="Escape"?(b.preventDefault(),h.value="",h.style.setProperty("display","none")):b.key==="Enter"&&b.preventDefault()}),document.addEventListener("keyup",()=>{f.chat=h.value,I=!0});const F=new Map;return E.observe(b=>{b.changes.keys.forEach((k,D)=>{if(D!==f.id)switch(k.action){case"add":const m=E.get(D),C=u(m);C.classList.add("new"),w.appendChild(C);const A=([Y,G])=>C.style.setProperty("transform",`translate(${Y}px, ${G}px)`),v=new bs(A);v.addPoint([m.x,m.y]),F.set(D,v);break;case"update":const R=E.get(D),x=document.getElementById(`cursor_${D}`),P=document.getElementById(`chat_${D}`);R.chat===""?P.classList.remove("show"):P.classList.add("show"),P.innerText=R.chat,x.classList.remove("new"),F.get(D).addPoint([R.x,R.y]);break;case"delete":const q=document.getElementById(`cursor_${D}`);q.classList.add("expiring"),setTimeout(()=>{q.remove(),F.delete(D)},1e3);break}})}),O};dt.DefaultConfig=Ss,dt.defaultCursorRenderer=vs,dt.initCursorChat=ml,Object.defineProperties(dt,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
